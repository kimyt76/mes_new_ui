import{_ as Z,a as ee,u as te,p as le,r as f,k as ne,m as ae,c as oe,f as v,g as e,d as u,w as n,F as ie,e as de,o as se,j as ue,i as F,h as L,C as y,D as _}from"./index-CHPVuy_C.js";import{A as M}from"./apiLab-CpgcPYRY.js";import{i as w,f as O}from"./common-B57YTEDc.js";import{_ as me}from"./IngredientListPop-LmSMlPJa.js";import{_ as re}from"./MultiFileUpload-BX1GmOAS.js";import"./format-CBpsKyOP.js";import"./filedownLoad-B5zWh5p2.js";const ce=["id"],pe=["onUpdate:modelValue"],fe=["onUpdate:modelValue"],ve=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],_e=["onUpdate:modelValue"],he=["onUpdate:modelValue"],ge={__name:"MaterialDetail",setup(xe){const{userId:A}=ee(),{vError:P,vSuccess:R}=te(),$=de(),I=le().params.id,g=f(!1),N=f(""),b=f(""),m=f([]),h=f([]),p=f([]),j=f([]),E=[{title:"성분코드",key:"ingredientCode",align:"center",width:"90px"},{title:"국문성분명",key:"krIngredientName",align:"start",width:"230px"},{title:"영어성분명",key:"enIngredientName",align:"start",width:"230px"},{title:"국내함량",key:"inContent",align:"center",width:"100px"},{title:"수출용함량",key:"outContent",align:"center",width:"100px"},{title:"CAS No",key:"casNo",align:"center",width:"90px"},{title:"function",key:"functionNm",align:"center",width:"90px"},{title:"한도 국가",key:"limitCountry",align:"center",width:"90px"},{title:"금지 국가",key:"banCountry",align:"center",width:"90px"},{title:"-",key:"actions",align:"center",width:"10px"}],J=[{title:"No.",key:"historyId",align:"center",width:"50px"},{title:"변경사유",key:"historyComment",align:"start",width:"500px"},{title:"수정자",key:"updName",align:"center",width:"100px"},{title:"수정일",key:"updDate",align:"center",width:"100px"},{title:"-",key:"actions",align:"center",width:"10px"}],i=ne({itemCd:"",itemName:"",unit:"",customerName:"",inPrice:"",outPrice:"",itemGrp1:"",vegan:!1,halal:!1,rspo:!1,addtion:!1}),k=async()=>{const a=new FormData;try{const t={itemCd:I,historyId:N.value,attachFileId:b.value,userId:A};a.append("materialInfo",JSON.stringify(t)),a.append("materialList",JSON.stringify(m.value)),a.append("historyList",JSON.stringify(p.value));const r=[];h.value.forEach(o=>{o.flag==="N"?a.append("newFiles",o.file):o.flag==="D"&&r.push({attachFileId:o.attachFileId,seq:o.seq})}),a.append("keptFiles",JSON.stringify(h.value.filter(o=>o.flag==="S"))),r.length>0&&a.append("deleteFiles",new Blob([JSON.stringify(r)],{type:"application/json"}));const d=await M.saveMaterialInfo(a);R(d)}catch(t){P(t.respose)}},B=()=>{g.value=!0},G=()=>{const t={historyComment:"",updName:"",updDate:"",orderDist:p.value.length,historyId:""};p.value.push({...t})},q=a=>{if(!Array.isArray(a))return;let t=m.value.length;const r=a.map((d,o)=>({id:t++,ingredientCode:d.ingredientCode,krIngredientName:d.krIngredientName,enIngredientName:d.enIngredientName,inContent:"",outContent:"",casNo:d.casNo,functionNm:d.functionNm,limitCountry:d.limitCountry,banCountry:d.banCountry}));m.value.length>0?m.value.push(...r):m.value=[...r]},z=a=>{const t=m.value.findIndex(r=>r.ingredientCode===a);m.value.splice(t,1)},H=a=>{const t=p.value.findIndex(r=>r.historyId===a);p.value.splice(t,1)};ae(async()=>{const a=await M.getMaterialInfo(I);Object.assign(i,a.itemInfo),w(a.fileList)||(h.value=a.fileList,b.value=a.materialInfo.attachFileId),w(a.materialList)||(m.value=a.materialList),w(a.historyList)||(N.value=a.materialInfo.historyId,p.value=a.historyList)});const T=()=>{$.push({name:"MaterialList"})};return(a,t)=>{const r=u("v-breadcrumbs"),d=u("v-text-field"),o=u("v-col"),c=u("v-row"),x=u("v-checkbox"),K=u("v-select"),Q=u("v-form"),W=u("v-card-text"),X=u("v-card"),U=u("v-card-subtitle"),V=u("v-btn"),S=u("v-icon"),D=u("v-data-table-virtual"),Y=u("v-dialog");return se(),oe(ie,null,[v("div",{id:a.$attrs.id},null,8,ce),e(r,{items:["MES","연구관리","원료상세"]}),e(X,null,{default:n(()=>[e(W,null,{default:n(()=>[e(Q,{onSubmit:ue(k,["prevent"])},{default:n(()=>[e(c,null,{default:n(()=>[e(o,null,{default:n(()=>[e(d,{modelValue:i.itemCd,"onUpdate:modelValue":t[0]||(t[0]=l=>i.itemCd=l),label:"품목코드",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"6"},{default:n(()=>[e(d,{modelValue:i.itemName,"onUpdate:modelValue":t[1]||(t[1]=l=>i.itemName=l),label:"품목명",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(o,null,{default:n(()=>[e(d,{modelValue:i.unit,"onUpdate:modelValue":t[2]||(t[2]=l=>i.unit=l),label:"단위",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:n(()=>[e(o,{cols:"6"},{default:n(()=>[e(d,{modelValue:i.customerName,"onUpdate:modelValue":t[3]||(t[3]=l=>i.customerName=l),label:"거래처명",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(o,{class:"d-flex"},{default:n(()=>[e(x,{modelValue:i.vegan,"onUpdate:modelValue":t[4]||(t[4]=l=>i.vegan=l),label:"Vegan",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(x,{modelValue:i.halal,"onUpdate:modelValue":t[5]||(t[5]=l=>i.halal=l),label:"Halal",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(x,{modelValue:i.rspo,"onUpdate:modelValue":t[6]||(t[6]=l=>i.rspo=l),label:"RSPO",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(x,{modelValue:i.addtion,"onUpdate:modelValue":t[7]||(t[7]=l=>i.addtion=l),label:"RSPO",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"])]),_:1}),e(o,null,{default:n(()=>[e(K,{modelValue:i.itemGrp1,"onUpdate:modelValue":t[8]||(t[8]=l=>i.itemGrp1=l),items:j.value,label:"거래유형","item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(c,null,{default:n(()=>[e(o,null,{default:n(()=>[e(d,{"model-value":F(O)(i.inPrice),label:"입고단가",variant:"underlined",density:"compact",readonly:""},null,8,["model-value"])]),_:1}),e(o,null,{default:n(()=>[e(d,{"model-value":F(O)(i.outPrice),label:"출고단가",variant:"underlined",density:"compact",readonly:""},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(c,{class:"mt-4"},{default:n(()=>[e(o,{class:"mt-3"},{default:n(()=>[e(U,null,{default:n(()=>t[12]||(t[12]=[L(" - 성분코드 ")])),_:1})]),_:1}),e(o,{class:"d-flex justify-end"},{default:n(()=>[e(V,{color:"brown-lighten-4",class:"mt-3",text:"추가+",density:"compact",onClick:B})]),_:1})]),_:1}),e(c,null,{default:n(()=>[e(D,{headers:E,items:m.value,class:"custom-table"},{"item.inContent":n(({item:l,index:s})=>[y(v("input",{"onUpdate:modelValue":C=>m.value[s].inContent=C,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,pe),[[_,m.value[s].inContent]])]),"item.outContent":n(({item:l,index:s})=>[y(v("input",{"onUpdate:modelValue":C=>m.value[s].outContent=C,style:{"text-align":"right",width:"90%",height:"30px"},class:"custom-line"},null,8,fe),[[_,m.value[s].outContent]])]),"item.actions":n(({item:l})=>[e(S,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>z(l.ingredientCode)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),e(c,null,{default:n(()=>[e(o,{class:"mt-5"},{default:n(()=>[e(re,{modelValue:h.value,"onUpdate:modelValue":t[9]||(t[9]=l=>h.value=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:n(()=>[e(o,{class:"mt-3"},{default:n(()=>[e(U,null,{default:n(()=>t[13]||(t[13]=[L(" - 변경이력 ")])),_:1})]),_:1}),e(o,{class:"d-flex justify-end"},{default:n(()=>[e(V,{color:"brown-lighten-4",class:"mt-3",text:"추가+",density:"compact",onClick:G})]),_:1})]),_:1}),e(c,null,{default:n(()=>[e(o,null,{default:n(()=>[e(D,{headers:J,items:p.value,class:"custom-table"},{"item.historyId":n(({item:l})=>[y(v("input",{"onUpdate:modelValue":s=>l.historyId=s,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",readonly:""},null,8,ve),[[_,l.historyId]])]),"item.historyComment":n(({item:l})=>[y(v("input",{"onUpdate:modelValue":s=>l.historyComment=s,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,ye),[[_,l.historyComment]])]),"item.updName":n(({item:l})=>[y(v("input",{"onUpdate:modelValue":s=>l.updName=s,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,_e),[[_,l.updName]])]),"item.updDate":n(({item:l})=>[y(v("input",{"onUpdate:modelValue":s=>l.updDate=s,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,he),[[_,l.updDate]])]),"item.actions":n(({item:l})=>[e(S,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>H(l.historyId)},null,8,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1}),e(c,null,{default:n(()=>[e(o,{class:"d-flex justify-end mt-3 ga-3"},{default:n(()=>[e(V,{text:"저장",color:"brown-lighten-4",onClick:k}),e(V,{text:"목록",onClick:T})]),_:1})]),_:1}),e(Y,{modelValue:g.value,"onUpdate:modelValue":t[11]||(t[11]=l=>g.value=l),width:"900px",persistent:""},{default:n(()=>[e(me,{onSelected:q,onCloseDialog:t[10]||(t[10]=l=>g.value=!1)})]),_:1},8,["modelValue"])],64)}}},Se=Z(ge,[["__scopeId","data-v-7e5dd05a"]]);export{Se as default};
