import{r as f,k as Q,d as a,b as oe,o as W,w as l,g as e,h as F,f as y,j as X,_ as ae,a as ie,u as de,p as se,m as ue,c as re,F as me,e as ce,i as T,B as V,C as w}from"./index-2iBT-78d.js";import{A as G}from"./apiLab-S8yXJiYf.js";import{i as J,f as K}from"./common-Dd6pTfc6.js";import{_ as pe}from"./MultiFileUpload-CSapAdds.js";import"./format-CBpsKyOP.js";import"./filedownLoad-CRpk1A72.js";const ve={style:{"overflow-y":"auto",height:"calc(100% - 40px)"}},fe={__name:"IngredientListPop",emits:["selected","close-dialog"],setup(Y,{emit:D}){const b=D,k=f(""),C=f([]),M=f([]),p=Q({ingredientCode:"",ingredientName:"",functionNm:""}),h=[{title:"성분코드",key:"ingredientCode",width:120},{title:"국문성분명",key:"krIngredientName",width:230},{title:"영문성분명",key:"enIngredientName",width:230},{title:"CAS No",key:"casNo",width:110},{title:"function",key:"functionNm",width:130}],N=async()=>{try{const u={...p};M.value=await G.getIngredientList(u)}catch(u){vError(u)}finally{}},I=()=>{b("selected",C.value)};return(u,i)=>{const v=a("v-toolbar-title"),U=a("v-spacer"),$=a("v-icon"),g=a("v-btn"),s=a("v-toolbar"),x=a("v-text-field"),A=a("v-col"),O=a("v-form"),P=a("v-row"),R=a("v-data-table"),j=a("v-card-text"),B=a("v-card-actions"),o=a("v-card");return W(),oe(o,null,{default:l(()=>[e(s,{height:"40",class:"d-flex align-center justify-space-between px-2 toolbar-Head"},{default:l(()=>[e(v,null,{default:l(()=>i[7]||(i[7]=[F("성분코드조회")])),_:1}),e(U),e(g,{icon:"",onClick:i[0]||(i[0]=t=>b("close-dialog"))},{default:l(()=>[e($,null,{default:l(()=>i[8]||(i[8]=[F("mdi-close")])),_:1})]),_:1})]),_:1}),e(U),e(j,null,{default:l(()=>[e(P,null,{default:l(()=>[e(O,{ref_key:"srhForm",ref:k,onSubmit:X(N,["prevent"])},{default:l(()=>[e(A,{class:"d-flex flex-row ga-3"},{default:l(()=>[e(x,{modelValue:p.ingredientCode,"onUpdate:modelValue":i[1]||(i[1]=t=>p.ingredientCode=t),label:"성분코드",placeholder:"성분코드를 입력해주세요",density:"compact",style:{width:"200px"}},null,8,["modelValue"]),e(x,{modelValue:p.ingredientName,"onUpdate:modelValue":i[2]||(i[2]=t=>p.ingredientName=t),label:"성분명",placeholder:"성분명을 입력해주세요",density:"compact",style:{width:"200px"}},null,8,["modelValue"]),e(x,{modelValue:p.functionNm,"onUpdate:modelValue":i[3]||(i[3]=t=>p.functionNm=t),label:"function명",placeholder:"function명을 입력해주세요",density:"compact",style:{width:"200px"}},null,8,["modelValue"]),e(g,{text:"조회",color:"brown-lighten-4",type:"submit"}),e(g,{text:"초기화",onClick:i[4]||(i[4]=t=>k.value.reset())})]),_:1})]),_:1},512)]),_:1}),y("div",ve,[e(R,{modelValue:C.value,"onUpdate:modelValue":i[5]||(i[5]=t=>C.value=t),headers:h,items:M.value,"item-value":"ingredientCode",density:"compact","fixed-header":"",height:"520px","show-select":"",class:"custom-table","return-object":""},null,8,["modelValue","items"])])]),_:1}),e(B,null,{default:l(()=>[e(g,{text:"선택",variant:"flat",class:"mb-4",color:"indigo-darken-3",onClick:I}),e(g,{text:"닫기",variant:"tonal",class:"mb-4 mr-3",onClick:i[6]||(i[6]=t=>b("close-dialog"))})]),_:1})]),_:1})}}},_e=["id"],ye=["onUpdate:modelValue"],ge=["onUpdate:modelValue"],he=["onUpdate:modelValue"],xe=["onUpdate:modelValue"],Ve=["onUpdate:modelValue"],we=["onUpdate:modelValue"],be={__name:"MaterialDetail",setup(Y){const{userId:D}=ie(),{vError:b,vSuccess:k}=de(),C=ce(),p=se().params.id,h=f(!1),N=f(""),I=f(""),u=f([]),i=f([]),v=f([]),U=f([]),$=[{title:"성분코드",key:"ingredientCode",align:"center",width:"90px"},{title:"국문성분명",key:"krIngredientName",align:"start",width:"230px"},{title:"영어성분명",key:"enIngredientName",align:"start",width:"230px"},{title:"국내함량",key:"inContent",align:"center",width:"100px"},{title:"수출용함량",key:"outContent",align:"center",width:"100px"},{title:"CAS No",key:"casNo",align:"center",width:"90px"},{title:"function",key:"functionNm",align:"center",width:"90px"},{title:"한도 국가",key:"limitCountry",align:"center",width:"90px"},{title:"금지 국가",key:"banCountry",align:"center",width:"90px"},{title:"-",key:"actions",align:"center",width:"10px"}],g=[{title:"No.",key:"historyId",align:"center",width:"50px"},{title:"변경사유",key:"historyComment",align:"start",width:"500px"},{title:"수정자",key:"updName",align:"center",width:"100px"},{title:"수정일",key:"updDate",align:"center",width:"100px"},{title:"-",key:"actions",align:"center",width:"10px"}],s=Q({itemCd:"",itemName:"",unit:"",customerName:"",inPrice:"",outPrice:"",itemGrp1:"",vegan:!1,halal:!1,rspo:!1,addtion:!1}),x=async()=>{const o=new FormData;try{const t={itemCd:p,historyId:N.value,attachFileId:I.value,userId:D};console.log("1"),o.append("materialInfo",JSON.stringify(t)),o.append("materialList",JSON.stringify(u.value)),o.append("historyList",JSON.stringify(v.value));const c=[];i.value.forEach(d=>{d.flag==="N"?o.append("newFiles",d.file):d.flag==="D"&&c.push({attachFileId:d.attachFileId,seq:d.seq})}),o.append("keptFiles",JSON.stringify(i.value.filter(d=>d.flag==="S"))),c.length>0&&o.append("deleteFiles",new Blob([JSON.stringify(c)],{type:"application/json"})),console.log("historyList.value",v.value);const r=await G.saveMaterialInfo(o);k(r)}catch(t){b(t.respose)}},A=()=>{h.value=!0},O=()=>{const t={historyComment:"",updName:"",updDate:"",orderDist:v.value.length,historyId:""};v.value.push({...t})},P=o=>{if(!Array.isArray(o))return;let t=u.value.length;const c=o.map((r,d)=>({id:t++,ingredientCode:r.ingredientCode,krIngredientName:r.krIngredientName,enIngredientName:r.enIngredientName,inContent:"",outContent:"",casNo:r.casNo,functionNm:r.functionNm,limitCountry:r.limitCountry,banCountry:r.banCountry}));u.value.length>0?u.value.push(...c):u.value=[...c]},R=o=>{const t=u.value.findIndex(c=>c.ingredientCode===o);u.value.splice(t,1)},j=o=>{const t=v.value.findIndex(c=>c.historyId===o);v.value.splice(t,1)};ue(async()=>{const o=await G.getMaterialInfo(p);Object.assign(s,o.itemInfo),J(o.fileList)||(i.value=o.fileList,I.value=o.materialInfo.attachFileId),console.log("res",o),J(o.materialList)||(u.value=o.materialList),J(o.historyList)||(N.value=o.materialInfo.historyId,v.value=o.historyList)});const B=()=>{C.push({name:"MaterialList"})};return(o,t)=>{const c=a("v-breadcrumbs"),r=a("v-text-field"),d=a("v-col"),_=a("v-row"),L=a("v-checkbox"),Z=a("v-select"),ee=a("v-form"),te=a("v-card-text"),le=a("v-card"),H=a("v-card-subtitle"),S=a("v-btn"),q=a("v-icon"),z=a("v-data-table-virtual"),ne=a("v-dialog");return W(),re(me,null,[y("div",{id:o.$attrs.id},null,8,_e),e(c,{items:["MES","연구관리","원료상세"]}),e(le,null,{default:l(()=>[e(te,null,{default:l(()=>[e(ee,{onSubmit:X(x,["prevent"])},{default:l(()=>[e(_,null,{default:l(()=>[e(d,null,{default:l(()=>[e(r,{modelValue:s.itemCd,"onUpdate:modelValue":t[0]||(t[0]=n=>s.itemCd=n),label:"품목코드",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(d,{cols:"6"},{default:l(()=>[e(r,{modelValue:s.itemName,"onUpdate:modelValue":t[1]||(t[1]=n=>s.itemName=n),label:"품목명",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(d,null,{default:l(()=>[e(r,{modelValue:s.unit,"onUpdate:modelValue":t[2]||(t[2]=n=>s.unit=n),label:"단위",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(d,{cols:"6"},{default:l(()=>[e(r,{modelValue:s.customerName,"onUpdate:modelValue":t[3]||(t[3]=n=>s.customerName=n),label:"거래처명",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(d,{class:"d-flex"},{default:l(()=>[e(L,{modelValue:s.vegan,"onUpdate:modelValue":t[4]||(t[4]=n=>s.vegan=n),label:"Vegan",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(L,{modelValue:s.halal,"onUpdate:modelValue":t[5]||(t[5]=n=>s.halal=n),label:"Halal",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(L,{modelValue:s.rspo,"onUpdate:modelValue":t[6]||(t[6]=n=>s.rspo=n),label:"RSPO",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(L,{modelValue:s.addtion,"onUpdate:modelValue":t[7]||(t[7]=n=>s.addtion=n),label:"RSPO",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"])]),_:1}),e(d,null,{default:l(()=>[e(Z,{modelValue:s.itemGrp1,"onUpdate:modelValue":t[8]||(t[8]=n=>s.itemGrp1=n),items:U.value,label:"거래유형","item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(d,null,{default:l(()=>[e(r,{"model-value":T(K)(s.inPrice),label:"입고단가",variant:"underlined",density:"compact",readonly:""},null,8,["model-value"])]),_:1}),e(d,null,{default:l(()=>[e(r,{"model-value":T(K)(s.outPrice),label:"출고단가",variant:"underlined",density:"compact",readonly:""},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{class:"mt-4"},{default:l(()=>[e(d,{class:"mt-3"},{default:l(()=>[e(H,null,{default:l(()=>t[12]||(t[12]=[F(" - 성분코드 ")])),_:1})]),_:1}),e(d,{class:"d-flex justify-end"},{default:l(()=>[e(S,{color:"brown-lighten-4",class:"mt-3",text:"추가+",density:"compact",onClick:A})]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(z,{headers:$,items:u.value,class:"custom-table"},{"item.inContent":l(({item:n,index:m})=>[V(y("input",{"onUpdate:modelValue":E=>u.value[m].inContent=E,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,ye),[[w,u.value[m].inContent]])]),"item.outContent":l(({item:n,index:m})=>[V(y("input",{"onUpdate:modelValue":E=>u.value[m].outContent=E,style:{"text-align":"right",width:"90%",height:"30px"},class:"custom-line"},null,8,ge),[[w,u.value[m].outContent]])]),"item.actions":l(({item:n})=>[e(q,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:m=>R(n.ingredientCode)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),e(_,null,{default:l(()=>[e(d,{class:"mt-5"},{default:l(()=>[e(pe,{modelValue:i.value,"onUpdate:modelValue":t[9]||(t[9]=n=>i.value=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(d,{class:"mt-3"},{default:l(()=>[e(H,null,{default:l(()=>t[13]||(t[13]=[F(" - 변경이력 ")])),_:1})]),_:1}),e(d,{class:"d-flex justify-end"},{default:l(()=>[e(S,{color:"brown-lighten-4",class:"mt-3",text:"추가+",density:"compact",onClick:O})]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(d,null,{default:l(()=>[e(z,{headers:g,items:v.value,class:"custom-table"},{"item.historyId":l(({item:n})=>[V(y("input",{"onUpdate:modelValue":m=>n.historyId=m,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",readonly:""},null,8,he),[[w,n.historyId]])]),"item.historyComment":l(({item:n})=>[V(y("input",{"onUpdate:modelValue":m=>n.historyComment=m,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,xe),[[w,n.historyComment]])]),"item.updName":l(({item:n})=>[V(y("input",{"onUpdate:modelValue":m=>n.updName=m,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,Ve),[[w,n.updName]])]),"item.updDate":l(({item:n})=>[V(y("input",{"onUpdate:modelValue":m=>n.updDate=m,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,we),[[w,n.updDate]])]),"item.actions":l(({item:n})=>[e(q,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:m=>j(n.historyId)},null,8,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(d,{class:"d-flex justify-end mt-3 ga-3"},{default:l(()=>[e(S,{text:"저장",color:"brown-lighten-4",onClick:x}),e(S,{text:"목록",onClick:B})]),_:1})]),_:1}),e(ne,{modelValue:h.value,"onUpdate:modelValue":t[11]||(t[11]=n=>h.value=n),width:"900px",persistent:""},{default:l(()=>[e(fe,{onSelected:P,onCloseDialog:t[10]||(t[10]=n=>h.value=!1)})]),_:1},8,["modelValue"])],64)}}},Se=ae(be,[["__scopeId","data-v-bcf42d6a"]]);export{Se as default};
