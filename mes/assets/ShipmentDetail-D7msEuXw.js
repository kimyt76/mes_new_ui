import{_ as oe,u as de,a as se,p as ie,y as me,r as c,k as ue,B as re,q as pe,m as ce,c as F,f as u,g as t,d as m,w as o,i as S,F as O,e as ve,o as C,j as fe,t as E,C as b,D as I,n as ge,b as ye,z as _e,A as Ve}from"./index-WOYElqRf.js";import{A as T}from"./apiOrders-C3CirX1x.js";import{e as y,i as he}from"./common-DT3ZdnD0.js";import{_ as we}from"./MultiFileUpload-B8zR6k5s.js";import{C as Ne}from"./CustomerListPop-DY0fIeo2.js";import{_ as xe}from"./UserListPop-DFPdUKXl.js";import{_ as Se}from"./StorageListPop-WPdVmoxk.js";import{_ as Ce}from"./SaleListPop-DDr-d1pb.js";import"./format-DWu4U6B8.js";import"./filedownLoad-aGzv65Fr.js";import"./apiBase-BxtsCvh9.js";const be=["id"],Ie=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],ke=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Me={class:"summary-row"},qe={style:{width:"250px","text-align":"right","font-weight":"bold",height:"30px"}},Fe={__name:"ShipmentDetail",setup(Te){const{vError:R,vSuccess:J}=de(),$=ve(),P=ie(),{userId:z}=se(),H=P.params.id,h=me(null),w=c(!1),_=c(!1);let N=c(""),x=c(""),U=c("");c(null);const L=c([]),g=c([]),i=c([]),l=ue({shipmentDate:"",seq:"",customerName:"",customerCd:"",managerId:"",managerName:"",descStorageCd:"",descStorageName:"",deliveryTelno:"",deliveryManagerName:"",tradingMethod:"",dueDate:"",releaseTime:"",releaseType:"",accountStatement:"",address:"",attachFileId:"",saleIds:"",userId:z}),Q=[{title:"품목코드 ",key:"itemCd",align:"center",width:"150px"},{title:"품목명",key:"itemName",align:"center",width:"400px"},{title:"수량",key:"qty",align:"center",width:"130px"},{title:"lot No.",key:"lotNo",align:"center",width:"200px"},{title:"-",key:"actions",align:"center",width:10}],W=re(()=>i.value.reduce((n,e)=>n+Number(e.qty||0),0)),G=async()=>{const n=new FormData;try{const e={...l};e.dueDate=y(l.dueDate),n.append("shipmentInfo",JSON.stringify(e)),n.append("itemList",JSON.stringify(i.value));const V=[];g.value.forEach(r=>{r.flag==="N"?n.append("newFiles",r.file):r.flag==="D"&&V.push({attachFileId:r.attachFileId,seq:r.seq})}),V.length>0&&n.append("deleteFiles",new Blob([JSON.stringify(V)],{type:"application/json"})),n.append("keptFiles",JSON.stringify(g.value.filter(r=>r.flag==="S")));const D=await T.updateShipmentInfo(n);J(D),$.push({name:"ShipmentList"})}catch(e){R(e.message)}},k=n=>{switch(U.value=n,n){case"C":h.value=Ne,N.value="800px",x.value="800px";break;case"U":h.value=xe,N.value="800px",x.value="800px";break;case"S":h.value=Se,N.value="800px",x.value="850px";break}_.value=!0},K=n=>{switch(U.value){case"C":l.customerName=n.customerName,l.customerCd=n.customerCd,l.managerName=n.memberCd,l.managerId=n.memberCd,l.tradingMethod=n.tradingMethod;break;case"U":l.managerName=n.memberNm,l.managerId=n.userId;break;case"S":l.descStorageName=n.storageName,l.descStorageCd=n.storageCd;break}U.value="",_.value=!1},X=async n=>{L.value=n,l.customerCd=n[0].customerCd,l.customerName=n[0].customerName,l.managerId=n[0].managerId,l.managerName=n[0].managerName,l.descStorageCd=n[0].descStorageCd,l.descStorageName=n[0].descStorageName,l.tradingMethod=n[0].tradingMethod,l.saleIds=L.value.map(e=>e.saleId).join(","),i.value=await T.getSalesItemList(l.saleIds)};pe(()=>l.shipmentDate,async(n,e)=>{he(y(e))||e!==y(n)&&(l.seq=await Ve.getNextSeq("tb_shipment_mst","shipment_Date",y(n)))});const Y=n=>{i.value.splice(n,1)},Z=()=>{w.value=!0};ce(async()=>{j()});const j=async()=>{const n=await T.getShipmentInfo(H);Object.assign(l,n.shipmentInfo),i.value=n.itemList,n.attachFileInfo!==null?g.value=n.attachFileInfo:g.value=[]},ee=()=>{$.push({name:"ShipmentList"})};return(n,e)=>{const V=m("v-breadcrumbs"),D=m("v-card-item"),r=m("v-date-input"),p=m("v-text-field"),d=m("v-col"),v=m("v-row"),A=m("v-textarea"),M=m("v-card-text"),q=m("v-btn"),te=m("v-icon"),le=m("v-data-table-virtual"),ae=m("v-form"),ne=m("v-card"),B=m("v-dialog");return C(),F(O,null,[u("div",{id:n.$attrs.id},null,8,be),t(V,{items:["MES","영업관리","출하지시서 상세"],class:"custom-breadcrumbs"}),t(ne,null,{default:o(()=>[t(D,{title:"출하지시서 상세"}),t(ae,{ref:"vform",onSubmit:fe(G,["prevent"])},{default:o(()=>[t(M,null,{default:o(()=>[t(v,null,{default:o(()=>[t(d,{class:"d-flex"},{default:o(()=>[t(r,{modelValue:l.shipmentDate,"onUpdate:modelValue":e[0]||(e[0]=a=>l.shipmentDate=a),label:"주문일자",density:"compact","display-format":S(y),variant:"underlined",style:{width:"200px"},class:"mb-2"},null,8,["modelValue","display-format"]),t(p,{modelValue:l.seq,"onUpdate:modelValue":e[1]||(e[1]=a=>l.seq=a),density:"compact",style:{width:"20px"},class:"mb-2",readonly:""},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(r,{modelValue:l.dueDate,"onUpdate:modelValue":e[2]||(e[2]=a=>l.dueDate=a),label:"출하예정일",density:"compact","display-format":S(y),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"])]),_:1}),t(d,{cols:"6"},{default:o(()=>[t(p,{modelValue:l.customerName,"onUpdate:modelValue":e[3]||(e[3]=a=>l.customerName=a),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[4]||(e[4]=a=>k("C"))},null,8,["modelValue"])]),_:1})]),_:1}),t(v,null,{default:o(()=>[t(d,null,{default:o(()=>[t(p,{modelValue:l.managerName,"onUpdate:modelValue":e[5]||(e[5]=a=>l.managerName=a),label:"출고요청자",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[6]||(e[6]=a=>k("U"))},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(p,{modelValue:l.descStorageName,"onUpdate:modelValue":e[7]||(e[7]=a=>l.descStorageName=a),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[8]||(e[8]=a=>k("S"))},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(p,{modelValue:l.deliveryTelno,"onUpdate:modelValue":e[9]||(e[9]=a=>l.deliveryTelno=a),label:"납품지연락처",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(p,{modelValue:l.deliveryManagerName,"onUpdate:modelValue":e[10]||(e[10]=a=>l.deliveryManagerName=a),label:"납품지담당자",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(v,null,{default:o(()=>[t(d,null,{default:o(()=>[t(p,{modelValue:l.releaseTime,"onUpdate:modelValue":e[11]||(e[11]=a=>l.releaseTime=a),label:"출하시간",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(p,{modelValue:l.releaseType,"onUpdate:modelValue":e[12]||(e[12]=a=>l.releaseType=a),label:"출고구분",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(p,{modelValue:l.accountStatement,"onUpdate:modelValue":e[13]||(e[13]=a=>l.accountStatement=a),label:"거래명세서",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(p,{modelValue:l.tradingMethod,"onUpdate:modelValue":e[14]||(e[14]=a=>l.tradingMethod=a),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(v,null,{default:o(()=>[t(d,{cols:"6"},{default:o(()=>[t(A,{modelValue:l.address,"onUpdate:modelValue":e[15]||(e[15]=a=>l.address=a),label:"납품지 주소",density:"compact",rows:"2"},null,8,["modelValue"])]),_:1}),t(d,{cols:"6"},{default:o(()=>[t(A,{modelValue:l.etc,"onUpdate:modelValue":e[16]||(e[16]=a=>l.etc=a),label:"특이사항",density:"compact",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{dense:""},{default:o(()=>[t(d,{cols:"12"},{default:o(()=>[t(we,{modelValue:g.value,"onUpdate:modelValue":e[17]||(e[17]=a=>g.value=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(M,null,{default:o(()=>[t(v,null,{default:o(()=>[t(d,{class:"d-flex ga-4 justify-end"},{default:o(()=>[t(q,{text:"판매",density:"compact",onClick:Z})]),_:1})]),_:1})]),_:1}),t(M,null,{default:o(()=>[t(v,null,{default:o(()=>[t(d,null,{default:o(()=>[t(le,{headers:Q,items:i.value,density:"compact","item-value":"id",class:"custom-table no-padding-table"},{headers:o(({columns:a})=>[u("tr",null,[(C(!0),F(O,null,ge(a,s=>(C(),F("th",{key:s.key,class:"custom-header"},E(s.title),1))),128))])]),"item.itemCd":o(({item:a,index:s})=>[b(u("input",{"onUpdate:modelValue":f=>i.value[s].itemCd=f,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",readonly:""},null,8,Ie),[[I,i.value[s].itemCd]])]),"item.itemName":o(({item:a,index:s})=>[b(u("input",{"onUpdate:modelValue":f=>i.value[s].itemName=f,style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",readonly:""},null,8,Ue),[[I,i.value[s].itemName]])]),"item.qty":o(({item:a,index:s})=>[b(u("input",{"onUpdate:modelValue":f=>i.value[s].qty=f,style:{"text-align":"right",width:"95%"},class:"custom-line"},null,8,ke),[[I,i.value[s].qty]])]),"item.lotNo":o(({item:a,index:s})=>[b(u("input",{"onUpdate:modelValue":f=>i.value[s].lotNo=f,type:"text",style:{"text-align":"left",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,De),[[I,i.value[s].lotNo]])]),"item.actions":o(({item:a})=>[t(te,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>Y(a)},null,8,["onClick"])]),"body.append":o(()=>[u("tr",Me,[e[22]||(e[22]=u("td",{style:{width:"200px",height:"30px","text-align":"center"}},"합계",-1)),e[23]||(e[23]=u("td",{style:{width:"650px",height:"30px"}},null,-1)),u("td",qe,E(W.value.toLocaleString()),1),e[24]||(e[24]=u("td",null,null,-1)),e[25]||(e[25]=u("td",null,null,-1))])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),t(v,{class:"mt-2 mb-2"},{default:o(()=>[t(d,{class:"d-flex ga-4 justify-end"},{default:o(()=>[t(q,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),t(q,{text:"목록",class:"mr-3",onClick:ee})]),_:1})]),_:1})]),_:1},512)]),_:1}),t(B,{modelValue:_.value,"onUpdate:modelValue":e[19]||(e[19]=a=>_.value=a),width:S(N),height:S(x),persistent:""},{default:o(()=>[(C(),ye(_e(h.value),{id:n.id,onSelected:K,onCloseDialog:e[18]||(e[18]=a=>_.value=!1)},null,40,["id"]))]),_:1},8,["modelValue","width","height"]),t(B,{modelValue:w.value,"onUpdate:modelValue":e[21]||(e[21]=a=>w.value=a),width:"800",height:"800",persistent:""},{default:o(()=>[t(Ce,{onSelected:X,onCloseSaleDialog:e[20]||(e[20]=a=>w.value=!1)})]),_:1},8,["modelValue"])],64)}}},Qe=oe(Fe,[["__scopeId","data-v-1ad66e21"]]);export{Qe as default};
