import{a as M,s as O}from"./index-Z2YNGKhZ.js";import{K as J,U as Q,M as z,L as K,Z as W,A as f,W as Z,a8 as w,J as S,H as X,e as Y,p as t,h as n,l as i,G as ee,a2 as te,a7 as le,F as ae,V as oe,o as ne,a0 as c,y as se}from"./index-BCdxernO.js";import{s as ie}from"./index-CEOpAmiF.js";import{a as de,b as re,s as ue}from"./index-CKfU0QJd.js";import{s as pe}from"./index-WWuz9eST.js";import{s as me}from"./index-BGn1OEmN.js";import{s as ce}from"./index-DhHuXiFi.js";import{s as fe}from"./index-Dsa_8OmY.js";import{A as y}from"./apiCommon-DQdCmI3G.js";import{A as ye}from"./apiOrders-LBbh7QBG.js";import{C as ve}from"./CommFileUpload-B0pXcOWW.js";import{d as ge,i as we,j as Ve}from"./common-Ctgf_4Dl.js";import{I as xe}from"./ItemListMultiPop-BS5GtrW8.js";import{C as Ce}from"./ClientListPop-BQhfi3oc.js";import{U as be}from"./UserListPop-40qvmJxy.js";import"./apiItem-B0JHHkd5.js";import"./apiBase-DJzL_JWR.js";import"./apiSystem-BBpYMteA.js";const _e={class:"grid mb-2"},he={class:"col-3 flex align-items-center gap-2"},Ue={class:"col-3"},Ne={class:"col-3"},De={class:"col-3"},Pe={class:"grid mb-2"},Ie={class:"col-6"},Te={class:"col-3"},Se={class:"col-3"},je={class:"w-full align-items-center mt-3"},$e={class:"flex justify-content-between align-items-center ml-2 mb-1 mt-2"},ke={class:"w-full mt-2"},Fe=["onClick"],He={class:"flex gap-2 justify-end pt-3"},Le={__name:"ContractReg",setup(qe){const j=Q(),{userId:$}=z(),{vError:k,vSuccess:F,vWarning:Re}=K(),V=W(null),v=f([]),H=oe("dialogRef"),d=f([]),_=f([]),h=f([]),U=f([]),g=f(!1),o=Z({contractDate:"",seq:"",expectedDueDate:"",clientName:"",clientId:"",managerName:"",managerId:"",paymentCondition:"",vatType:"",orderType:"",userId:$});w(()=>d.value.reduce((a,e)=>a+Number(e.qty||0),0));const L=w(()=>d.value.reduce((a,e)=>a+Number(e.supplyPrice||0),0)),q=w(()=>d.value.reduce((a,e)=>a+Number(e.vatPrice||0),0));w(()=>L.value+q.value),S(()=>o.contractDate,async(a,e)=>{we(fnewVal)||e!==a&&(o.seq=await y.getNextSeq("tb_contract_mst","contract_Date",a))}),S(()=>o.vatType,async a=>{a==="VRN"?d.value.map(e=>{e.vatPrice=0}):d.value.map(e=>{e.vatPrice=Ve(e.supplyPrice)})});const R=async()=>{const a=new FormData;if(d.value<=0){vInfo("품목을 등록하세요");return}if(v.value<=0){vInfo("산출물을 등록하세요");return}try{const e={...o};a.append("contractInfo",JSON.stringify(e)),a.append("itemList",JSON.stringify(d.value)),v.value.forEach(s=>{s.file instanceof File&&a.append("attachFile",s.file)});const p=await ye.saveContractInfo(a);F("저장되었습니다."),P()}catch(e){k(e.message)}},N=a=>{if(!Array.isArray(a))return;let e=d.value.length;const p=a.map((s,m)=>({itemCd:s.itemCd,itemName:s.itemName,unit:s.unit,prodType:s.prodType,qty:s.qty,unitPrice:s.unitPrice,supplyPrice:0,vatPrice:0,totPrice:0,orderCnt:s.orderCnt,statusType:s.statusType,etc:s.etc,orderDist:e+m+1}));d.value.length>0?d.value.push(...p):d.value=[...p]},A=a=>{d.value.splice(a,1)},G=()=>{g.value=!0},D=a=>{let e="";a==="C"?(e="고객사 목록",V.value=Ce):a==="U"&&(e="사용자 목록",V.value=be),j.open(V.value,{props:{header:e,modal:!0,draggable:!1,maximizable:!1,style:{overflow:"hidden"},pt:{root:{style:{overflow:"hidden"}},content:{style:{overflow:"hidden"}}}},onClose:p=>{a==="C"?(o.clientName=p.data.clientName,o.clientId=p.data.clientId):a==="U"&&(o.managerName=p.data.memberNm,o.managerId=p.data.userId)}})};X(async()=>{_.value=await y.getCodeList("order_type"),h.value=await y.getCodeList("vat_type"),U.value=await y.getCodeList("status_Type"),o.contractDate=ge(),o.seq=await y.getNextSeq("tb_contract_mst","contract_date",o.contractDate)});const P=()=>{H.value.close()};return(a,e)=>{const p=fe,s=ce,m=me,x=pe,I=re,T=de,C=ue,E=ie,b=ee,r=O,B=M;return ne(),Y(ae,null,[t(E,{style:{width:"100rem",height:"8rem"}},{content:i(()=>[n("div",_e,[n("div",he,[t(s,{variant:"on"},{default:i(()=>[t(p,{modelValue:o.contractDate,"onUpdate:modelValue":e[0]||(e[0]=l=>o.contractDate=l),"show-icon":""},null,8,["modelValue"]),e[14]||(e[14]=n("label",null,"주문일자",-1))]),_:1}),e[16]||(e[16]=n("span",{class:"center-dash"},"-",-1)),t(s,{variant:"on"},{default:i(()=>[t(m,{modelValue:o.seq,"onUpdate:modelValue":e[1]||(e[1]=l=>o.seq=l),inputStyle:{width:"50px","text-align":"center"}},null,8,["modelValue"]),e[15]||(e[15]=n("label",null,"연번",-1))]),_:1})]),n("div",Ue,[t(s,{variant:"on"},{default:i(()=>[t(p,{modelValue:o.expectedDueDate,"onUpdate:modelValue":e[2]||(e[2]=l=>o.expectedDueDate=l),fluid:"","show-icon":""},null,8,["modelValue"]),e[17]||(e[17]=n("label",null,"납기예정일자",-1))]),_:1})]),n("div",Ne,[t(s,{variant:"on"},{default:i(()=>[t(x,{modelValue:o.paymentCondition,"onUpdate:modelValue":e[3]||(e[3]=l=>o.paymentCondition=l),class:"w-full",readonly:""},null,8,["modelValue"]),e[18]||(e[18]=n("label",null,"결제조건",-1))]),_:1})]),n("div",De,[t(s,{variant:"on"},{default:i(()=>[t(T,{iconPosition:"left"},{default:i(()=>[t(x,{modelValue:o.managerName,"onUpdate:modelValue":e[4]||(e[4]=l=>o.managerName=l),class:"w-full"},null,8,["modelValue"]),t(I,{class:"pi pi-search",onClick:e[5]||(e[5]=l=>D("U"))})]),_:1}),e[19]||(e[19]=n("label",null,"담당자",-1))]),_:1})])]),n("div",Pe,[n("div",Ie,[t(s,{variant:"on"},{default:i(()=>[t(T,{iconPosition:"left"},{default:i(()=>[t(x,{modelValue:o.clientName,"onUpdate:modelValue":e[6]||(e[6]=l=>o.clientName=l),class:"w-full"},null,8,["modelValue"]),t(I,{class:"pi pi-search",onClick:e[7]||(e[7]=l=>D("C"))})]),_:1}),e[20]||(e[20]=n("label",null,"고객사",-1))]),_:1})]),n("div",Te,[t(s,{variant:"on"},{default:i(()=>[t(C,{modelValue:o.vatType,"onUpdate:modelValue":e[8]||(e[8]=l=>o.vatType=l),options:h.value,optionLabel:"codeNm",optionValue:"code",class:"w-full"},null,8,["modelValue","options"]),e[21]||(e[21]=n("label",null,"거래유형",-1))]),_:1})]),n("div",Se,[t(s,{variant:"on"},{default:i(()=>[t(C,{modelValue:o.orderType,"onUpdate:modelValue":e[9]||(e[9]=l=>o.orderType=l),options:_.value,optionLabel:"codeNm",optionValue:"code",class:"w-full"},null,8,["modelValue","options"]),e[22]||(e[22]=n("label",null,"수주유형",-1))]),_:1})])])]),_:1}),n("div",je,[t(ve,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value=l),"download-url":"/api/lab/material/file/download",accept:".pdf,.xlsx,.xls,.png,.jpg,.jpeg",multiple:!0,onError:e[11]||(e[11]=l=>console.error(l))},null,8,["modelValue"])]),n("div",$e,[e[23]||(e[23]=n("h5",{class:"m-0"},"- 품목",-1)),t(b,{label:"추가+",onClick:G,class:"p-button-xm"})]),n("div",ke,[t(B,{value:d.value,selectionMode:"single",class:"my-table","scroll-height":"400px","show-gridlines":"",onRowSelect:N},{default:i(()=>[t(r,{field:"itemCd",header:"품목코드",style:{width:"80px"},pt:{columnHeaderContent:"justify-center"}}),t(r,{field:"itemName",header:"품목명",style:c([{width:"300px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}}),t(r,{field:"spec",header:"규격",style:c([{width:"70px"},{"text-align":"center"}]),pt:{columnHeaderContent:"justify-center"}},{default:i(()=>[...e[24]||(e[24]=[se(" >",-1)])]),_:1}),t(r,{field:"itemGrp1",header:"제품유형",style:c([{width:"80px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}}),t(r,{field:"orderQty",header:"수량",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[t(m,{modelValue:l.data.orderQty,"onUpdate:modelValue":[u=>l.data.orderQty=u,()=>a.onChangeRow(l.data)],class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"90px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(r,{field:"inPrice",header:"단가",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[t(m,{modelValue:l.data.inPrice,"onUpdate:modelValue":[u=>l.data.inPrice=u,()=>a.onChangeRow(l.data)],class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"90px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(r,{field:"supplyPrice",header:"공급가액",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[t(m,{modelValue:l.data.supplyPrice,"onUpdate:modelValue":u=>l.data.supplyPrice=u,class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"120px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(r,{field:"vatPrice",header:"부가세",style:{width:"60px"},pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[t(m,{modelValue:l.data.vatPrice,"onUpdate:modelValue":u=>l.data.vatPrice=u,class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"80px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(r,{field:"totPrice",header:"합계",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[t(m,{modelValue:l.data.totPrice,"onUpdate:modelValue":u=>l.data.totPrice=u,class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"120px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(r,{field:"orderCnt",header:"차수",style:c([{width:"60px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}}),t(r,{field:"statusType",header:"진행상태",style:c([{width:"130px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[t(C,{modelValue:l.data.statusType,"onUpdate:modelValue":u=>l.data.statusType=u,class:"w-full",options:U.value,"option-label":"codeNm","option-value":"code"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(r,{field:"etc",header:"비고",style:c([{width:"100px"},{"text-align":"right"}]),pt:{columnHeaderContent:"justify-center"}}),t(r,{field:"actions",header:"-",style:c([{width:"20px"},{"text-align":"center"}]),pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[n("i",{class:"pi pi-trash cursor-pointer",onClick:u=>A(l.index)},null,8,Fe)]),_:1})]),_:1},8,["value"])]),n("div",He,[t(b,{label:"저장",class:"btn-save",onClick:R}),t(b,{label:"닫기",onClick:P})]),t(te(le),{visible:g.value,"onUpdate:visible":e[13]||(e[13]=l=>g.value=l),header:"품목 목록"},{default:i(()=>[t(xe,{onSelected:N,onClose:e[12]||(e[12]=l=>g.value=!1)})]),_:1},8,["visible"])],64)}}},ot=J(Le,[["__scopeId","data-v-a08b287d"]]);export{ot as default};
