import{_ as ae,u as ne,a as oe,x as de,r as p,k as se,z as me,q as ie,m as ue,A as R,c as q,f as u,g as t,d as m,w as n,i as x,F as B,e as re,o as N,j as pe,t as E,B as S,C,n as ce,b as ve,y as fe}from"./index-2iBT-78d.js";import{A as O}from"./apiOrders-B1L1Twvu.js";import{d as ge,e as f,i as ye}from"./common-Dd6pTfc6.js";import{_ as _e}from"./MultiFileUpload-CSapAdds.js";import{C as Ve}from"./CustomerListPop-CC7XEZbw.js";import{_ as we}from"./UserListPop-mz3sGnym.js";import{_ as he}from"./StorageListPop-BUyUHtSb.js";import{_ as xe}from"./SaleListPop-CO42wZ64.js";import"./format-CBpsKyOP.js";import"./filedownLoad-CRpk1A72.js";import"./apiBase-BMtE2mAY.js";const Ne=["id"],Se=["onUpdate:modelValue"],Ce=["onUpdate:modelValue"],be=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],ke={class:"summary-row"},Ie={style:{width:"250px","text-align":"right","font-weight":"bold",height:"30px"}},De={__name:"ShipmentReg",setup(Me){const{vError:P,vSuccess:z}=ne(),T=re(),{userId:J}=oe(),y=de(null),_=p(!1),g=p(!1);let V=p(""),w=p(""),b=p("");p(null);const $=p([]),U=p([]),i=p([]),l=se({shipmentDate:"",seq:"",customerName:"",customerCd:"",managerId:"",managerName:"",descStorageCd:"",descStorageName:"",deliveryTelno:"",deliveryManagerName:"",tradingMethod:"",dueDate:"",releaseTime:"",releaseType:"",accountStatement:"",address:"",attachFileId:"",saleIds:"",userId:J}),H=[{title:"품목코드 ",key:"itemCd",align:"center",width:"150px"},{title:"품목명",key:"itemName",align:"center",width:"400px"},{title:"수량",key:"qty",align:"center",width:"130px"},{title:"lot No.",key:"lotNo",align:"center",width:"200px"},{title:"-",key:"actions",align:"center",width:10}],K=me(()=>i.value.reduce((o,e)=>o+Number(e.qty||0),0)),Q=async()=>{const o=new FormData;try{const e={...l};e.dueDate=f(e.dueDate),o.append("shipmentInfo",JSON.stringify(e)),o.append("itemList",JSON.stringify(i.value)),U.value.forEach(h=>{h.file instanceof File&&o.append("attachFile",h.file)});const I=await O.saveShipmentInfo(o);z(I),T.push({name:"ShipmentList"})}catch(e){P(e.message)}},k=o=>{switch(b.value=o,o){case"C":y.value=Ve,V.value="800px",w.value="800px";break;case"U":y.value=we,V.value="800px",w.value="800px";break;case"S":y.value=he,V.value="800px",w.value="850px";break}g.value=!0},W=o=>{switch(b.value){case"C":l.customerName=o.customerName,l.customerCd=o.customerCd,l.managerName=o.memberCd,l.managerId=o.memberCd,l.tradingMethod=o.tradingMethod;break;case"U":l.managerName=o.memberNm,l.managerId=o.userId;break;case"S":l.descStorageName=o.storageName,l.descStorageCd=o.storageCd;break}b.value="",g.value=!1},G=async o=>{$.value=o,l.customerCd=o[0].customerCd,l.customerName=o[0].customerName,l.managerId=o[0].managerId,l.managerName=o[0].managerName,l.descStorageCd=o[0].descStorageCd,l.descStorageName=o[0].descStorageName,l.tradingMethod=o[0].tradingMethod,l.saleIds=$.value.map(e=>e.saleId).join(","),i.value=await O.getSalesItemList(l.saleIds)};ie(()=>l.shipmentDate,async(o,e)=>{ye(f(e))||e!==f(o)&&(l.seq=await R.getNextSeq("tb_shipment_mst","shipment_Date",f(o)))});const X=o=>{i.value.splice(o,1)},Y=()=>{_.value=!0};ue(async()=>{l.shipmentDate=ge(),l.seq=await R.getNextSeq("tb_shipment_mst","shipment_date",l.shipmentDate)});const Z=()=>{T.push({name:"ShipmentList"})};return(o,e)=>{const I=m("v-breadcrumbs"),h=m("v-card-item"),L=m("v-date-input"),r=m("v-text-field"),d=m("v-col"),c=m("v-row"),F=m("v-textarea"),D=m("v-card-text"),M=m("v-btn"),j=m("v-icon"),ee=m("v-data-table-virtual"),te=m("v-form"),le=m("v-card"),A=m("v-dialog");return N(),q(B,null,[u("div",{id:o.$attrs.id},null,8,Ne),t(I,{items:["MES","영업관리","출하지시서 신규"],class:"custom-breadcrumbs"}),t(le,null,{default:n(()=>[t(h,{title:"출하지시서 입력"}),t(te,{ref:"vform",onSubmit:pe(Q,["prevent"])},{default:n(()=>[t(D,null,{default:n(()=>[t(c,null,{default:n(()=>[t(d,{class:"d-flex"},{default:n(()=>[t(L,{modelValue:l.shipmentDate,"onUpdate:modelValue":e[0]||(e[0]=a=>l.shipmentDate=a),label:"주문일자",density:"compact","display-format":x(f),variant:"underlined",style:{width:"200px"},class:"mb-2"},null,8,["modelValue","display-format"]),t(r,{modelValue:l.seq,"onUpdate:modelValue":e[1]||(e[1]=a=>l.seq=a),density:"compact",style:{width:"20px"},class:"mb-2",readonly:""},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(L,{modelValue:l.dueDate,"onUpdate:modelValue":e[2]||(e[2]=a=>l.dueDate=a),label:"출하예정일",density:"compact","display-format":x(f),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"])]),_:1}),t(d,{cols:"6"},{default:n(()=>[t(r,{modelValue:l.customerName,"onUpdate:modelValue":e[3]||(e[3]=a=>l.customerName=a),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[4]||(e[4]=a=>k("C"))},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:n(()=>[t(d,null,{default:n(()=>[t(r,{modelValue:l.managerName,"onUpdate:modelValue":e[5]||(e[5]=a=>l.managerName=a),label:"출고요청자",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[6]||(e[6]=a=>k("U"))},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(r,{modelValue:l.descStorageName,"onUpdate:modelValue":e[7]||(e[7]=a=>l.descStorageName=a),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[8]||(e[8]=a=>k("S"))},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(r,{modelValue:l.deliveryTelno,"onUpdate:modelValue":e[9]||(e[9]=a=>l.deliveryTelno=a),label:"납품지연락처",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(r,{modelValue:l.deliveryManagerName,"onUpdate:modelValue":e[10]||(e[10]=a=>l.deliveryManagerName=a),label:"납품지담당자",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:n(()=>[t(d,null,{default:n(()=>[t(r,{modelValue:l.releaseTime,"onUpdate:modelValue":e[11]||(e[11]=a=>l.releaseTime=a),label:"출하시간",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(r,{modelValue:l.releaseType,"onUpdate:modelValue":e[12]||(e[12]=a=>l.releaseType=a),label:"출고구분",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(r,{modelValue:l.accountStatement,"onUpdate:modelValue":e[13]||(e[13]=a=>l.accountStatement=a),label:"거래명세서",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(r,{modelValue:l.tradingMethod,"onUpdate:modelValue":e[14]||(e[14]=a=>l.tradingMethod=a),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,null,{default:n(()=>[t(d,{cols:"6"},{default:n(()=>[t(F,{modelValue:l.address,"onUpdate:modelValue":e[15]||(e[15]=a=>l.address=a),label:"납품지 주소",density:"compact",rows:"2"},null,8,["modelValue"])]),_:1}),t(d,{cols:"6"},{default:n(()=>[t(F,{modelValue:l.etc,"onUpdate:modelValue":e[16]||(e[16]=a=>l.etc=a),label:"특이사항",density:"compact",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{dense:""},{default:n(()=>[t(d,{cols:"12"},{default:n(()=>[t(_e,{modelValue:U.value,"onUpdate:modelValue":e[17]||(e[17]=a=>U.value=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(D,null,{default:n(()=>[t(c,null,{default:n(()=>[t(d,{class:"d-flex ga-4 justify-end"},{default:n(()=>[t(M,{text:"판매",density:"compact",onClick:Y})]),_:1})]),_:1})]),_:1}),t(D,null,{default:n(()=>[t(c,null,{default:n(()=>[t(d,null,{default:n(()=>[t(ee,{headers:H,items:i.value,density:"compact","item-value":"id",class:"custom-table no-padding-table"},{headers:n(({columns:a})=>[u("tr",null,[(N(!0),q(B,null,ce(a,s=>(N(),q("th",{key:s.key,class:"custom-header"},E(s.title),1))),128))])]),"item.itemCd":n(({item:a,index:s})=>[S(u("input",{"onUpdate:modelValue":v=>i.value[s].itemCd=v,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",readonly:""},null,8,Se),[[C,i.value[s].itemCd]])]),"item.itemName":n(({item:a,index:s})=>[S(u("input",{"onUpdate:modelValue":v=>i.value[s].itemName=v,style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",readonly:""},null,8,Ce),[[C,i.value[s].itemName]])]),"item.qty":n(({item:a,index:s})=>[S(u("input",{"onUpdate:modelValue":v=>i.value[s].qty=v,style:{"text-align":"right",width:"95%"},class:"custom-line"},null,8,be),[[C,i.value[s].qty]])]),"item.lotNo":n(({item:a,index:s})=>[S(u("input",{"onUpdate:modelValue":v=>i.value[s].lotNo=v,type:"text",style:{"text-align":"left",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ue),[[C,i.value[s].lotNo]])]),"item.actions":n(({item:a})=>[t(j,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>X(a)},null,8,["onClick"])]),"body.append":n(()=>[u("tr",ke,[e[22]||(e[22]=u("td",{style:{width:"200px",height:"30px","text-align":"center"}},"합계",-1)),e[23]||(e[23]=u("td",{style:{width:"650px",height:"30px"}},null,-1)),u("td",Ie,E(K.value.toLocaleString()),1),e[24]||(e[24]=u("td",null,null,-1)),e[25]||(e[25]=u("td",null,null,-1))])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),t(c,{class:"mt-2 mb-2"},{default:n(()=>[t(d,{class:"d-flex ga-4 justify-end"},{default:n(()=>[t(M,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),t(M,{text:"목록",class:"mr-3",onClick:Z})]),_:1})]),_:1})]),_:1},512)]),_:1}),t(A,{modelValue:g.value,"onUpdate:modelValue":e[19]||(e[19]=a=>g.value=a),width:x(V),height:x(w),persistent:""},{default:n(()=>[(N(),ve(fe(y.value),{id:o.id,onSelected:W,onCloseDialog:e[18]||(e[18]=a=>g.value=!1)},null,40,["id"]))]),_:1},8,["modelValue","width","height"]),t(A,{modelValue:_.value,"onUpdate:modelValue":e[21]||(e[21]=a=>_.value=a),width:"800",height:"800",persistent:""},{default:n(()=>[t(xe,{onSelected:G,onCloseSaleDialog:e[20]||(e[20]=a=>_.value=!1)})]),_:1},8,["modelValue"])],64)}}},ze=ae(De,[["__scopeId","data-v-e48329b2"]]);export{ze as default};
