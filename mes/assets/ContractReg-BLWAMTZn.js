import{_ as ie,a as oe,u as se,r as p,x as ue,k as de,z as C,q as R,m as re,A as w,c as ce,f as v,g as a,d as u,w as i,F as me,e as pe,o as F,j as ve,i as E,h as ye,B as f,C as g,b as _e,y as fe}from"./index-B3xMVO1S.js";import{d as ge,e as y,l as M,i as we}from"./common-UsHpmNCI.js";import{A as he}from"./apiOrders-DIY68eZ4.js";import{_ as Ve}from"./MultiFileUpload-DzqmH1VV.js";import{_ as xe,a as be}from"./ClientListPop-BFo7iJR1.js";import{_ as Pe}from"./UserListPop-BJ1ys-26.js";import"./format-CBpsKyOP.js";import"./filedownLoad-HpKgPGuY.js";import"./apiItem-CMAZLzU4.js";import"./apiBase-CJu_qSxp.js";const Ne=["id"],Ce=["onUpdate:modelValue","onBlur"],ke=["onUpdate:modelValue","onBlur"],Ue=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],qe={__name:"ContractReg",setup(Se){const{userId:O}=oe(),{vError:z,vSuccess:J}=se(),q=pe(),h=p(!1),V=ue(null);let k=p("");const l=p([]),S=p([]),$=p([]),B=p([]),U=p([]),x=p(""),b=p(""),o=de({contractDate:"",seq:"",expectedDueDate:"",clientName:"",clientId:"",managerName:"",managerId:"",paymentCondition:"",vatType:"",orderType:"",userId:O}),G=[{title:"품목코드 ",key:"itemCd",align:"center",width:"120px"},{title:"품목명",key:"itemName",align:"start",width:"380px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"제품유형",key:"itemGrp1",align:"center",width:"100px"},{title:"수량",key:"qty",align:"center",width:"80px"},{title:"단가",key:"unitPrice",align:"center",width:"80px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"합계",key:"totPrice",align:"center",width:"100px"},{title:"차수   ",key:"orderCnt",align:"center",width:"80px"},{title:"진행상태",key:"statusType",align:"center",width:"110px"},{title:"비고",key:"etc",align:"center",width:"100px"},{title:"-",key:"actions",align:"center",width:"10px"}];C(()=>l.value.reduce((t,e)=>t+Number(e.qty||0),0));const H=C(()=>l.value.reduce((t,e)=>t+Number(e.supplyPrice||0),0)),K=C(()=>l.value.reduce((t,e)=>t+Number(e.vatPrice||0),0));C(()=>H.value+K.value);const W=async()=>{const t=new FormData;try{const e={...o};e.contractDate=y(e.contractDate),e.expectedDueDate=y(e.expectedDueDate),t.append("contractInfo",JSON.stringify(e)),t.append("itemList",JSON.stringify(l.value)),U.value.forEach(d=>{d.file instanceof File&&t.append("attachFile",d.file)});const m=await he.saveContractInfo(t);J(m),q.push({name:"ContractList"})}catch(e){z(e.message)}};R(()=>o.contractDate,async(t,e)=>{we(y(e))||e!==y(t)&&(o.seq=await w.getNextSeq("tb_contract_mst","contract_Date",y(t)))}),R(()=>o.vatType,async t=>{o.vatType==="VRN"?l.value.map(e=>{e.vatPrice=0}):l.value.map(e=>{e.vatPrice=M(e.supplyPrice)})});const A=t=>{const e=Number(l.value[t].qty),m=Number(l.value[t].unitPrice);!isNaN(e)&&!isNaN(m)?l.value[t].supplyPrice=e*m:l.value[t].supplyPrice=0,isNaN(l.value[t].supplyPrice)?l.value[t].vatPrice=0:l.value[t].vatPrice=M(l.value[t].supplyPrice),isNaN(l.value[t].supplyPrice)?l.value[t].totPrice=0:l.value[t].totPrice=l.value[t].supplyPrice+l.value[t].vatPrice},Q=t=>{switch(k.value){case"C":o.clientName=t.clientName,o.clientId=t.clientId;break;case"U":o.managerName=t.memberNm,o.managerId=t.userId;break;case"I":X(t);break}k.value=""},X=t=>{if(!Array.isArray(t))return;let e=l.value.length;const m=t.map((d,P)=>({itemCd:d.itemCd,itemName:d.itemName,unit:d.unit,prodType:d.prodType,qty:d.qty,unitPrice:d.unitPrice,supplyPrice:d.supplyPrice,vatPrice:0,totPrice:0,orderCnt:"",statusType:"",etc:d.etc,orderDist:e+P+1}));l.value.length>0?l.value.push(...m):l.value=[...m]},D=t=>{switch(k.value=t,t){case"C":V.value=be,x.value="800px",b.value="800px";break;case"U":V.value=Pe,x.value="800px",b.value="800px";break;case"I":V.value=xe,x.value="800px",b.value="850px";break}h.value=!0},Y=t=>{const e=l.value.findIndex(m=>m.itemCd===t);l.value.splice(e,1)};re(async()=>{S.value=await w.getCodeList("order_type"),$.value=await w.getCodeList("vat_type"),B.value=await w.getCodeList("status_Type"),o.contractDate=ge(),o.seq=await w.getNextSeq("tb_contract_mst","contract_date",o.contractDate)});const Z=()=>{q.push({name:"ContractList"})};return(t,e)=>{const m=u("v-breadcrumbs"),d=u("v-card-item"),P=u("v-date-input"),N=u("v-text-field"),c=u("v-col"),_=u("v-row"),T=u("v-select"),L=u("v-card-text"),j=u("v-card-subtitle"),I=u("v-btn"),ee=u("v-icon"),te=u("v-data-table-virtual"),ae=u("v-form"),le=u("v-card"),ne=u("v-dialog");return F(),ce(me,null,[v("div",{id:t.$attrs.id},null,8,Ne),a(m,{items:["MES","영업관리","주문신규"],class:"custom-breadcrumbs"}),a(le,null,{default:i(()=>[a(d,{title:"주문서입력"}),a(ae,{ref:"vform",onSubmit:ve(W,["prevent"])},{default:i(()=>[a(L,null,{default:i(()=>[a(_,null,{default:i(()=>[a(c,{class:"d-flex ga-2 pa-1"},{default:i(()=>[a(P,{modelValue:o.contractDate,"onUpdate:modelValue":e[0]||(e[0]=n=>o.contractDate=n),label:"주문일자",density:"compact","display-format":E(y),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"]),a(N,{modelValue:o.seq,"onUpdate:modelValue":e[1]||(e[1]=n=>o.seq=n),density:"compact",style:{width:"40px"},readonly:""},null,8,["modelValue"])]),_:1}),a(c,null,{default:i(()=>[a(P,{modelValue:o.expectedDueDate,"onUpdate:modelValue":e[2]||(e[2]=n=>o.expectedDueDate=n),label:"납기예정일자",density:"compact","display-format":E(y),variant:"underlined",style:{width:"200px"},"hide-details":""},null,8,["modelValue","display-format"])]),_:1}),a(c,null,{default:i(()=>[a(N,{modelValue:o.paymentCondition,"onUpdate:modelValue":e[3]||(e[3]=n=>o.paymentCondition=n),label:"결제조건",variant:"underlined",density:"compact",style:{width:"200px"},"hide-details":""},null,8,["modelValue"])]),_:1}),a(c,null,{default:i(()=>[a(N,{modelValue:o.managerName,"onUpdate:modelValue":e[4]||(e[4]=n=>o.managerName=n),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=n=>D("U")),style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(_,null,{default:i(()=>[a(c,{cols:"6"},{default:i(()=>[a(N,{modelValue:o.clientName,"onUpdate:modelValue":e[6]||(e[6]=n=>o.clientName=n),label:"고객사",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=n=>D("C"))},null,8,["modelValue"])]),_:1}),a(c,null,{default:i(()=>[a(T,{modelValue:o.vatType,"onUpdate:modelValue":e[8]||(e[8]=n=>o.vatType=n),label:"거래유형",items:$.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",style:{width:"200px"}},null,8,["modelValue","items"])]),_:1}),a(c,null,{default:i(()=>[a(T,{modelValue:o.orderType,"onUpdate:modelValue":e[9]||(e[9]=n=>o.orderType=n),label:"수주유형",items:S.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",style:{width:"200px"}},null,8,["modelValue","items"])]),_:1})]),_:1}),a(_,null,{default:i(()=>[a(c,{cols:"12"},{default:i(()=>[a(Ve,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=n=>U.value=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(L,null,{default:i(()=>[a(_,null,{default:i(()=>[a(c,null,{default:i(()=>[a(j,null,{default:i(()=>e[14]||(e[14]=[ye(" - 품목 ")])),_:1})]),_:1}),a(c,{class:"d-flex ga-4 justify-end"},{default:i(()=>[a(I,{text:"추가 +",density:"compact",onClick:e[11]||(e[11]=n=>D("I"))})]),_:1})]),_:1}),a(_,null,{default:i(()=>[a(c,null,{default:i(()=>[a(te,{headers:G,items:l.value,density:"compact","item-value":"id",class:"custom-table no-padding-table"},{"item.statusType":i(({item:n})=>[a(T,{modelValue:n.statusType,"onUpdate:modelValue":s=>n.statusType=s,items:B.value,"item-title":"codeNm","item-value":"code",density:"compact",variant:"outlined",style:{width:"120px",height:"40px"}},null,8,["modelValue","onUpdate:modelValue","items"])]),"item.qty":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].qty=r,style:{"text-align":"right",width:"90%"},class:"custom-line",onBlur:r=>A(s)},null,40,Ce),[[g,l.value[s].qty]])]),"item.unitPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].unitPrice=r,style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line",onBlur:r=>A(s)},null,40,ke),[[g,l.value[s].unitPrice]])]),"item.supplyPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].supplyPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ue),[[g,l.value[s].supplyPrice]])]),"item.vatPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].vatPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,De),[[g,l.value[s].vatPrice,void 0,{number:!0}]])]),"item.totPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].totPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Te),[[g,l.value[s].totPrice,void 0,{number:!0}]])]),"item.etc":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].etc=r,type:"text",style:{"text-align":"left",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ie),[[g,l.value[s].etc]])]),"item.actions":i(({item:n})=>[a(ee,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>Y(n.itemCd)},null,8,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1}),a(_,{class:"mt-2 mb-2"},{default:i(()=>[a(c,{class:"d-flex ga-4 justify-end"},{default:i(()=>[a(I,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),a(I,{text:"목록",class:"mr-3",onClick:Z})]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),a(ne,{modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=n=>h.value=n),width:x.value,height:b.value,persistent:""},{default:i(()=>[(F(),_e(fe(V.value),{id:t.id,onSelected:Q,onCloseDialog:e[12]||(e[12]=n=>h.value=!1)},null,40,["id"]))]),_:1},8,["modelValue","width","height"])],64)}}},Je=ie(qe,[["__scopeId","data-v-68eb56db"]]);export{Je as default};
