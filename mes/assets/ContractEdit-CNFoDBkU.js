import{_ as se,a as ue,p as de,u as re,r as v,x as ce,k as me,z as C,q as L,m as pe,A as k,c as ve,f as y,g as a,d as u,w as i,F as ye,e as fe,o as E,j as _e,i as O,h as ge,B as w,C as h,b as we,y as he}from"./index-B3xMVO1S.js";import{e as f,l as R,i as Ve}from"./common-UsHpmNCI.js";import{A as J}from"./apiOrders-DIY68eZ4.js";import{_ as xe}from"./MultiFileUpload-DzqmH1VV.js";import{_ as Pe,a as be}from"./ClientListPop-BFo7iJR1.js";import{_ as Ne}from"./UserListPop-BJ1ys-26.js";import"./format-CBpsKyOP.js";import"./filedownLoad-HpKgPGuY.js";import"./apiItem-CMAZLzU4.js";import"./apiBase-CJu_qSxp.js";const Ce=["id"],ke=["onUpdate:modelValue","onBlur"],Ue=["onUpdate:modelValue","onBlur"],Ie=["onUpdate:modelValue"],De=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],qe=["onUpdate:modelValue"],Se={__name:"ContractEdit",setup(Fe){const{userId:M}=ue(),z=de().params.id,{vError:G,vSuccess:H}=re(),q=fe(),V=v(!1),x=ce(null);let U=v("");const l=v([]),S=v([]),F=v([]),$=v([]),_=v([]),P=v(""),b=v(""),o=me({contractDate:"",seq:"",expectedDueDate:"",clientName:"",clientId:"",managerName:"",managerId:"",paymentCondition:"",vatType:"",orderType:"",userId:M}),W=[{title:"품목코드 ",key:"itemCd",align:"center",width:"120px"},{title:"품목명",key:"itemName",align:"start",width:"380px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"제품유형",key:"itemGrp1",align:"center",width:"100px"},{title:"수량",key:"qty",align:"center",width:"80px"},{title:"단가",key:"unitPrice",align:"center",width:"80px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"합계",key:"totPrice",align:"center",width:"100px"},{title:"차수   ",key:"orderCnt",align:"center",width:"80px"},{title:"진행상태",key:"statusType",align:"center",width:"110px"},{title:"비고",key:"etc",align:"center",width:"100px"},{title:"-",key:"actions",align:"center",width:"10px"}];C(()=>l.value.reduce((t,e)=>t+Number(e.qty||0),0));const j=C(()=>l.value.reduce((t,e)=>t+Number(e.supplyPrice||0),0)),K=C(()=>l.value.reduce((t,e)=>t+Number(e.vatPrice||0),0));C(()=>j.value+K.value);const Q=async()=>{const t=new FormData;try{const e={...o};e.contractDate=f(e.contractDate),e.expectedDueDate=f(e.expectedDueDate),t.append("contractInfo",JSON.stringify(e)),t.append("itemList",JSON.stringify(l.value));const d=[];_.value.forEach(m=>{m.flag==="N"?t.append("newFiles",m.file):m.flag==="D"&&d.push({attachFileId:m.attachFileId,seq:m.seq})}),t.append("keptFiles",JSON.stringify(_.value.filter(m=>m.flag==="S"))),d.length>0&&t.append("deleteFiles",new Blob([JSON.stringify(d)],{type:"application/json"}));const c=await J.updateContractInfo(t);H(c),q.push({name:"ContractList"})}catch(e){G(e.message)}};L(()=>o.contractDate,async(t,e)=>{Ve(f(e))||e!==f(t)&&(o.seq=await k.getNextSeq("tb_contract_mst","contract_Date",f(t)))}),L(()=>o.vatType,async t=>{o.vatType==="VRN"?l.value.map(e=>{e.vatPrice=0}):l.value.map(e=>{e.vatPrice=R(e.supplyPrice)})});const B=t=>{const e=Number(l.value[t].qty),d=Number(l.value[t].unitPrice);!isNaN(e)&&!isNaN(d)?l.value[t].supplyPrice=e*d:l.value[t].supplyPrice=0,isNaN(l.value[t].supplyPrice)?l.value[t].vatPrice=0:l.value[t].vatPrice=R(l.value[t].supplyPrice),isNaN(l.value[t].supplyPrice)?l.value[t].totPrice=0:l.value[t].totPrice=l.value[t].supplyPrice+l.value[t].vatPrice},X=t=>{switch(U.value){case"C":o.clientName=t.clientName,o.clientId=t.clientId;break;case"U":o.managerName=t.memberNm,o.managerId=t.userId;break;case"I":Y(t);break}U.value=""},Y=t=>{if(!Array.isArray(t))return;let e=l.value.length;const d=t.map((c,m)=>({itemCd:c.itemCd,itemName:c.itemName,unit:c.unit,prodType:c.prodType,qty:c.qty,unitPrice:c.unitPrice,supplyPrice:c.supplyPrice,vatPrice:0,totPrice:0,orderCnt:"",statusType:"",etc:c.etc,orderDist:e+m+1}));l.value.length>0?l.value.push(...d):l.value=[...d]},I=t=>{switch(U.value=t,t){case"C":x.value=be,P.value="800px",b.value="800px";break;case"U":x.value=Ne,P.value="800px",b.value="800px";break;case"I":x.value=Pe,P.value="800px",b.value="850px";break}V.value=!0},Z=t=>{const e=l.value.findIndex(d=>d.itemCd===t);l.value.splice(e,1)};pe(async()=>{S.value=await k.getCodeList("order_type"),$.value=await k.getCodeList("status_Type"),F.value=await k.getCodeList("vat_type");const t=await J.getContractInfo(z);Object.assign(o,t.contractInfo),t.attachFileInfo!==null?_.value=t.attachFileInfo:_.value=[],l.value=t.itemList});const ee=()=>{q.push({name:"ContractList"})};return(t,e)=>{const d=u("v-breadcrumbs"),c=u("v-card-item"),m=u("v-date-input"),N=u("v-text-field"),p=u("v-col"),g=u("v-row"),D=u("v-select"),A=u("v-card-text"),te=u("v-card-subtitle"),T=u("v-btn"),ae=u("v-icon"),le=u("v-data-table-virtual"),ne=u("v-form"),ie=u("v-card"),oe=u("v-dialog");return E(),ve(ye,null,[y("div",{id:t.$attrs.id},null,8,Ce),a(d,{items:["MES","영업관리","주문신규"],class:"custom-breadcrumbs"}),a(ie,null,{default:i(()=>[a(c,{title:"주문서입력"}),a(ne,{ref:"vform",onSubmit:_e(Q,["prevent"])},{default:i(()=>[a(A,null,{default:i(()=>[a(g,null,{default:i(()=>[a(p,{class:"d-flex ga-2 pa-1"},{default:i(()=>[a(m,{modelValue:o.contractDate,"onUpdate:modelValue":e[0]||(e[0]=n=>o.contractDate=n),label:"주문일자",density:"compact","display-format":O(f),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"]),a(N,{modelValue:o.seq,"onUpdate:modelValue":e[1]||(e[1]=n=>o.seq=n),density:"compact",style:{width:"40px"},readonly:""},null,8,["modelValue"])]),_:1}),a(p,null,{default:i(()=>[a(m,{modelValue:o.expectedDueDate,"onUpdate:modelValue":e[2]||(e[2]=n=>o.expectedDueDate=n),label:"납기예정일자",density:"compact","display-format":O(f),variant:"underlined",style:{width:"200px"},"hide-details":""},null,8,["modelValue","display-format"])]),_:1}),a(p,null,{default:i(()=>[a(N,{modelValue:o.paymentCondition,"onUpdate:modelValue":e[3]||(e[3]=n=>o.paymentCondition=n),label:"결제조건",variant:"underlined",density:"compact",style:{width:"200px"},"hide-details":""},null,8,["modelValue"])]),_:1}),a(p,null,{default:i(()=>[a(N,{modelValue:o.managerName,"onUpdate:modelValue":e[4]||(e[4]=n=>o.managerName=n),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=n=>I("U")),style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(g,null,{default:i(()=>[a(p,{cols:"6"},{default:i(()=>[a(N,{modelValue:o.clientName,"onUpdate:modelValue":e[6]||(e[6]=n=>o.clientName=n),label:"고객사",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=n=>I("C"))},null,8,["modelValue"])]),_:1}),a(p,null,{default:i(()=>[a(D,{modelValue:o.vatType,"onUpdate:modelValue":e[8]||(e[8]=n=>o.vatType=n),label:"거래유형",items:F.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",style:{width:"200px"}},null,8,["modelValue","items"])]),_:1}),a(p,null,{default:i(()=>[a(D,{modelValue:o.orderType,"onUpdate:modelValue":e[9]||(e[9]=n=>o.orderType=n),label:"수주유형",items:S.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",style:{width:"200px"}},null,8,["modelValue","items"])]),_:1})]),_:1}),a(g,null,{default:i(()=>[a(p,{cols:"12"},{default:i(()=>[a(xe,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=n=>_.value=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(A,null,{default:i(()=>[a(g,null,{default:i(()=>[a(p,null,{default:i(()=>[a(te,null,{default:i(()=>e[14]||(e[14]=[ge(" - 품목 ")])),_:1})]),_:1}),a(p,{class:"d-flex ga-4 justify-end"},{default:i(()=>[a(T,{text:"추가 +",density:"compact",onClick:e[11]||(e[11]=n=>I("I"))})]),_:1})]),_:1}),a(g,null,{default:i(()=>[a(p,null,{default:i(()=>[a(le,{headers:W,items:l.value,density:"compact","item-value":"id",class:"custom-table no-padding-table"},{"item.statusType":i(({item:n})=>[a(D,{modelValue:n.statusType,"onUpdate:modelValue":s=>n.statusType=s,items:$.value,"item-title":"codeNm","item-value":"code",density:"compact",variant:"outlined",style:{width:"120px",height:"40px"}},null,8,["modelValue","onUpdate:modelValue","items"])]),"item.qty":i(({item:n,index:s})=>[w(y("input",{"onUpdate:modelValue":r=>l.value[s].qty=r,style:{"text-align":"right",width:"90%"},class:"custom-line",onBlur:r=>B(s)},null,40,ke),[[h,l.value[s].qty]])]),"item.unitPrice":i(({item:n,index:s})=>[w(y("input",{"onUpdate:modelValue":r=>l.value[s].unitPrice=r,style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line",onBlur:r=>B(s)},null,40,Ue),[[h,l.value[s].unitPrice]])]),"item.supplyPrice":i(({item:n,index:s})=>[w(y("input",{"onUpdate:modelValue":r=>l.value[s].supplyPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ie),[[h,l.value[s].supplyPrice]])]),"item.vatPrice":i(({item:n,index:s})=>[w(y("input",{"onUpdate:modelValue":r=>l.value[s].vatPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,De),[[h,l.value[s].vatPrice,void 0,{number:!0}]])]),"item.totPrice":i(({item:n,index:s})=>[w(y("input",{"onUpdate:modelValue":r=>l.value[s].totPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Te),[[h,l.value[s].totPrice,void 0,{number:!0}]])]),"item.etc":i(({item:n,index:s})=>[w(y("input",{"onUpdate:modelValue":r=>l.value[s].etc=r,type:"text",style:{"text-align":"left",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,qe),[[h,l.value[s].etc]])]),"item.actions":i(({item:n})=>[a(ae,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>Z(n.itemCd)},null,8,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1}),a(g,{class:"mt-2 mb-2"},{default:i(()=>[a(p,{class:"d-flex ga-4 justify-end"},{default:i(()=>[a(T,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),a(T,{text:"목록",class:"mr-3",onClick:ee})]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),a(oe,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=n=>V.value=n),width:P.value,height:b.value,persistent:""},{default:i(()=>[(E(),we(he(x.value),{id:t.id,onSelected:X,onCloseDialog:e[12]||(e[12]=n=>V.value=!1)},null,40,["id"]))]),_:1},8,["modelValue","width","height"])],64)}}},He=se(Se,[["__scopeId","data-v-f95d3163"]]);export{He as default};
