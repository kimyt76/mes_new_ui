import{s as M,a as Q}from"./index-Z2YNGKhZ.js";import{s as me}from"./index-D49h5Cbk.js";import{K as W,U as J,M as ce,L as fe,Z as K,A as c,V as ye,W as Z,a8 as L,H as X,e as Y,o as ee,p as t,h as a,l as n,G as te,a0 as b,y as $,a2 as ve,a7 as be,F as le,P as ge,t as k}from"./index-BCdxernO.js";import{a as we,b as xe,s as oe}from"./index-CKfU0QJd.js";import{s as ae}from"./index-WWuz9eST.js";import{s as ne}from"./index-DhHuXiFi.js";import{s as ie}from"./index-Dsa_8OmY.js";import{s as Ce}from"./index-BE87lW_G.js";import{A as x}from"./apiCommon-DQdCmI3G.js";import{A as z}from"./apiOrders-LBbh7QBG.js";import{i as se,d as de,m as Ve}from"./common-Ctgf_4Dl.js";import{e as _e}from"./exportToExcel-BIsrPQTg.js";import{s as he}from"./index-CEOpAmiF.js";import{s as Ne}from"./index-BGn1OEmN.js";import{C as De}from"./CommFileUpload-B0pXcOWW.js";import{I as Te}from"./ItemListMultiPop-BS5GtrW8.js";import{C as Ue}from"./ClientListPop-BQhfi3oc.js";import{U as Pe}from"./UserListPop-40qvmJxy.js";import je from"./ContractReg-CoWVY0Vk.js";import"./apiItem-B0JHHkd5.js";import"./apiBase-DJzL_JWR.js";import"./apiSystem-BBpYMteA.js";const Ie={class:"grid mb-2"},He={class:"col-3 flex align-items-center gap-2"},Se={class:"col-3"},Le={class:"col-3"},ke={class:"col-3"},$e={class:"grid mb-2"},Fe={class:"col-6"},qe={class:"col-3"},Re={class:"col-3"},Ae={class:"w-full align-items-center mt-3"},Ge={class:"flex justify-content-between align-items-center ml-2 mb-1 mt-2"},Oe={class:"w-full mt-2"},ze=["onClick"],Ee={class:"flex gap-2 justify-end pt-3"},Be={__name:"ContractDetailPop",setup(re){const F=J(),{userId:U}=ce(),{vError:N,vSuccess:P,vWarning:q}=fe(),C=K(null),g=c([]),d=ye("dialogRef"),p=c([]),D=c([]),j=c([]),I=c([]),V=c(!1),i=Z({contractDate:"",seq:"",expectedDueDate:"",clientName:"",clientId:"",managerName:"",managerId:"",paymentCondition:"",vatType:"",orderType:"",userId:U});L(()=>p.value.reduce((s,e)=>s+Number(e.qty||0),0));const l=L(()=>p.value.reduce((s,e)=>s+Number(e.supplyPrice||0),0)),H=L(()=>p.value.reduce((s,e)=>s+Number(e.vatPrice||0),0));L(()=>l.value+H.value);const S=async()=>{const s=new FormData;if(p.value<=0){vInfo("품목을 등록하세요");return}if(g.value<=0){vInfo("산출물을 등록하세요");return}try{const e={...i};s.append("contractInfo",JSON.stringify(e)),s.append("itemList",JSON.stringify(p.value)),g.value.forEach(r=>{r.file instanceof File&&s.append("attachFile",r.file)});const y=await z.saveContractInfo(s);P("저장되었습니다."),u()}catch(e){N(e.message)}},f=s=>{if(!Array.isArray(s))return;let e=p.value.length;const y=s.map((r,w)=>({itemCd:r.itemCd,itemName:r.itemName,unit:r.unit,prodType:r.prodType,qty:r.qty,unitPrice:r.unitPrice,supplyPrice:r.supplyPrice,vatPrice:r.vatPrice,totPrice:r.totPrice,orderCnt:r.orderCnt,statusType:r.statusType,etc:r.etc,orderDist:e+w+1}));p.value.length>0?p.value.push(...y):p.value=[...y]},_=s=>{console.log("index",s),p.value.splice(s,1)},T=()=>{V.value=!0},h=s=>{let e="";s==="C"?(e="고객사 목록",C.value=Ue):s==="U"&&(e="사용자 목록",C.value=Pe),F.open(C.value,{props:{header:e,modal:!0,draggable:!1,maximizable:!1,style:{overflow:"hidden"},pt:{root:{style:{overflow:"hidden"}},content:{style:{overflow:"hidden"}}}},onClose:y=>{s==="C"?(i.clientName=y.data.clientName,i.clientId=y.data.clientId):s==="U"&&(i.managerName=y.data.memberNm,i.managerId=y.data.userId)}})};X(async()=>{if(D.value=await x.getCodeList("order_type"),j.value=await x.getCodeList("vat_type"),I.value=await x.getCodeList("status_Type"),se(d.value.data))i.contractDate=de(),i.seq=await x.getNextSeq("tb_contract_mst","contract_date",i.contractDate);else{const s=await z.getContractInfo(d.value.data);Object.assign(i,s.contractInfo),p.value=s.itemList,s.attachFileInfo!==null?g.value=R(s.attachFileInfo):g.value=[]}});const R=s=>(s||[]).map(e=>({...e,flag:"S"})),u=()=>{d.value.close()};return(s,e)=>{const y=ie,r=ne,w=Ne,A=ae,E=xe,B=we,G=oe,ue=he,O=te,m=M,pe=Q;return ee(),Y(le,null,[t(ue,{style:{width:"100rem",height:"8rem"}},{content:n(()=>[a("div",Ie,[a("div",He,[t(r,{variant:"on"},{default:n(()=>[t(y,{modelValue:i.contractDate,"onUpdate:modelValue":e[0]||(e[0]=o=>i.contractDate=o),"show-icon":""},null,8,["modelValue"]),e[14]||(e[14]=a("label",null,"주문일자",-1))]),_:1}),e[16]||(e[16]=a("span",{class:"center-dash"},"-",-1)),t(r,{variant:"on"},{default:n(()=>[t(w,{modelValue:i.seq,"onUpdate:modelValue":e[1]||(e[1]=o=>i.seq=o),inputStyle:{width:"50px","text-align":"center"}},null,8,["modelValue"]),e[15]||(e[15]=a("label",null,"연번",-1))]),_:1})]),a("div",Se,[t(r,{variant:"on"},{default:n(()=>[t(y,{modelValue:i.expectedDueDate,"onUpdate:modelValue":e[2]||(e[2]=o=>i.expectedDueDate=o),fluid:"","show-icon":""},null,8,["modelValue"]),e[17]||(e[17]=a("label",null,"납기예정일자",-1))]),_:1})]),a("div",Le,[t(r,{variant:"on"},{default:n(()=>[t(A,{modelValue:i.paymentCondition,"onUpdate:modelValue":e[3]||(e[3]=o=>i.paymentCondition=o),class:"w-full",readonly:""},null,8,["modelValue"]),e[18]||(e[18]=a("label",null,"결제조건",-1))]),_:1})]),a("div",ke,[t(r,{variant:"on"},{default:n(()=>[t(B,{iconPosition:"left"},{default:n(()=>[t(A,{modelValue:i.managerName,"onUpdate:modelValue":e[4]||(e[4]=o=>i.managerName=o),class:"w-full"},null,8,["modelValue"]),t(E,{class:"pi pi-search",onClick:e[5]||(e[5]=o=>h("U"))})]),_:1}),e[19]||(e[19]=a("label",null,"담당자",-1))]),_:1})])]),a("div",$e,[a("div",Fe,[t(r,{variant:"on"},{default:n(()=>[t(B,{iconPosition:"left"},{default:n(()=>[t(A,{modelValue:i.clientName,"onUpdate:modelValue":e[6]||(e[6]=o=>i.clientName=o),class:"w-full"},null,8,["modelValue"]),t(E,{class:"pi pi-search",onClick:e[7]||(e[7]=o=>h("C"))})]),_:1}),e[20]||(e[20]=a("label",null,"고객사",-1))]),_:1})]),a("div",qe,[t(r,{variant:"on"},{default:n(()=>[t(G,{modelValue:i.vatType,"onUpdate:modelValue":e[8]||(e[8]=o=>i.vatType=o),options:j.value,optionLabel:"codeNm",optionValue:"code",class:"w-full"},null,8,["modelValue","options"]),e[21]||(e[21]=a("label",null,"거래유형",-1))]),_:1})]),a("div",Re,[t(r,{variant:"on"},{default:n(()=>[t(G,{modelValue:i.orderType,"onUpdate:modelValue":e[9]||(e[9]=o=>i.orderType=o),options:D.value,optionLabel:"codeNm",optionValue:"code",class:"w-full"},null,8,["modelValue","options"]),e[22]||(e[22]=a("label",null,"수주유형",-1))]),_:1})])])]),_:1}),a("div",Ae,[t(De,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=o=>g.value=o),"download-url":"/api/lab/material/file/download",accept:".pdf,.xlsx,.xls,.png,.jpg,.jpeg",multiple:!0,onError:e[11]||(e[11]=o=>console.error(o))},null,8,["modelValue"])]),a("div",Ge,[e[23]||(e[23]=a("h5",{class:"m-0"},"- 품목",-1)),t(O,{label:"추가+",onClick:T,class:"p-button-xm"})]),a("div",Oe,[t(pe,{value:p.value,selectionMode:"single",class:"my-table","scroll-height":"400px","show-gridlines":"",onRowSelect:f},{default:n(()=>[t(m,{field:"poNo",header:"PO No",style:{width:"100px"},pt:{columnHeaderContent:"justify-center"}}),t(m,{field:"itemCd",header:"품목코드",style:{width:"80px"},pt:{columnHeaderContent:"justify-center"}}),t(m,{field:"itemName",header:"품목명",style:b([{width:"300px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}}),t(m,{field:"spec",header:"규격",style:b([{width:"70px"},{"text-align":"center"}]),pt:{columnHeaderContent:"justify-center"}},{default:n(()=>[...e[24]||(e[24]=[$(" >",-1)])]),_:1}),t(m,{field:"itemGrp1",header:"제품유형",style:b([{width:"80px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}}),t(m,{field:"orderQty",header:"수량",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:n(o=>[t(w,{modelValue:o.data.orderQty,"onUpdate:modelValue":[v=>o.data.orderQty=v,()=>s.onChangeRow(o.data)],class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"90px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{field:"inPrice",header:"단가",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:n(o=>[t(w,{modelValue:o.data.inPrice,"onUpdate:modelValue":[v=>o.data.inPrice=v,()=>s.onChangeRow(o.data)],class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"90px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{field:"supplyPrice",header:"공급가액",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:n(o=>[t(w,{modelValue:o.data.supplyPrice,"onUpdate:modelValue":v=>o.data.supplyPrice=v,class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"120px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{field:"vatPrice",header:"부가세",style:{width:"60px"},pt:{columnHeaderContent:"justify-center"}},{body:n(o=>[t(w,{modelValue:o.data.vatPrice,"onUpdate:modelValue":v=>o.data.vatPrice=v,class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"80px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{field:"totPrice",header:"합계",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:n(o=>[t(w,{modelValue:o.data.totPrice,"onUpdate:modelValue":v=>o.data.totPrice=v,class:"w-full",min:0,maxFractionDigits:0,useGrouping:!0,inputStyle:{width:"120px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(m,{field:"orderCnt",header:"차수",style:b([{width:"60px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}}),t(m,{field:"statusType",header:"진행상태",style:b([{width:"130px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}},{body:n(o=>[t(G,{modelValue:o.data.statusType,"onUpdate:modelValue":v=>o.data.statusType=v,class:"w-full",options:I.value,"option-label":"codeNm","option-value":"code"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1}),t(m,{field:"etc",header:"비고",style:b([{width:"100px"},{"text-align":"right"}]),pt:{columnHeaderContent:"justify-center"}}),t(m,{field:"actions",header:"-",style:b([{width:"20px"},{"text-align":"center"}]),pt:{columnHeaderContent:"justify-center"}},{body:n(o=>[a("i",{class:"pi pi-trash cursor-pointer",onClick:v=>_(o.index)},null,8,ze)]),_:1})]),_:1},8,["value"])]),a("div",Ee,[t(O,{label:"저장",class:"btn-save",onClick:S}),t(O,{label:"닫기",onClick:u})]),t(ve(be),{visible:V.value,"onUpdate:visible":e[13]||(e[13]=o=>V.value=o),header:"품목 목록"},{default:n(()=>[t(Te,{onSelected:f,onClose:e[12]||(e[12]=o=>V.value=!1)})]),_:1},8,["visible"])],64)}}},Me=W(Be,[["__scopeId","data-v-007df50d"]]),Qe={class:"flex flex-wrap items-center gap-2 w-full"},We={class:"flex items-center justify-end gap-2 mb-2"},Je=["onClick"],Ke={__name:"ContractList",setup(re){const F=J(),U=c(null),N=c([]),P=c([]),q=c([]),C=c([]),g=K(null),d=Z({strDate:"",toDate:"",itemCd:"",itemName:"",managerName:"",customerName:"",orderType:"",vatType:"",statusType:""}),p=i=>{let l="";se(i)?(l="주문서 등록",g.value=je):(l="주문서 상세",g.value=Me),F.open(g,{props:{header:l,modal:!0,maximizable:!1,draggable:!1,style:{width:"90vw",maxWidth:"1800px",height:"800px",overflow:"hidden"},pt:{root:{style:{overflow:"hidden"}},content:{style:{overflow:"hidden"}}}},data:i,onClose:H=>{D()}})},D=async()=>{const i={...d};N.value=await z.getContractList(i)};X(async()=>{P.value=await x.getCodeList("status_type"),C.value=await x.getCodeList("order_type"),q.value=await x.getCodeList("vat_type"),d.toDate=de(),d.strDate=Ve(d.toDate)});const j=c({icon:"pi pi-home"}),I=c([{label:"주문서관리"},{label:"주문서목록"}]),V=()=>{var l;const i=((l=U.value)==null?void 0:l.columns)??[];if(!i.length){console.warn("No Columns Found");return}_e(N.value,"주문서 리스트",i)};return(i,l)=>{const H=Ce,S=ie,f=ne,_=ae,T=oe,h=te,R=me,u=M,s=Q;return ee(),Y(le,null,[t(H,{home:j.value,model:I.value},null,8,["home","model"]),a("form",{onSubmit:ge(D,["prevent"]),class:"space-y-4"},[t(R,{class:"flex flex-wrap mt-2 mb-2 gap-1 w-full"},{start:n(()=>[a("div",Qe,[t(f,{variant:"on"},{default:n(()=>[t(S,{modelValue:d.strDate,"onUpdate:modelValue":l[0]||(l[0]=e=>d.strDate=e),inputId:"on_label",showIcon:"",iconDisplay:"input"},null,8,["modelValue"]),l[10]||(l[10]=a("label",{for:"on_label"},"시작",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(S,{modelValue:d.toDate,"onUpdate:modelValue":l[1]||(l[1]=e=>d.toDate=e),inputId:"on_label",showIcon:"",iconDisplay:"input"},null,8,["modelValue"]),l[11]||(l[11]=a("label",{for:"on_label"},"종료",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(_,{id:"on_label",modelValue:d.itemName,"onUpdate:modelValue":l[2]||(l[2]=e=>d.itemName=e),style:{width:"180px"}},null,8,["modelValue"]),l[12]||(l[12]=a("label",{for:"on_label"},"품목명",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(_,{id:"on_label1",modelValue:d.itemCd,"onUpdate:modelValue":l[3]||(l[3]=e=>d.itemCd=e),style:{width:"120px"}},null,8,["modelValue"]),l[13]||(l[13]=a("label",{for:"on_label1"},"품목코드",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(_,{id:"on_label1",modelValue:d.managerName,"onUpdate:modelValue":l[4]||(l[4]=e=>d.managerName=e),style:{width:"120px"}},null,8,["modelValue"]),l[14]||(l[14]=a("label",{for:"on_label1"},"담당자명",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(_,{id:"on_label1",modelValue:d.clientName,"onUpdate:modelValue":l[5]||(l[5]=e=>d.clientName=e),style:{width:"180px"}},null,8,["modelValue"]),l[15]||(l[15]=a("label",{for:"on_label1"},"고객사명",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(T,{modelValue:d.statusType,"onUpdate:modelValue":l[6]||(l[6]=e=>d.statusType=e),options:P.value,optionLabel:"codeNm",optionValue:"code",style:{width:"90px"}},null,8,["modelValue","options"]),l[16]||(l[16]=a("label",{for:"on_label"},"진행상태",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(T,{modelValue:d.orderType,"onUpdate:modelValue":l[7]||(l[7]=e=>d.orderType=e),options:C.value,optionLabel:"codeNm",optionValue:"code",style:{width:"90px"}},null,8,["modelValue","options"]),l[17]||(l[17]=a("label",{for:"on_label"},"수주유형",-1))]),_:1}),t(f,{variant:"on"},{default:n(()=>[t(T,{modelValue:d.vatType,"onUpdate:modelValue":l[8]||(l[8]=e=>d.vatType=e),options:q.value,optionLabel:"codeNm",optionValue:"code",style:{width:"90px"}},null,8,["modelValue","options"]),l[18]||(l[18]=a("label",{for:"on_label"},"거래유형",-1))]),_:1}),t(h,{label:"검색",icon:"pi pi-search",type:"submit",class:"bg-blue-500 text-white hover:bg-blue-600"})])]),_:1})],32),a("div",We,[t(h,{label:"신규",icon:"pi pi-plus",severity:"secondary",onClick:l[9]||(l[9]=e=>p(""))}),t(h,{label:"엑셀",icon:"pi pi-file-excel",severity:"success",onClick:V})]),a("div",null,[t(s,{ref_key:"dt",ref:U,value:N.value,paginator:"",rows:20,rowsPerPageOptions:[20,30,40],scrollHeight:"700px",scrollable:"",showGridlines:"",tableStyle:"w-full; table-layout: fixed;",class:"my-table"},{default:n(()=>[t(u,{field:"contractDateSeq",header:"일자-No",frozen:"",style:{width:"130px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"poNo",header:"PO No",frozen:"",style:{width:"130px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"itemCd",header:"품목코드",frozen:"",style:{width:"110px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"itemName",header:"품목명",frozen:"",style:b([{width:"350px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}},{body:n(e=>[a("div",{onClick:y=>p(e.data.contractId),class:"clickable-cell"},k(e.data.itemName),9,Je)]),_:1}),t(u,{field:"expectedDueDate",header:"납기예정일자",style:{width:"110px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"clientName",header:"고객사명",style:{width:"250px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"managerName",header:"담당자명",style:{width:"90px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"orderType",header:"수주유형",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"qty",header:"수량",pt:{columnHeaderContent:"justify-center"},style:b([{width:"100px"},{"text-align":"right"}])},{body:n(e=>[$(k(Number(e.data.qty).toLocaleString()),1)]),_:1}),t(u,{field:"unitPrice",header:"단가",pt:{columnHeaderContent:"justify-center"},style:b([{width:"100px"},{"text-align":"right"}])},{body:n(e=>[$(k(Number(e.data.unitPrice).toLocaleString()),1)]),_:1}),t(u,{field:"supplyPrice",header:"공급가액",pt:{columnHeaderContent:"justify-center"},style:b([{width:"100px"},{"text-align":"right"}])},{body:n(e=>[$(k(Number(e.data.supplyPrice).toLocaleString()),1)]),_:1}),t(u,{field:"prodType",header:"제품유형",style:{width:"100px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"statusType",header:"진행상태",style:{width:"80px"},pt:{columnHeaderContent:"justify-center"}}),t(u,{field:"paymentCondition",header:"결재조건",style:{width:"80px"},pt:{columnHeaderContent:"justify-center"}})]),_:1},8,["value"])])],64)}}},wt=W(Ke,[["__scopeId","data-v-55524803"]]);export{wt as default};
