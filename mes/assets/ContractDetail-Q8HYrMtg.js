import{_ as ue,a as re,u as me,x as ce,r as f,k as pe,m as ve,B as P,p as ye,n as fe,c as S,f as d,g as l,d as m,w as i,F as M,e as ge,o as k,j as he,i as _e,t as b,D as g,G as h,v as we,E as Ve,b as xe,y as be}from"./index-Be8ZRtMe.js";import{A as R}from"./apiOrders-BV9f5KE8.js";import{_ as O}from"./DateSinglePicker-MhSv-Vru.js";import{C as Ce}from"./CustomerListPop-ZmNksim-.js";import{_ as Ne}from"./UserListPop-CsvKPMu9.js";import{_ as Pe}from"./StorageListPop-CxDhn6Hi.js";import{_ as ke}from"./MultiFileUpload-BeeAPDwc.js";import{_ as Ue}from"./ItemListSinglePop-Bse8Tcry.js";import{A as E}from"./apiCommon-B9fwy2tv.js";import{j as Se,k as J}from"./common-IBXzpVzr.js";import{_ as Ie}from"./ItemListMultiPop-RD76U6QR.js";import"./format-CBpsKyOP.js";import"./apiBase-BOHAoysR.js";import"./filedownLoad-BQbSUCvP.js";import"./apiItem-B0_6p2jT.js";const De=["id"],$e={class:"d-flex ga-4 justify-end"},qe=["onUpdate:modelValue","onDblclick"],Fe=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],Te=["onUpdate:modelValue","onBlur"],Be=["onUpdate:modelValue","onBlur"],Ae=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],Re=["onUpdate:modelValue"],Oe={class:"summary-row"},Ee={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Je={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},We={style:{width:"100px",height:"30px","text-align":"right","font-weight":"bold"}},ze={style:{width:"150px",height:"30px","text-align":"right","font-weight":"bold"}},Ge={class:"d-flex ga-4 justify-end"},Qe={__name:"ContractDetail",setup(He){const{userId:W}=re(),{vError:z,vSuccess:G,vWarning:Ke}=me(),Q=ge(),x=ce(null),y=f(!1);f(!1);const H=pe().params.id,K=f(null);let C=f("");const w=f([]),n=f([]),I=f([]),D=f([]),o=ve({contractDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",transactionType:"",paymentCondition:"",expiryDate:"",tradingMethod:"",currencyType:"",dueDate:"",contractId:"",attachFileId:"",userId:W}),X=f([{title:"품목코드 ",key:"itemCd",align:"center",width:"100px"},{title:"품목명",key:"itemName",align:"center",width:"450px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"수량",key:"qty",align:"center",width:"80px"},{title:"단가",key:"unitPrice",align:"center",width:"80px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"적용",key:"etc",align:"center",width:"120px"},{title:"-",key:"actions",align:"center",width:10}]),Y=P(()=>n.value.reduce((t,e)=>t+Number(e.qty||0),0)),$=P(()=>n.value.reduce((t,e)=>t+Number(e.supplyPrice||0),0)),q=P(()=>n.value.reduce((t,e)=>t+Number(e.vatPrice||0),0)),Z=P(()=>$.value+q.value),F=t=>{let e=Number(n.value[t].qty),c=Number(n.value[t].unitPrice);!isNaN(e)&&!isNaN(c)?n.value[t].supplyPrice=e*c:n.value[t].supplyPrice=0,isNaN(n.value[t].supplyPrice)?n.value[t].vatPrice=0:n.value[t].vatPrice=J(n.value[t].supplyPrice)};ye(()=>o.transactionType,async t=>{o.transactionType==="VRN"?n.value.map(e=>{e.vatPrice=0}):n.value.map(e=>{e.vatPrice=J(e.supplyPrice)})});const j=()=>{y.value=!0},ee=t=>{if(!Array.isArray(t))return;const e=n.value.length,c=t.map((p,v)=>({itemCd:p.itemCd,itemName:p.itemName,unit:p.unit,qty:p.qty,unitPrice:p.unitPrice,supplyPrice:p.supplyPrice,vatPrice:p.vatPrice,etc:p.etc,orderDist:e+v+1}));n.value.length>0?n.value.push(...c):n.value=[...c]},te=t=>{switch(C.value){case"C":o.customerName=t.customerName,o.customerCd=t.customerCd,o.managerName=t.memberCd,o.managerId=t.memberCd,o.tradingMethod=t.tradingMethod;break;case"U":o.managerName=t.memberNm,o.managerId=t.userId;break;case"S":o.descStorageName=t.storageName,o.descStorageCd=t.storageCd;break}C.value="",y.value=!1},le=async()=>{const t=new FormData;try{const e={...o};t.append("contractInfo",JSON.stringify(e)),t.append("itemList",JSON.stringify(n.value));const c=[];w.value.forEach(v=>{v.flag==="N"?t.append("newFiles",v.file):v.flag==="D"&&c.push({attachFileId:v.attachFileId,seq:v.seq})}),t.append("keptFiles",JSON.stringify(w.value.filter(v=>v.flag==="S"))),c.length>0&&t.append("deleteFiles",new Blob([JSON.stringify(c)],{type:"application/json"}));const p=await R.updateContractInfo(t);G(p),L()}catch(e){z(e.message)}},ae=t=>{const e=n.value.findIndex(c=>c.id===t.id);e>-1&&n.value.splice(e,1)},L=async()=>{D.value=await E.getCodeList("currency_type"),I.value=await E.getCodeList("vat_rate");const t=await R.getContractInfo(H);Object.assign(o,t.contractInfo),n.value=t.itemList,t.attachFileInfo!==null?w.value=t.attachFileInfo:w.value=[],n.value.length};fe(async()=>{L()});const N=t=>{switch(C.value=t,t){case"C":x.value=Ce;break;case"U":x.value=Ne;break;case"S":x.value=Pe;break;default:C.value="I",K.value=t,x.value=Ue;break}y.value=!0},ne=()=>{Q.push({name:"ContractList"})};return(t,e)=>{const c=m("v-breadcrumbs"),p=m("v-card-item"),v=m("v-date-input"),V=m("v-text-field"),r=m("v-col"),_=m("v-row"),T=m("v-select"),B=m("v-card-text"),U=m("v-btn"),ie=m("v-icon"),oe=m("v-data-table-virtual"),se=m("v-form"),de=m("v-card"),A=m("v-dialog");return k(),S(M,null,[d("div",{id:t.$attrs.id},null,8,De),l(c,{items:["MES","영업관리","주문상세"]}),l(de,null,{default:i(()=>[l(p,{title:"주문서상세"}),l(se,{ref:"vform",onSubmit:he(le,["prevent"])},{default:i(()=>[l(B,null,{default:i(()=>[l(_,null,{default:i(()=>[l(r,{class:"d-flex flex-row align-center",style:{gap:"4px"}},{default:i(()=>[l(v,{modelValue:o.contractDate,"onUpdate:modelValue":e[0]||(e[0]=a=>o.contractDate=a),label:"주문일자",density:"compact","display-format":_e(Se),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"]),l(V,{modelValue:o.seq,"onUpdate:modelValue":e[1]||(e[1]=a=>o.seq=a),density:"compact",style:{width:"40px","max-width":"60px","min-width":"0"},class:"mr-10 mb-2",readonly:""},null,8,["modelValue"])]),_:1}),l(r),l(r,null,{default:i(()=>[l(O,{modelValue:o.expiryDate,"onUpdate:modelValue":e[2]||(e[2]=a=>o.expiryDate=a),title:"유효기간",density:"compact",width:"120"},null,8,["modelValue"])]),_:1}),l(r,null,{default:i(()=>[l(O,{modelValue:o.dueDate,"onUpdate:modelValue":e[3]||(e[3]=a=>o.dueDate=a),title:"납기일자",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{density:""},{default:i(()=>[l(r,{cols:"6"},{default:i(()=>[l(V,{modelValue:o.customerName,"onUpdate:modelValue":e[4]||(e[4]=a=>o.customerName=a),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=a=>N("C"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:i(()=>[l(V,{modelValue:o.managerName,"onUpdate:modelValue":e[6]||(e[6]=a=>o.managerName=a),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=a=>N("U"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:i(()=>[l(V,{modelValue:o.descStorageName,"onUpdate:modelValue":e[8]||(e[8]=a=>o.descStorageName=a),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[9]||(e[9]=a=>N("S"))},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{density:""},{default:i(()=>[l(r,null,{default:i(()=>[l(T,{modelValue:o.transactionType,"onUpdate:modelValue":e[10]||(e[10]=a=>o.transactionType=a),label:"거래유형",items:I.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:i(()=>[l(T,{modelValue:o.currencyType,"onUpdate:modelValue":e[11]||(e[11]=a=>o.currencyType=a),label:"통화",items:D.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:i(()=>[l(V,{modelValue:o.paymentCondition,"onUpdate:modelValue":e[12]||(e[12]=a=>o.paymentCondition=a),label:"결재조건",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),l(r,null,{default:i(()=>[l(V,{modelValue:o.tradingMethod,"onUpdate:modelValue":e[13]||(e[13]=a=>o.tradingMethod=a),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,null,{default:i(()=>[l(r,{cols:"12"},{default:i(()=>[l(ke,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=a=>w.value=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(B,null,{default:i(()=>[l(_,{density:""},{default:i(()=>[l(r,null,{default:i(()=>[d("div",$e,[l(U,{text:"추가 +",density:"compact",onClick:j})])]),_:1})]),_:1}),l(_,null,{default:i(()=>[l(r,{cols:"12"},{default:i(()=>[l(oe,{headers:X.value,items:n.value,"item-value":"id"},{headers:i(({columns:a})=>[d("tr",null,[(k(!0),S(M,null,we(a,s=>(k(),S("th",{key:s.key,class:"custom-header",style:Ve([{height:"30px"},{width:s.width+"px",minWidth:s.width+"px",maxWidth:s.width+"px"}])},b(s.title),5))),128))])]),"item.itemCd":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].itemCd=u,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",onDblclick:u=>N(s)},null,40,qe),[[h,n.value[s].itemCd]])]),"item.itemName":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].itemName=u,style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",readonly:""},null,8,Fe),[[h,n.value[s].itemName]])]),"item.unit":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].unit=u,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Le),[[h,n.value[s].unit]])]),"item.qty":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].qty=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line",onBlur:u=>F(s)},null,40,Te),[[h,n.value[s].qty]])]),"item.unitPrice":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].unitPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line",onBlur:u=>F(s)},null,40,Be),[[h,n.value[s].unitPrice]])]),"item.supplyPrice":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].supplyPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Ae),[[h,n.value[s].supplyPrice]])]),"item.vatPrice":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].vatPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Me),[[h,n.value[s].vatPrice,void 0,{number:!0}]])]),"item.etc":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].etc=u,type:"text",style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Re),[[h,n.value[s].etc]])]),"item.actions":i(({item:a})=>[l(ie,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>ae(a)},null,8,["onClick"])]),"body.append":i(()=>[d("tr",Oe,[e[19]||(e[19]=d("td",{style:{width:"100px",height:"30px"}},null,-1)),e[20]||(e[20]=d("td",{style:{width:"250px",height:"30px"}},null,-1)),e[21]||(e[21]=d("td",{style:{width:"80px",height:"30px"}},null,-1)),d("td",Ee,b(Y.value.toLocaleString()),1),e[22]||(e[22]=d("td",{style:{width:"110px"}},null,-1)),d("td",Je,b($.value.toLocaleString()),1),d("td",We,b(q.value.toLocaleString()),1),d("td",ze,b(Z.value.toLocaleString()),1),e[23]||(e[23]=d("td",{style:{height:"30px"}},null,-1))])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),l(_,{class:"mt-2 mb-2"},{default:i(()=>[l(r,null,{default:i(()=>[d("div",Ge,[l(U,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),l(U,{text:"목록",class:"mr-3",onClick:ne})])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(A,{modelValue:y.value,"onUpdate:modelValue":e[16]||(e[16]=a=>y.value=a),width:"800px",height:"800px",persistent:""},{default:i(()=>[(k(),xe(be(x.value),{id:t.id,onSelected:te,onCloseDialog:e[15]||(e[15]=a=>y.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"]),l(A,{modelValue:y.value,"onUpdate:modelValue":e[18]||(e[18]=a=>y.value=a),width:"800",height:"800",persistent:""},{default:i(()=>[l(Ie,{onSelected:ee,onCloseDialog:e[17]||(e[17]=a=>y.value=!1)})]),_:1},8,["modelValue"])],64)}}},ct=ue(Qe,[["__scopeId","data-v-1c99d127"]]);export{ct as default};
