import{b as le,s as R,a as T}from"./index-Z2YNGKhZ.js";import{s as ae}from"./index-D49h5Cbk.js";import{K as E,M as ne,L as oe,A as f,V as ie,W as B,H as J,e as K,o as Y,p as e,h as a,l as i,G as q,a0 as C,a7 as se,F as z,U as de,P as re,t as k,y as G}from"./index-BCdxernO.js";import{s as W}from"./index-DhHuXiFi.js";import{s as Q}from"./index-WWuz9eST.js";import{s as ue}from"./index-BE87lW_G.js";import{A as $}from"./apiLab-DBKUW3x6.js";import{s as me}from"./index-Dsa_8OmY.js";import{s as pe}from"./index-CEOpAmiF.js";import{s as ce}from"./index-BGn1OEmN.js";import{s as fe}from"./index-CKfU0QJd.js";import{A as ye}from"./apiCommon-DQdCmI3G.js";import{C as ge}from"./CommFileUpload-B0pXcOWW.js";import{i as O,d as ve}from"./common-Ctgf_4Dl.js";import{I as be}from"./IngredientistPop-D_P0asTf.js";const Ce={class:"grid mb-2"},we={class:"col-3"},xe={class:"col-6"},he={class:"col-3"},Ve={class:"grid mb-2"},_e={class:"col-3"},Ne={class:"col-6"},Ie={class:"col-3"},je={class:"grid mb-2"},He={class:"col-3"},Ue={class:"col-3"},De={class:"flex justify-content-between align-items-center ml-2 mb-1 mt-2"},Se=["onClick"],Fe={class:"w-full align-items-center mt-3"},Le={class:"flex justify-content-between align-items-center ml-2 mb-1 mt-2"},ke={class:"flex gap-2 justify-end pt-3"},$e={__name:"MaterialDetailPop",setup(X){const{userId:I}=ne(),{vError:j,vSuccess:b,vWarning:P}=oe(),h=f([]),w=f(!1),H=ie("dialogRef"),y=f([]),x=f([]),g=f([]),d=f(""),S=f(""),n=B({itemCd:"",itemName:"",unit:"",spec:"",customerName:"",customerCd:"",vegan:"",halal:"",rspo:"",inPrice:0,outPrice:0,userId:I}),_=async()=>{var t,p;const o=new FormData;try{const s={itemCd:n.itemCd,historyId:S.value,attachFileId:d.value,userId:I};o.append("materialInfo",JSON.stringify(s)),o.append("materialList",JSON.stringify(y.value)),o.append("historyList",JSON.stringify(x.value));const V=[];h.value.forEach(c=>{c.flag==="N"?o.append("newFiles",c.file):c.flag==="D"&&V.push({attachFileId:c.attachFileId,seq:c.seq})}),o.append("keptFiles",JSON.stringify(h.value.filter(c=>c.flag==="S"))),V.length>0&&o.append("deleteFiles",new Blob([JSON.stringify(V)],{type:"application/json"}));const N=await $.saveMaterialInfo(o);b(N)}catch(s){j(((p=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:p.message)||"저장 중 오류가 발생했습니다.")}},U=o=>{if(!Array.isArray(o))return;let t=y.value.length;const p=o.map((s,V)=>({id:t++,ingredientCode:s.ingredientCode,krIngredientName:s.krIngredientName,enIngredientName:s.enIngredientName,inContent:"",outContent:"",casNo:s.casNo,functionNm:s.functionNm,limitCountry:s.limitCountry,banCountry:s.banCountry}));y.value.length>0?y.value.push(...p):y.value=[...p]},F=()=>{x.value.push({orderDist:x.value.length+1,historyComment:"",updName:"",updDate:ve(),orderDist:x.value.length+1})},m=o=>{y.value.splice(o,1)},L=()=>{w.value=!0};J(async()=>{g.value=await ye.getCodeList("ITEM_GRP1");const o=await $.getMaterialInfo(H.value.data);Object.assign(n,{...o.itemInfo,vegan:o.itemInfo.vegan==="Y",halal:o.itemInfo.halal==="Y",rspo:o.itemInfo.rspo==="Y"}),x.value=o.historyList,O(o.fileList)||(h.value=r(o.fileList),d.value=o.materialInfo.attachFileId),O(o.materialList)||(y.value=o.materialList)});const r=o=>(o||[]).map(t=>({...t,flag:"S"})),M=()=>{H.value.close()};return(o,t)=>{const p=Q,s=W,V=fe,N=le,c=ce,Z=pe,D=q,u=R,A=T,ee=me,te=se;return Y(),K(z,null,[e(Z,{style:{width:"110rem",height:"11rem"}},{content:i(()=>[a("div",Ce,[a("div",we,[e(s,{variant:"on"},{default:i(()=>[e(p,{modelValue:n.itemCd,"onUpdate:modelValue":t[0]||(t[0]=l=>n.itemCd=l),class:"w-full",readonly:""},null,8,["modelValue"]),t[14]||(t[14]=a("label",null,"품목코드",-1))]),_:1})]),a("div",xe,[e(s,{variant:"on"},{default:i(()=>[e(p,{modelValue:n.itemName,"onUpdate:modelValue":t[1]||(t[1]=l=>n.itemName=l),class:"w-full",readonly:""},null,8,["modelValue"]),t[15]||(t[15]=a("label",null,"품목명",-1))]),_:1})]),a("div",he,[e(s,{variant:"on"},{default:i(()=>[e(p,{modelValue:n.unit,"onUpdate:modelValue":t[2]||(t[2]=l=>n.unit=l),class:"w-full",readonly:""},null,8,["modelValue"]),t[16]||(t[16]=a("label",null,"단위",-1))]),_:1})])]),a("div",Ve,[a("div",_e,[e(s,{variant:"on"},{default:i(()=>[e(V,{modelValue:n.itemGrp1,"onUpdate:modelValue":t[3]||(t[3]=l=>n.itemGrp1=l),options:g.value,optionLabel:"codeNm",optionValue:"code",class:"w-full"},null,8,["modelValue","options"]),t[17]||(t[17]=a("label",null,"거래유형",-1))]),_:1})]),a("div",Ne,[e(s,{variant:"on"},{default:i(()=>[e(p,{modelValue:n.customerName,"onUpdate:modelValue":t[4]||(t[4]=l=>n.customerName=l),class:"w-full",readonly:""},null,8,["modelValue"]),t[18]||(t[18]=a("label",null,"거래처명",-1))]),_:1})]),a("div",Ie,[e(N,{modelValue:n.vegan,"onUpdate:modelValue":t[5]||(t[5]=l=>n.vegan=l),name:"Vegan",binary:"",readonly:""},null,8,["modelValue"]),t[19]||(t[19]=a("label",null," Vegan ",-1)),e(N,{modelValue:n.strDatel,"onUpdate:modelValue":t[6]||(t[6]=l=>n.strDatel=l),name:"halal",binary:"",readonly:""},null,8,["modelValue"]),t[20]||(t[20]=a("label",null," Halal ",-1)),e(N,{modelValue:n.rspo,"onUpdate:modelValue":t[7]||(t[7]=l=>n.rspo=l),name:"RSPO",binary:"",readonly:""},null,8,["modelValue"]),t[21]||(t[21]=a("label",null," RSPO ",-1))])]),a("div",je,[a("div",He,[e(s,{variant:"on"},{default:i(()=>[e(c,{modelValue:n.inPrice,"onUpdate:modelValue":t[8]||(t[8]=l=>n.inPrice=l),class:"w-full"},null,8,["modelValue"]),t[22]||(t[22]=a("label",null,"입고단가",-1))]),_:1})]),a("div",Ue,[e(s,{variant:"on"},{default:i(()=>[e(c,{modelValue:n.outPrice,"onUpdate:modelValue":t[9]||(t[9]=l=>n.outPrice=l),class:"w-full"},null,8,["modelValue"]),t[23]||(t[23]=a("label",null,"출고단가",-1))]),_:1})])])]),_:1}),a("div",De,[t[24]||(t[24]=a("h5",{class:"m-0"},"- 성분코드",-1)),e(D,{label:"추가+",onClick:L,class:"p-button-xm"})]),a("div",null,[e(A,{value:y.value,"scroll-height":"400px",scrollable:"",showGridlines:"",class:"my-table"},{default:i(()=>[e(u,{field:"ingredientCode",header:"성분코드",style:C([{"text-align":"center"},{width:"70px"}]),pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"krIngredientName",header:"구문성분명",style:{width:"280px"},pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"enIngredientName",header:"영어성분명",style:{width:"280px"},pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"inContent",header:"국내함량",style:{width:"70px"},pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[e(c,{modelValue:l.data.inContent,"onUpdate:modelValue":v=>l.data.inContent=v,class:"w-full",min:0,minFractionDigits:0,maxFractionDigits:7,useGrouping:!1,inputStyle:{width:"50px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{field:"outContent",header:"수출용함량",style:{width:"90px"},pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[e(c,{modelValue:l.data.outContent,"onUpdate:modelValue":v=>l.data.outContent=v,class:"w-full",min:0,":minFractionDigits":0,maxFractionDigits:7,useGrouping:!1,inputStyle:{width:"50px","text-align":"right"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{field:"casNo",header:"CAS No.",style:{width:"100px"},pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"functionNm",header:"funciton",style:{width:"100px"},pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"limitCountry",header:"한도국가",style:{width:"100px"},pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"banCountry",header:"금지국가",style:{width:"100px"},pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"actions",header:"-",style:C([{width:"10px"},{"text-align":"center"}]),pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[a("i",{class:"pi pi-trash cursor-pointer",onClick:v=>m(l.data.index)},null,8,Se)]),_:1})]),_:1},8,["value"])]),a("div",Fe,[e(ge,{modelValue:h.value,"onUpdate:modelValue":t[10]||(t[10]=l=>h.value=l),"download-url":"/api/lab/material/file/download",accept:".pdf,.xlsx,.xls,.png,.jpg,.jpeg",multiple:!0,onError:t[11]||(t[11]=l=>console.error(l))},null,8,["modelValue"])]),a("div",Le,[t[25]||(t[25]=a("h5",{class:"m-0"},"- 변경이력",-1)),e(D,{label:"추가+",onClick:F,class:"p-button-xm"})]),a("div",null,[e(A,{value:x.value,"scroll-height":"200px",scrollable:"",showGridlines:"",class:"my-table"},{default:i(()=>[e(u,{field:"orderDist",header:"No.",style:C([{"text-align":"center"},{width:"20px"}]),pt:{columnHeaderContent:"justify-center"}}),e(u,{field:"historyComment",header:"변경이력",style:C([{"text-align":"left"},{width:"300px"}]),pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[e(p,{modelValue:l.data.historyComment,"onUpdate:modelValue":v=>l.data.historyComment=v,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{field:"updName",header:"담당자",style:C([{"text-align":"center"},{width:"100px"}]),pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[e(p,{modelValue:l.data.updName,"onUpdate:modelValue":v=>l.data.updName=v,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(u,{field:"updDate",header:"수정일",style:C([{"text-align":"center"},{width:"100px"}]),pt:{columnHeaderContent:"justify-center"}},{body:i(l=>[e(ee,{modelValue:l.data.updDate,"onUpdate:modelValue":v=>l.data.updDate=v,showIcon:!1,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["value"])]),a("div",ke,[e(D,{label:"저장",class:"btn-save",onClick:_}),e(D,{label:"닫기",onClick:M})]),e(te,{visible:w.value,"onUpdate:visible":t[13]||(t[13]=l=>w.value=l),header:"성분 목록"},{default:i(()=>[e(be,{onSelected:U,onClose:t[12]||(t[12]=l=>w.value=!1)})]),_:1},8,["visible"])],64)}}},Pe=E($e,[["__scopeId","data-v-635f6b6c"]]),Me={class:"flex flex-wrap items-center gap-2 w-full"},Ae={class:"flex items-center justify-end gap-2 mb-2"},Ge=["onClick"],Oe={__name:"MaterialList",setup(X){const I=de(),j=f(null),b=B({itemName:"",itemCd:"",ingredientName:""}),P=f({icon:"pi pi-home"}),h=f([{label:"원료관리"},{label:"원료목록"}]),w=f([]),H=async()=>{const g={...b};w.value=await $.getMaterialItemList(g)};J(async()=>{});const y=g=>{I.open(Pe,{props:{header:"원료 상세",modal:!0,maximizable:!1,draggable:!0,style:{overflow:"auto"},pt:{root:{style:{overflow:"hidden"}},content:{style:{overflow:"hidden"}}}},data:g})},x=()=>{var d;const g=((d=j.value)==null?void 0:d.columns)??[];if(!g.length){console.warn("No Columns Found");return}exportToExcel(w.value,"원료리스트",g)};return(g,d)=>{const S=ue,n=Q,_=W,U=q,F=ae,m=R,L=T;return Y(),K(z,null,[e(S,{home:P.value,model:h.value},null,8,["home","model"]),a("form",{onSubmit:re(H,["prevent"]),class:"space-y-4"},[e(F,{class:"flex flex-wrap mt-2 mb-2 gap-1 w-full"},{start:i(()=>[a("div",Me,[e(_,{variant:"on"},{default:i(()=>[e(n,{id:"on_label",modelValue:b.itemName,"onUpdate:modelValue":d[0]||(d[0]=r=>b.itemName=r),style:{width:"150px"}},null,8,["modelValue"]),d[3]||(d[3]=a("label",{for:"on_label"},"품목명",-1))]),_:1}),e(_,{variant:"on"},{default:i(()=>[e(n,{id:"on_label1",modelValue:b.itemCd,"onUpdate:modelValue":d[1]||(d[1]=r=>b.itemCd=r),style:{width:"250px"}},null,8,["modelValue"]),d[4]||(d[4]=a("label",{for:"on_label1"},"품목코드",-1))]),_:1}),e(_,{variant:"on"},{default:i(()=>[e(n,{id:"on_label2",modelValue:b.ingredientName,"onUpdate:modelValue":d[2]||(d[2]=r=>b.ingredientName=r),style:{width:"250px"}},null,8,["modelValue"]),d[5]||(d[5]=a("label",{for:"on_label2"},"성분명",-1))]),_:1}),e(U,{label:"검색",icon:"pi pi-search",type:"submit",class:"bg-blue-500 text-white hover:bg-blue-600"})])]),_:1})],32),a("div",Ae,[e(U,{label:"엑셀",icon:"pi pi-file-excel",severity:"success",onClick:x})]),a("div",null,[e(L,{ref_key:"dt",ref:j,paginator:"",rows:20,value:w.value,dataKey:"itemCd",rowsPerPageOptions:[20,30,40],scrollable:"",scrollHeight:"650px",showGridlines:"",class:"my-table"},{default:i(()=>[e(m,{field:"rowNum",header:"No.",style:{width:"20px","text-align":"center"},pt:{columnHeaderContent:"justify-center"}}),e(m,{field:"itemCd",header:"품목코드",style:{width:"100px"},pt:{columnHeaderContent:"justify-center"}}),e(m,{field:"itemName",header:"품목명",style:C([{width:"400px"},{"text-align":"left"}]),bodyClass:"break-words",pt:{columnHeaderContent:"justify-center"}},{body:i(r=>[a("div",{style:{cursor:"pointer","text-decoration":"underline"},onClick:M=>y(r.data.itemCd),class:"clickable-cell"},k(r.data.itemName),9,Ge)]),_:1}),e(m,{field:"customerName",header:"거래처",style:{width:"200px"},pt:{columnHeaderContent:"justify-center"}}),e(m,{field:"itemCompany",header:"제조원",style:{width:"200px"},pt:{columnHeaderContent:"justify-center"}}),e(m,{field:"inPrice",header:"입고단가",pt:{columnHeaderContent:"justify-center"},style:C([{width:"80px"},{"text-align":"right"}])},{body:i(r=>[G(k(Number(r.data.inPrice).toLocaleString()),1)]),_:1}),e(m,{field:"outPrice",header:"출고단가",pt:{columnHeaderContent:"justify-center"},style:C([{width:"80px"},{"text-align":"right"}])},{body:i(r=>[G(k(Number(r.data.outPrice).toLocaleString()),1)]),_:1}),e(m,{field:"vegan",header:"Vegan",style:{width:"50px"},pt:{columnHeaderContent:"justify-center"}}),e(m,{field:"halal",header:"Halal",style:{width:"50px"},pt:{columnHeaderContent:"justify-center"}}),e(m,{field:"rspo",header:"RSPO",style:{width:"50px"},pt:{columnHeaderContent:"justify-center"}})]),_:1},8,["value"])])],64)}}},lt=E(Oe,[["__scopeId","data-v-2b45946a"]]);export{lt as default};
