import{_ as oe,a as ye,u as fe,e as ie,x as ge,r as v,k as xe,m as se,B as z,n as le,d as s,c as L,o as D,f as r,g as t,w as l,j as de,t as y,D as I,G as P,F as W,v as re,E as ee,b as he,y as we,h as O,i as Y}from"./index-C-Q3ea6s.js";import{e as be}from"./exportToExcel-Kkbtezxo.js";import{j as Ve,f as ue,i as ke}from"./common-DX12Nz2N.js";import{A as H}from"./apiOrders-VrRkxjij.js";import{_ as Z}from"./DateSinglePicker--LSm2rzE.js";import{C as Ne}from"./CustomerListPop-D05Rszn0.js";import{_ as Ce}from"./UserListPop-Do7LYruu.js";import{_ as Se}from"./StorageListPop-B0m1NNmO.js";import{_ as Ue}from"./MultiFileUpload-ClnWoGqO.js";import{_ as Ie}from"./ItemListSinglePop-D6ZzbXAV.js";import{A as te}from"./apiCommon-DLJ6uQuV.js";import"./_commonjsHelpers-CZnAS8i4.js";import"./format-CBpsKyOP.js";import"./apiBase-QvrfTKy4.js";import"./filedownLoad-mJr14i86.js";import"./apiItem-BvJCdtAu.js";const Pe=["id"],De=["onUpdate:modelValue","onDblclick"],$e=["onUpdate:modelValue"],qe=["onUpdate:modelValue"],Le=["onUpdate:modelValue","onBlur"],Te=["onUpdate:modelValue","onBlur"],Fe=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Ae=["onUpdate:modelValue"],je={class:"summary-row"},Ee={style:{width:"110px","text-align":"right","font-weight":"bold"}},Me={style:{width:"110px","text-align":"right","font-weight":"bold"}},Oe={style:{width:"100px","text-align":"right","font-weight":"bold"}},Re={style:{width:"150px","text-align":"right","font-weight":"bold"}},Je={class:"d-flex ga-4 justify-end"},Ye={__name:"ContractDetailPop",setup(Q){const{userId:T}=ye(),{vError:$,vSuccess:q,vWarning:C}=fe(),F=ie(),b=ge(null),h=v(!1),x=xe().params.id,S=v(null);let V=v("");const w=v([]),i=v([]),B=v([]),_=v([]),a=se({contractDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",transactionType:"",paymentCondition:"",expiryDate:"",tradingMethod:"",currencyType:"",dueDate:"",contractId:"",attachFileId:"",userId:T}),A=v([{title:"품목코드 ",key:"itemCd",align:"center",width:90},{title:"품목명",key:"itemName",align:"center",width:300},{title:"규격",key:"unit",align:"center",width:70},{title:"수량",key:"qty",align:"center",width:110},{title:"단가",key:"unitPrice",align:"center",width:110},{title:"공급가액",key:"supplyPrice",align:"center",width:110},{title:"부가세",key:"vatPrice",align:"center",width:100},{title:"적용",key:"etc",align:"center",width:150}]),U=z(()=>i.value.reduce((n,e)=>n+Number(e.qty||0),0)),j=z(()=>i.value.reduce((n,e)=>n+Number(e.supplyPrice||0),0)),k=z(()=>i.value.reduce((n,e)=>n+Number(e.vatPrice||0),0)),m=z(()=>j.value+k.value),R=n=>{let e=Number(i.value[n].qty),u=Number(i.value[n].unitPrice);!isNaN(e)&&!isNaN(u)?i.value[n].supplyPrice=e*u:i.value[n].supplyPrice=0,isNaN(i.value[n].supplyPrice)?i.value[n].vatPrice=0:i.value[n].vatPrice=Ve(i.value[n].supplyPrice)},J=(n,e)=>{switch(V.value){case"C":a.customerName=e,a.customerCd=n;break;case"U":a.managerName=e,a.managerId=n;break;case"S":a.descStorageName=e,a.descStorageCd=n;break;case"I":if(S.value!==null){const u=i.value[S.value];u.itemCd=n,u.itemName=e}break}V.value="",h.value=!1},K=async()=>{const n=new FormData;try{const e={...a};n.append("contractInfo",JSON.stringify(e)),n.append("itemList",JSON.stringify(i.value));const u=[];w.value.forEach(f=>{f.flag==="N"?n.append("newFiles",f.file):f.flag==="D"&&u.push({attachFileId:f.attachFileId,seq:f.seq})}),n.append("keptFiles",JSON.stringify(w.value.filter(f=>f.flag==="S"))),u.length>0&&n.append("deleteFiles",new Blob([JSON.stringify(u)],{type:"application/json"}));const N=await H.updateContractInfo(n);q(N),G()}catch(e){$(e.message)}},G=async()=>{_.value=await te.getCodeList("currency_type"),B.value=await te.getCodeList("vat_rate");const n=await H.getContractInfo(x);Object.assign(a,n.contractInfo),i.value=n.itemList,n.attachFileInfo!==null?w.value=n.attachFileInfo:w.value=[],i.value.length};le(async()=>{G()});const E=n=>{switch(V.value=n,n){case"C":b.value=Ne;break;case"U":b.value=Ce;break;case"S":b.value=Se;break;default:V.value="I",S.value=n,b.value=Ie;break}h.value=!0},X=()=>{F.push({name:"ContractList"})};return(n,e)=>{const u=s("v-breadcrumbs"),N=s("v-card-item"),f=s("v-text-field"),g=s("v-col"),M=s("v-row"),ae=s("v-select"),ne=s("v-card-text"),me=s("v-data-table-virtual"),ce=s("v-btn"),pe=s("v-form"),ve=s("v-card"),_e=s("v-dialog");return D(),L(W,null,[r("div",{id:n.$attrs.id},null,8,Pe),t(u,{items:["MES","수주관리","주문상세"]}),t(ve,null,{default:l(()=>[t(N,{title:"주문서상세"}),t(pe,{ref:"vform",onSubmit:de(K,["prevent"])},{default:l(()=>[t(ne,null,{default:l(()=>[t(M,null,{default:l(()=>[t(g,{class:"d-flex flex-row align-center"},{default:l(()=>[t(Z,{modelValue:a.contractDate,"onUpdate:modelValue":e[0]||(e[0]=o=>a.contractDate=o),title:"주문일자",density:"compact",width:"120",readonly:""},null,8,["modelValue"]),t(f,{modelValue:a.seq,"onUpdate:modelValue":e[1]||(e[1]=o=>a.seq=o),density:"compact",width:"20",readonly:""},null,8,["modelValue"])]),_:1}),t(g),t(g,null,{default:l(()=>[t(Z,{modelValue:a.expiryDate,"onUpdate:modelValue":e[2]||(e[2]=o=>a.expiryDate=o),title:"유효기간",density:"compact",width:"120"},null,8,["modelValue"])]),_:1}),t(g,null,{default:l(()=>[t(Z,{modelValue:a.dueDate,"onUpdate:modelValue":e[3]||(e[3]=o=>a.dueDate=o),title:"납기일자",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(g,{cols:"6"},{default:l(()=>[t(f,{modelValue:a.customerName,"onUpdate:modelValue":e[4]||(e[4]=o=>a.customerName=o),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=o=>E("C"))},null,8,["modelValue"])]),_:1}),t(g,null,{default:l(()=>[t(f,{modelValue:a.managerName,"onUpdate:modelValue":e[6]||(e[6]=o=>a.managerName=o),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=o=>E("U"))},null,8,["modelValue"])]),_:1}),t(g,null,{default:l(()=>[t(f,{modelValue:a.descStorageName,"onUpdate:modelValue":e[8]||(e[8]=o=>a.descStorageName=o),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[9]||(e[9]=o=>E("S"))},null,8,["modelValue"])]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(g,null,{default:l(()=>[t(ae,{modelValue:a.transactionType,"onUpdate:modelValue":e[10]||(e[10]=o=>a.transactionType=o),label:"거래유형",items:B.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(g,null,{default:l(()=>[t(ae,{modelValue:a.currencyType,"onUpdate:modelValue":e[11]||(e[11]=o=>a.currencyType=o),label:"통화",items:_.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(g,null,{default:l(()=>[t(f,{modelValue:a.paymentCondition,"onUpdate:modelValue":e[12]||(e[12]=o=>a.paymentCondition=o),label:"결재조건",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(g,null,{default:l(()=>[t(f,{modelValue:a.tradingMethod,"onUpdate:modelValue":e[13]||(e[13]=o=>a.tradingMethod=o),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(M,null,{default:l(()=>[t(g,{cols:"12"},{default:l(()=>[t(Ue,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=o=>w.value=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(N,{title:"품목목록",style:{height:"40px"}}),t(ne,null,{default:l(()=>[t(M,null,{default:l(()=>[t(g,{cols:"12"},{default:l(()=>[t(me,{headers:A.value,items:i.value,"item-value":"id"},{headers:l(({columns:o})=>[r("tr",null,[(D(!0),L(W,null,re(o,d=>(D(),L("th",{key:d.key,class:"custom-header",style:ee([{height:"30px"},{width:d.width+"px",minWidth:d.width+"px",maxWidth:d.width+"px"}])},y(d.title),5))),128))])]),"item.itemCd":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].itemCd=c,style:{"text-align":"center",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-input",onDblclick:c=>E(d)},null,40,De),[[P,i.value[d].itemCd]])]),"item.itemName":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].itemName=c,style:{"text-align":"left",width:"250px","min-width":"250px","max-width":"250px"},class:"custom-input",readonly:""},null,8,$e),[[P,i.value[d].itemName]])]),"item.unit":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].unit=c,style:{"text-align":"center",width:"80px","min-width":"80px","max-width":"80px"},class:"custom-line"},null,8,qe),[[P,i.value[d].unit]])]),"item.qty":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].qty=c,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:c=>R(d)},null,40,Le),[[P,i.value[d].qty]])]),"item.unitPrice":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].unitPrice=c,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:c=>R(d)},null,40,Te),[[P,i.value[d].unitPrice]])]),"item.supplyPrice":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].supplyPrice=c,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line"},null,8,Fe),[[P,i.value[d].supplyPrice]])]),"item.vatPrice":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].vatPrice=c,type:"number",style:{"text-align":"right",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-line"},null,8,Be),[[P,i.value[d].vatPrice,void 0,{number:!0}]])]),"item.etc":l(({item:o,index:d})=>[I(r("input",{"onUpdate:modelValue":c=>i.value[d].etc=c,type:"text",style:{"text-align":"left",width:"150px","min-width":"150px","max-width":"150px"},class:"custom-line"},null,8,Ae),[[P,i.value[d].etc]])]),"body.append":l(()=>[r("tr",je,[e[17]||(e[17]=r("td",{style:{width:"100px"}},null,-1)),e[18]||(e[18]=r("td",{style:{width:"250px"}},null,-1)),e[19]||(e[19]=r("td",{style:{width:"80px"}},null,-1)),r("td",Ee,y(U.value.toLocaleString()),1),e[20]||(e[20]=r("td",{style:{width:"110px"}},null,-1)),r("td",Me,y(j.value.toLocaleString()),1),r("td",Oe,y(k.value.toLocaleString()),1),r("td",Re,y(m.value.toLocaleString()),1)])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),t(M,{class:"mt-2 mb-2"},{default:l(()=>[t(g,null,{default:l(()=>[r("div",Je,[t(ce,{text:"목록",class:"mr-3",onClick:X})])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(_e,{modelValue:h.value,"onUpdate:modelValue":e[16]||(e[16]=o=>h.value=o),width:"800px",height:"800px",persistent:""},{default:l(()=>[(D(),he(we(b.value),{id:n.id,onSelected:J,onCloseDialog:e[15]||(e[15]=o=>h.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"])],64)}}},We=oe(Ye,[["__scopeId","data-v-78fb1bf0"]]),Ge={class:"cell fixed",style:{cursor:"pointer"}},ze={class:"cell wrap",style:{"text-decoration":"underline"}},He={class:"cell fixed"},Qe={class:"cell fixed"},Ke=["onClick"],Xe={__name:"SalePop",props:{id:{type:String},no:{type:String}},emits:["close-dialog"],setup(Q,{emit:T}){const $=v([]),q=T,C=Q,F=[{title:"품목코드",key:"itemCd",align:"center",width:"120px"},{title:"품목명",key:"itemName",align:"left",width:"250px"},{title:"규격",key:"unit",align:"center",width:"60px"},{title:"수량",key:"qty",align:"center",width:"120px"},{title:"주문서",key:"contractDateSeq",align:"center",width:"110px"}];le(async()=>{$.value=await H.getSaleItemList(C.id)});const b=()=>{};return(h,p)=>{const x=s("v-toolbar-title"),S=s("v-spacer"),V=s("v-icon"),w=s("v-btn"),i=s("v-toolbar"),B=s("v-card-subtitle"),_=s("v-card-item"),a=s("v-data-table-virtual"),A=s("v-col"),U=s("v-row"),j=s("v-card"),k=s("v-dialog");return D(),L(W,null,[t(i,{height:"40",class:"d-flex align-center justify-space-between px-2 toolbar-Head"},{default:l(()=>[t(x,null,{default:l(()=>p[3]||(p[3]=[O("주문서 목록")])),_:1}),t(S),t(w,{icon:"",onClick:p[0]||(p[0]=m=>q("close-dialog"))},{default:l(()=>[t(V,null,{default:l(()=>p[4]||(p[4]=[O("mdi-close")])),_:1})]),_:1})]),_:1}),t(j,{elevation:"16"},{default:l(()=>[t(_,null,{default:l(()=>[t(B,{class:"mt-4"},{default:l(()=>[O(" 판매조회 : "+y(C.no),1)]),_:1})]),_:1}),t(_,{class:"py-1"},{default:l(()=>[t(U,null,{default:l(()=>[t(A,null,{default:l(()=>[t(a,{headers:F,items:$.value,class:"my-data-table","fixed-header":""},{"item.itemCd":l(({item:m})=>[r("span",Ge,y(m.itemCd),1)]),"item.itemName":l(({item:m})=>[r("span",ze,y(m.itemName),1)]),"item.unit":l(({item:m})=>[r("span",He,y(m.unit),1)]),"item.qty":l(({item:m})=>[r("span",Qe,y(Y(ue)(m.qty)),1)]),"item.contractDateSeq":l(({item:m})=>[r("span",{class:"cell fixed",style:{"text-decoration":"underline",cursor:"pointer"},onClick:R=>b(m.contractId)},y(m.contractDateSeq),9,Ke)]),_:1},8,["items"])]),_:1})]),_:1}),t(U,null,{default:l(()=>[t(A,{class:"d-flex justify-end"},{default:l(()=>[t(w,{text:"닫기",variant:"tonal",onClick:p[1]||(p[1]=m=>q("close-dialog"))})]),_:1})]),_:1})]),_:1})]),_:1}),p[5]||(p[5]=O("> ")),t(k,null,{default:l(()=>[t(We,{id:h.saleId,onCloseDialog:p[2]||(p[2]=m=>h.dialog=!1)},null,8,["id"])]),_:1})],64)}}},Ze=oe(Xe,[["__scopeId","data-v-28207a0e"]]),et=["onClick"],tt=["onClick"],lt=["onClick"],xt={__name:"SaleList",setup(Q){let T=v(""),$=v(""),q=v("");const C=v(!1),F=ie(),b=v([]),h=v([]),p=v(!1),x=se({itemName:"",managerName:"",customerName:"",customerCd:""}),S=v([{title:"일자-No.",key:"saleDateSeq",align:"center",width:"100px"},{title:"품목명",key:"itemName",align:"start",width:"370px"},{title:"담당자명",key:"managerName",align:"center",width:"90px"},{title:"거래처명",key:"customerName",align:"start",width:"220px"},{title:"금액 합계",key:"totPrice",align:"end",width:"100px"},{title:"거래유형",key:"transactionTypeName",align:"center",width:"100px"},{title:"창고명",key:"descStorageName",align:"center",width:"150px"},{title:"인쇄",key:"printYn",align:"center",width:"40px"},{title:"주문서",key:"saleId",align:"center",width:"80px"}]);le(async()=>{b.value=await te.getCodeList("status_type"),w()});const V=(_,a)=>{ke(_.saleId)?F.push({name:"SaleReg"}):F.push({name:"SaleDetail",params:{id:_.saleId}})},w=async()=>{p.value=!0;const _={...x};h.value=await H.getSaleList(_),p.value=!1},i=(_,a)=>{q.value=_.saleId,$.value=_.saleDateSeq,C.value=!0},B=()=>{be(S,h.value,"판매_목록")};return(_,a)=>{const A=s("v-breadcrumbs"),U=s("v-text-field"),j=s("v-select"),k=s("v-btn"),m=s("v-col"),R=s("v-form"),J=s("v-row"),K=s("v-card-text"),G=s("v-card"),E=s("v-spacer"),X=s("v-data-table"),n=s("v-dialog");return D(),L(W,null,[t(A,{items:["MES","영업관리","판매관리"],class:"custom-breadcrumbs"}),t(G,{class:"pa-1",style:{height:"60px"}},{default:l(()=>[t(K,null,{default:l(()=>[t(J,null,{default:l(()=>[t(R,{ref_key:"srhForm",ref:T,onSubmit:de(w,["prevent"])},{default:l(()=>[t(m,{class:"d-flex flex-row ga-3"},{default:l(()=>[t(U,{modelValue:x.itemName,"onUpdate:modelValue":a[0]||(a[0]=e=>x.itemName=e),dense:"",density:"compact",label:"품목명",placeholder:"품목명을 입력해주세요",variant:"underlined",style:{width:"180px"}},null,8,["modelValue"]),t(U,{modelValue:x.managerName,"onUpdate:modelValue":a[1]||(a[1]=e=>x.managerName=e),dense:"",density:"compact",label:"담당자명",placeholder:"담당자명을 입력해주세요",variant:"underlined",style:{width:"180px"}},null,8,["modelValue"]),t(U,{modelValue:x.customerName,"onUpdate:modelValue":a[2]||(a[2]=e=>x.customerName=e),dense:"",density:"compact",label:"거래처명",placeholder:"거래처명을 입력해주세요",variant:"underlined",style:{width:"150px"}},null,8,["modelValue"]),t(j,{modelValue:x.statusType,"onUpdate:modelValue":a[3]||(a[3]=e=>x.statusType=e),label:"진행상태",items:b.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",style:{width:"100px"}},null,8,["modelValue","items"]),t(k,{text:"조회",color:"brown-lighten-4",type:"submit"}),t(k,{text:"초기화",onClick:a[4]||(a[4]=e=>Y(T).reset())})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1}),t(E),t(J,null,{default:l(()=>[t(m,{class:"d-flex justify-end align-center mr-2",style:{gap:"10px","margin-top":"10px"}},{default:l(()=>[t(k,{color:"brown-lighten-4",text:"신규",onClick:V}),t(k,{class:"excel-btn",text:"엑셀","prepend-icon":"mdi-microsoft-excel",onClick:B})]),_:1})]),_:1}),t(J,null,{default:l(()=>[t(m,{class:"pa-0"},{default:l(()=>[t(X,{headers:S.value,items:h.value,loading:p.value,"items-per-page":15,"no-data-text":"데이터가 없습니다.","loading-text":"조회중입니다 잠시만 기다려주세요",density:"compact","fixed-header":"",height:"690px","return-object":""},{headers:l(({columns:e})=>[r("tr",null,[(D(!0),L(W,null,re(e,u=>(D(),L("th",{key:u.key,class:"custom-header",style:ee([{height:"40px"},{textAlign:"center"}])},y(u.title),1))),128))])]),"item.saleDateSeq":l(({item:e,index:u})=>[r("div",{style:{cursor:"pointer","text-decoration":"underline",width:"95%"},onClick:N=>V(e,u)},y(e.saleDateSeq),9,et)]),"item.itemName":l(({item:e,index:u})=>[r("div",{style:{cursor:"pointer","text-decoration":"underline",width:"95%"},onClick:N=>V(e,u)},y(e.itemName),9,tt)]),"item.totPrice":l(({item:e})=>[O(y(Y(ue)(e.totPrice)),1)]),"item.statusType":l(({item:e,index:u})=>[O(y(e.statusType==="ING"?"진행중":"종료"),1)]),"item.printYn":l(({item:e,index:u})=>[r("p",{style:ee([{padding:"4px","text-align":"center",cursor:"pointer"},{backgroundColor:e.printYn==="Y"?"#FFAB91":"transparent"}]),onClick:a[5]||(a[5]=(...N)=>_.onPrint&&_.onPrint(...N))},"인쇄 ",4)]),"item.saleId":l(({item:e,index:u})=>[r("div",{style:{cursor:"pointer","text-decoration":"underline"},onClick:N=>i(e,u)}," 주문서 ",8,lt)]),_:1},8,["headers","items","loading"])]),_:1})]),_:1}),t(n,{modelValue:C.value,"onUpdate:modelValue":a[7]||(a[7]=e=>C.value=e),width:"1000px",height:"400px",persistent:""},{default:l(()=>[t(Ze,{id:Y(q),no:Y($),onCloseDialog:a[6]||(a[6]=e=>C.value=!1)},null,8,["id","no"])]),_:1},8,["modelValue"])],64)}}};export{xt as default};
