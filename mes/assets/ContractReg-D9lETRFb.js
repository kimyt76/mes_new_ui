import{_ as oe,a as se,u as ue,r as p,x as de,k as re,z as k,q as F,m as ce,A as w,c as me,f as v,g as a,d as u,w as i,F as pe,e as ve,o as E,j as ye,i as M,h as _e,B as f,C as g,b as fe,y as ge}from"./index-CSVU4KnH.js";import{d as we,e as y,l as O,i as he}from"./common-Vxxi2eVn.js";import{A as Ve}from"./apiOrders-aYcVHbt-.js";import{_ as xe}from"./MultiFileUpload-D3mdnaQH.js";import{_ as Pe}from"./ItemListMultiPop-CmNycg3-.js";import{_ as be}from"./UserListPop-Dvf9Erza.js";import{_ as Ne}from"./ClientListPop-CBs0lbZm.js";import"./format-CBpsKyOP.js";import"./filedownLoad-vZrQWoXx.js";import"./apiItem-CBVF2Qf0.js";import"./apiBase-CUE3DEwQ.js";const Ce=["id"],ke=["onUpdate:modelValue","onBlur"],De=["onUpdate:modelValue","onBlur"],Ue=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],qe=["onUpdate:modelValue"],Se={__name:"ContractReg",setup($e){const{userId:z}=se(),{vError:J,vSuccess:G,vInfo:q}=ue(),S=ve(),h=p(!1),V=de(null);let D=p("");const l=p([]),$=p([]),B=p([]),A=p([]),x=p([]),P=p(""),b=p(""),o=re({contractDate:"",seq:"",expectedDueDate:"",clientName:"",clientId:"",managerName:"",managerId:"",paymentCondition:"",vatType:"",orderType:"",userId:z}),H=[{title:"품목코드 ",key:"itemCd",align:"center",width:"120px"},{title:"품목명",key:"itemName",align:"start",width:"380px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"제품유형",key:"itemGrp1",align:"center",width:"100px"},{title:"수량",key:"qty",align:"center",width:"80px"},{title:"단가",key:"unitPrice",align:"center",width:"80px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"합계",key:"totPrice",align:"center",width:"100px"},{title:"차수   ",key:"orderCnt",align:"center",width:"80px"},{title:"진행상태",key:"statusType",align:"center",width:"110px"},{title:"비고",key:"etc",align:"center",width:"100px"},{title:"-",key:"actions",align:"center",width:"10px"}];k(()=>l.value.reduce((t,e)=>t+Number(e.qty||0),0));const K=k(()=>l.value.reduce((t,e)=>t+Number(e.supplyPrice||0),0)),W=k(()=>l.value.reduce((t,e)=>t+Number(e.vatPrice||0),0));k(()=>K.value+W.value);const Q=async()=>{const t=new FormData;if(l.value<=0){q("품목을 등록하세요");return}if(x.value<=0){q("산출물을 등록하세요");return}try{const e={...o};e.contractDate=y(e.contractDate),e.expectedDueDate=y(e.expectedDueDate),t.append("contractInfo",JSON.stringify(e)),t.append("itemList",JSON.stringify(l.value)),x.value.forEach(d=>{d.file instanceof File&&t.append("attachFile",d.file)});const m=await Ve.saveContractInfo(t);G("저장되었습니다."),S.push({name:"ContractDetail",params:{id:m}})}catch(e){J(e.message)}};F(()=>o.contractDate,async(t,e)=>{he(y(e))||e!==y(t)&&(o.seq=await w.getNextSeq("tb_contract_mst","contract_Date",y(t)))}),F(()=>o.vatType,async t=>{o.vatType==="VRN"?l.value.map(e=>{e.vatPrice=0}):l.value.map(e=>{e.vatPrice=O(e.supplyPrice)})});const L=t=>{const e=Number(l.value[t].qty),m=Number(l.value[t].unitPrice);!isNaN(e)&&!isNaN(m)?l.value[t].supplyPrice=e*m:l.value[t].supplyPrice=0,isNaN(l.value[t].supplyPrice)?l.value[t].vatPrice=0:l.value[t].vatPrice=O(l.value[t].supplyPrice),isNaN(l.value[t].supplyPrice)?l.value[t].totPrice=0:l.value[t].totPrice=l.value[t].supplyPrice+l.value[t].vatPrice},X=t=>{switch(D.value){case"C":o.clientName=t.clientName,o.clientId=t.clientId;break;case"U":o.managerName=t.memberNm,o.managerId=t.userId;break;case"I":Y(t);break}D.value=""},Y=t=>{if(!Array.isArray(t))return;let e=l.value.length;const m=t.map((d,N)=>({itemCd:d.itemCd,itemName:d.itemName,unit:d.unit,prodType:d.prodType,qty:d.qty,unitPrice:d.unitPrice,supplyPrice:d.supplyPrice,vatPrice:0,totPrice:0,orderCnt:"",statusType:"",etc:d.etc,orderDist:e+N+1}));l.value.length>0?l.value.push(...m):l.value=[...m]},U=t=>{switch(D.value=t,t){case"C":V.value=Ne,P.value="800px",b.value="800px";break;case"U":V.value=be,P.value="800px",b.value="800px";break;case"I":V.value=Pe,P.value="800px",b.value="850px";break}h.value=!0},Z=t=>{const e=l.value.findIndex(m=>m.itemCd===t);l.value.splice(e,1)};ce(async()=>{$.value=await w.getCodeList("order_type"),B.value=await w.getCodeList("vat_type"),A.value=await w.getCodeList("status_Type"),o.contractDate=we(),o.seq=await w.getNextSeq("tb_contract_mst","contract_date",o.contractDate)});const j=()=>{S.push({name:"ContractList"})};return(t,e)=>{const m=u("v-breadcrumbs"),d=u("v-card-item"),N=u("v-date-input"),C=u("v-text-field"),c=u("v-col"),_=u("v-row"),T=u("v-select"),R=u("v-card-text"),ee=u("v-card-subtitle"),I=u("v-btn"),te=u("v-icon"),ae=u("v-data-table-virtual"),le=u("v-form"),ne=u("v-card"),ie=u("v-dialog");return E(),me(pe,null,[v("div",{id:t.$attrs.id},null,8,Ce),a(m,{items:["MES","영업관리","주문신규"],class:"custom-breadcrumbs"}),a(ne,null,{default:i(()=>[a(d,{title:"주문서입력"}),a(le,{ref:"vform",onSubmit:ye(Q,["prevent"])},{default:i(()=>[a(R,null,{default:i(()=>[a(_,null,{default:i(()=>[a(c,{class:"d-flex ga-2 pa-1"},{default:i(()=>[a(N,{modelValue:o.contractDate,"onUpdate:modelValue":e[0]||(e[0]=n=>o.contractDate=n),label:"주문일자",density:"compact","display-format":M(y),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"]),a(C,{modelValue:o.seq,"onUpdate:modelValue":e[1]||(e[1]=n=>o.seq=n),density:"compact",style:{width:"40px"},readonly:""},null,8,["modelValue"])]),_:1}),a(c,null,{default:i(()=>[a(N,{modelValue:o.expectedDueDate,"onUpdate:modelValue":e[2]||(e[2]=n=>o.expectedDueDate=n),label:"납기예정일자",density:"compact","display-format":M(y),variant:"underlined",style:{width:"200px"},"hide-details":""},null,8,["modelValue","display-format"])]),_:1}),a(c,null,{default:i(()=>[a(C,{modelValue:o.paymentCondition,"onUpdate:modelValue":e[3]||(e[3]=n=>o.paymentCondition=n),label:"결제조건",variant:"underlined",density:"compact",style:{width:"200px"},"hide-details":""},null,8,["modelValue"])]),_:1}),a(c,null,{default:i(()=>[a(C,{modelValue:o.managerName,"onUpdate:modelValue":e[4]||(e[4]=n=>o.managerName=n),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=n=>U("U")),style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),_:1}),a(_,null,{default:i(()=>[a(c,{cols:"6"},{default:i(()=>[a(C,{modelValue:o.clientName,"onUpdate:modelValue":e[6]||(e[6]=n=>o.clientName=n),label:"고객사",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=n=>U("C"))},null,8,["modelValue"])]),_:1}),a(c,null,{default:i(()=>[a(T,{modelValue:o.vatType,"onUpdate:modelValue":e[8]||(e[8]=n=>o.vatType=n),label:"거래유형",items:B.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",style:{width:"200px"}},null,8,["modelValue","items"])]),_:1}),a(c,null,{default:i(()=>[a(T,{modelValue:o.orderType,"onUpdate:modelValue":e[9]||(e[9]=n=>o.orderType=n),label:"수주유형",items:$.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",style:{width:"200px"}},null,8,["modelValue","items"])]),_:1})]),_:1}),a(_,null,{default:i(()=>[a(c,{cols:"12"},{default:i(()=>[a(xe,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=n=>x.value=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(R,null,{default:i(()=>[a(_,null,{default:i(()=>[a(c,null,{default:i(()=>[a(ee,null,{default:i(()=>e[14]||(e[14]=[_e(" - 품목 ")])),_:1})]),_:1}),a(c,{class:"d-flex ga-4 justify-end"},{default:i(()=>[a(I,{text:"추가 +",density:"compact",onClick:e[11]||(e[11]=n=>U("I"))})]),_:1})]),_:1}),a(_,null,{default:i(()=>[a(c,null,{default:i(()=>[a(ae,{headers:H,items:l.value,density:"compact","item-value":"id",class:"custom-table no-padding-table"},{"item.statusType":i(({item:n})=>[a(T,{modelValue:n.statusType,"onUpdate:modelValue":s=>n.statusType=s,items:A.value,"item-title":"codeNm","item-value":"code",density:"compact",variant:"outlined",style:{width:"120px",height:"40px"}},null,8,["modelValue","onUpdate:modelValue","items"])]),"item.qty":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].qty=r,style:{"text-align":"right",width:"90%"},class:"custom-line",onBlur:r=>L(s)},null,40,ke),[[g,l.value[s].qty]])]),"item.unitPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].unitPrice=r,style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line",onBlur:r=>L(s)},null,40,De),[[g,l.value[s].unitPrice]])]),"item.supplyPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].supplyPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ue),[[g,l.value[s].supplyPrice]])]),"item.vatPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].vatPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Te),[[g,l.value[s].vatPrice,void 0,{number:!0}]])]),"item.totPrice":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].totPrice=r,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ie),[[g,l.value[s].totPrice,void 0,{number:!0}]])]),"item.etc":i(({item:n,index:s})=>[f(v("input",{"onUpdate:modelValue":r=>l.value[s].etc=r,type:"text",style:{"text-align":"left",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,qe),[[g,l.value[s].etc]])]),"item.actions":i(({item:n})=>[a(te,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>Z(n.itemCd)},null,8,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1}),a(_,{class:"mt-2 mb-2"},{default:i(()=>[a(c,{class:"d-flex ga-4 justify-end"},{default:i(()=>[a(I,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),a(I,{text:"목록",class:"mr-3",onClick:j})]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),a(ie,{modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=n=>h.value=n),width:P.value,height:b.value,persistent:""},{default:i(()=>[(E(),fe(ge(V.value),{id:t.id,onSelected:X,onCloseDialog:e[12]||(e[12]=n=>h.value=!1)},null,40,["id"]))]),_:1},8,["modelValue","width","height"])],64)}}},He=oe(Se,[["__scopeId","data-v-a9950fc5"]]);export{He as default};
