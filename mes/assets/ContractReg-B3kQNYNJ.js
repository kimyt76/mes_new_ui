import{_ as ue,r as c,C as N,a as de,u as re,v as me,m as pe,q as ce,n as ve,c as D,f as u,g as t,d as p,w as a,i as z,F as O,e as ye,o as U,j as ge,t as w,E as g,G as f,x as fe,y as he,b as _e,z as xe}from"./index-BNL3Tgw5.js";import{A as W}from"./apiOrders-Whxuw2Cj.js";import{h as we,i as Ve}from"./common-BOBTT4pT.js";import{A as q}from"./apiCommon-LY9rUrf-.js";import{_ as be}from"./MultiFileUpload--c0CfwPP.js";import{_ as Ce}from"./CustomerListPop-C12lnYGL.js";import{_ as Ne}from"./UserListPop-DEkQwN6k.js";import{_ as Ue}from"./StorageListPop-DItQtyxf.js";import{_ as $}from"./DateSinglePicker-8DAkXH4C.js";import{_ as Pe}from"./ItemListMultiPop-CrGDLePS.js";import"./format-CBpsKyOP.js";import"./filedownLoad-DSISiZ_u.js";import"./apiBase-CSC4uJMW.js";import"./apiItem-CL-1bRvd.js";const ke=["id"],Se={class:"d-flex ga-4 justify-end"},De=["onUpdate:modelValue","onDblclick"],qe=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],Ie=["onUpdate:modelValue","onBlur"],Le=["onUpdate:modelValue","onBlur"],Te=["onUpdate:modelValue"],Ae=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Me={class:"summary-row"},Re={style:{width:"110px","text-align":"right","font-weight":"bold",height:"40px"}},Ee={style:{width:"110px","text-align":"right","font-weight":"bold",height:"40px"}},Fe={style:{width:"100px","text-align":"right","font-weight":"bold",height:"40px"}},ze={style:{width:"150px","text-align":"right","font-weight":"bold",height:"40px"}},Oe={class:"d-flex ga-4 justify-end"},We={__name:"ContractReg",setup(je){let h=c(""),j=c("");const J=N(()=>i.value.reduce((n,e)=>n+Number(e.qty||0),0)),I=N(()=>i.value.reduce((n,e)=>n+Number(e.supplyPrice||0),0)),L=N(()=>i.value.reduce((n,e)=>n+Number(e.vatPrice||0),0)),G=N(()=>I.value+L.value),{userId:H}=de(),{vError:Q,vSuccess:K}=re(),T=ye(),V=me(null),x=c(!1),b=c(!1);c(null);let P=c("");const k=c([]),i=c([]),A=c([]),B=c([]),o=pe({contractDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",paymentCondition:"",transactionType:"",expiryDate:"",tradingMethod:"",currencyType:"",dueDate:"",userId:H}),X=c([{title:"품목코드 ",key:"itemCd",align:"center",width:"100px"},{title:"품목명",key:"itemName",align:"center",width:"250px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"수량",key:"qty",align:"center",width:"110px"},{title:"단가",key:"unitPrice",align:"center",width:"110px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"적용",key:"etc",align:"center",width:"150px"},{title:"-",key:"actions",align:"center",width:10}]),Y=(n,e)=>{switch(P.value){case"C":o.customerName=e,o.customerCd=n;break;case"U":o.managerName=e,o.managerId=n;break;case"S":o.descStorageName=e,o.descStorageCd=n;break}P.value="",x.value=!1},Z=async()=>{const n=new FormData;try{const e={...o};n.append("contractInfo",JSON.stringify(e)),n.append("itemList",JSON.stringify(i.value)),k.value.forEach(m=>{m.file instanceof File&&n.append("attachFile",m.file)});const v=await W.saveContractInfo(n);K(v),T.push({name:"ContractList"})}catch(e){Q(e.message)}};ce(()=>o.contractDate,async(n,e)=>{Ve(e)||e!==n&&(o.seq=await W.getNextSeq(n))});const M=n=>{const e=Number(i.value[n].qty),v=Number(i.value[n].unitPrice);!isNaN(e)&&!isNaN(v)?i.value[n].supplyPrice=e*v:i.value[n].supplyPrice=0,isNaN(i.value[n].supplyPrice)?i.value[n].vatPrice=0:i.value[n].vatPrice=we(i.value[n].supplyPrice)},ee=()=>{b.value=!0},te=n=>{if(!Array.isArray(n))return;const e=i.value.length,v=n.map((m,y)=>({itemCd:m.itemCd,itemName:m.itemName,unit:m.unit,qty:m.qty,unitPrice:m.unitPrice,supplyPrice:m.supplyPrice,vatPrice:m.vatPrice,etc:m.etc,orderDist:e+y+1}));console.log("selectItem",v),i.value.length>0?i.value.push(...v):i.value=[...v]},le=n=>{i.value.splice(n,1)};ve(async()=>{B.value=await q.getCodeList("currency_type"),A.value=await q.getCodeList("vat_rate"),o.seq=await q.getNextSeq("tb_contract_mst","contract_date",o.contractDate)});const C=n=>{switch(P.value=n,n){case"C":V.value=Ce,h.value="800px",h.value="900px";break;case"U":V.value=Ne,h.value="800px",h.value="900px";break;case"S":V.value=Ue,h.value="800px",h.value="900px";break}x.value=!0},ae=()=>{T.push({name:"ContractList"})};return(n,e)=>{const v=p("v-breadcrumbs"),m=p("v-card-item"),y=p("v-text-field"),r=p("v-col"),_=p("v-row"),R=p("v-select"),E=p("v-card-text"),S=p("v-btn"),ne=p("v-icon"),ie=p("v-data-table-virtual"),oe=p("v-form"),se=p("v-card"),F=p("v-dialog");return U(),D(O,null,[u("div",{id:n.$attrs.id},null,8,ke),t(v,{items:["MES","수주관리","주문신규"],class:"custom-breadcrumbs"}),t(se,null,{default:a(()=>[t(m,{title:"주문서입력"}),t(oe,{ref:"vform",onSubmit:ge(Z,["prevent"])},{default:a(()=>[t(E,null,{default:a(()=>[t(_,{dense:""},{default:a(()=>[t(r,{class:"d-flex flex-row",style:{gap:"0"}},{default:a(()=>[t($,{modelValue:o.contractDate,"onUpdate:modelValue":e[0]||(e[0]=l=>o.contractDate=l),title:"주문일자",density:"compact",style:{width:"100px"}},null,8,["modelValue"]),t(y,{modelValue:o.seq,"onUpdate:modelValue":e[1]||(e[1]=l=>o.seq=l),density:"compact",style:{width:"40px","max-width":"60px","min-width":"0"},readonly:""},null,8,["modelValue"])]),_:1}),t(r),t(r,null,{default:a(()=>[t($,{modelValue:o.expiryDate,"onUpdate:modelValue":e[2]||(e[2]=l=>o.expiryDate=l),title:"유효기간",density:"compact"},null,8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t($,{modelValue:o.dueDate,"onUpdate:modelValue":e[3]||(e[3]=l=>o.dueDate=l),title:"납기일자",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{dense:""},{default:a(()=>[t(r,{cols:"6"},{default:a(()=>[t(y,{modelValue:o.customerName,"onUpdate:modelValue":e[4]||(e[4]=l=>o.customerName=l),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=l=>C("C"))},null,8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(y,{modelValue:o.managerName,"onUpdate:modelValue":e[6]||(e[6]=l=>o.managerName=l),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=l=>C("U"))},null,8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(y,{modelValue:o.descStorageName,"onUpdate:modelValue":e[8]||(e[8]=l=>o.descStorageName=l),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[9]||(e[9]=l=>C("S"))},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{dense:""},{default:a(()=>[t(r,null,{default:a(()=>[t(R,{modelValue:o.transactionType,"onUpdate:modelValue":e[10]||(e[10]=l=>o.transactionType=l),label:"거래유형",items:A.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(r,null,{default:a(()=>[t(R,{modelValue:o.currencyType,"onUpdate:modelValue":e[11]||(e[11]=l=>o.currencyType=l),label:"통화",items:B.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(r,null,{default:a(()=>[t(y,{modelValue:o.paymentCondition,"onUpdate:modelValue":e[12]||(e[12]=l=>o.paymentCondition=l),label:"결재조건",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(y,{modelValue:o.tradingMethod,"onUpdate:modelValue":e[13]||(e[13]=l=>o.tradingMethod=l),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{dense:""},{default:a(()=>[t(r,{cols:"12"},{default:a(()=>[t(be,{modelValue:k.value,"onUpdate:modelValue":e[14]||(e[14]=l=>k.value=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(E,null,{default:a(()=>[t(_,null,{default:a(()=>[t(r,null,{default:a(()=>[u("div",Se,[t(S,{text:"추가 +",density:"compact",onClick:ee})])]),_:1})]),_:1}),t(_,null,{default:a(()=>[t(r,{cols:"12"},{default:a(()=>[t(ie,{headers:X.value,items:i.value,"item-value":"id"},{headers:a(({columns:l})=>[u("tr",null,[(U(!0),D(O,null,fe(l,s=>(U(),D("th",{key:s.key,class:"custom-header",style:he([{height:"30px"},{width:s.width+"px",minWidth:s.width+"px",maxWidth:s.width+"px"}])},w(s.title),5))),128))])]),"item.itemCd":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].itemCd=d,style:{"text-align":"center",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-input",onDblclick:d=>C(s)},null,40,De),[[f,i.value[s].itemCd]])]),"item.itemName":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].itemName=d,style:{"text-align":"left",width:"250px","min-width":"250px","max-width":"250px"},class:"custom-input",readonly:""},null,8,qe),[[f,i.value[s].itemName]])]),"item.unit":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].unit=d,style:{"text-align":"center",width:"80px","min-width":"80px","max-width":"80px"},class:"custom-line"},null,8,$e),[[f,i.value[s].unit]])]),"item.qty":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].qty=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:d=>M(s)},null,40,Ie),[[f,i.value[s].qty]])]),"item.unitPrice":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].unitPrice=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:d=>M(s)},null,40,Le),[[f,i.value[s].unitPrice]])]),"item.supplyPrice":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].supplyPrice=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line"},null,8,Te),[[f,i.value[s].supplyPrice]])]),"item.vatPrice":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].vatPrice=d,type:"number",style:{"text-align":"right",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-line"},null,8,Ae),[[f,i.value[s].vatPrice,void 0,{number:!0}]])]),"item.etc":a(({item:l,index:s})=>[g(u("input",{"onUpdate:modelValue":d=>i.value[s].etc=d,type:"text",style:{"text-align":"left",width:"150px","min-width":"150px","max-width":"150px"},class:"custom-line"},null,8,Be),[[f,i.value[s].etc]])]),"item.actions":a(({item:l})=>[t(ne,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>le(l)},null,8,["onClick"])]),"body.append":a(()=>[u("tr",Me,[e[19]||(e[19]=u("td",{style:{width:"100px",height:"40px"}},null,-1)),e[20]||(e[20]=u("td",{style:{width:"250px",height:"40px"}},null,-1)),e[21]||(e[21]=u("td",{style:{width:"80px",height:"40px"}},null,-1)),u("td",Re,w(J.value.toLocaleString()),1),e[22]||(e[22]=u("td",{style:{width:"110px",height:"40px"}},null,-1)),u("td",Ee,w(I.value.toLocaleString()),1),u("td",Fe,w(L.value.toLocaleString()),1),u("td",ze,w(G.value.toLocaleString()),1),e[23]||(e[23]=u("td",null,null,-1))])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),t(_,{class:"mt-2 mb-2"},{default:a(()=>[t(r,null,{default:a(()=>[u("div",Oe,[t(S,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),t(S,{text:"목록",class:"mr-3",onClick:ae})])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(F,{modelValue:x.value,"onUpdate:modelValue":e[16]||(e[16]=l=>x.value=l),width:z(h),height:z(j),persistent:""},{default:a(()=>[(U(),_e(xe(V.value),{id:n.id,onSelected:Y,onCloseDialog:e[15]||(e[15]=l=>x.value=!1)},null,40,["id"]))]),_:1},8,["modelValue","width","height"]),t(F,{modelValue:b.value,"onUpdate:modelValue":e[18]||(e[18]=l=>b.value=l),width:"800",height:"800",persistent:""},{default:a(()=>[t(Pe,{onSelectedRow:te,onCloseDialog:e[17]||(e[17]=l=>b.value=!1)})]),_:1},8,["modelValue"])],64)}}},ot=ue(We,[["__scopeId","data-v-a4cbacbe"]]);export{ot as default};
