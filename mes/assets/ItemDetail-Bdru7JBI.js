import{a as _e,u as Ve,r as s,p as ge,k as ee,m as Ce,A as _,q as Pe,c as S,f as m,g as e,d as u,w as o,F as G,e as be,o as V,i as c,j as we,b as E,s as xe,h as x,n as te,t as I,v as le}from"./index-WOYElqRf.js";import{A as g}from"./apiItem-CodyMnFg.js";import{p as ae,f as U}from"./common-DT3ZdnD0.js";import{C as Ie}from"./CustomerListPop-DY0fIeo2.js";import"./format-DWu4U6B8.js";import"./apiBase-BxtsCvh9.js";const Ue=["id"],Ne={class:"d-flex justify-space-between w-100"},ke={class:"d-flex justify-space-between w-100"},Ae={__name:"ItemDetail",setup(Le){const{userId:A}=_e(),{vError:B,vSuccess:j,vWarning:oe}=Ve(),p=s(""),N=s(!1),Y=s([]),k=s(!1),$=s([]),P=s(!1),z=s(!1),L=ge(),ne=be(),H=s([]),R=s([]),O=s([]),F=s([]),T=s([]),b=s([]),ie=[{text:"사용",value:"Y"},{text:"미사용",value:"N"}],ue=L.params.id,l=ee({itemCd:ue,itemTypeCd:"",itemName:"",customerName:"",customerCd:"",itemGrp1:"",itemGrp2:"",useCate:"",inPrice:"",outPrice:"",itemCategory1:"",itemCategory2:"",etc:"",useYn:"",safeStock:"",avgDeliveryDate:"",unit:"",spec:"",category:"",userId:A});Ce(async()=>{H.value=await _.getCodeList("ITEM_TYPE_CD"),R.value=await _.getCodeList("ITEM_GRP1"),O.value=await _.getCodeList("ITEM_GRP2");const n=await g.getItemInfo(L.params.id);console.log("res",n),Object.assign(l,n),Y.value=n.priceHistory.filter(t=>t.priceType==="I"),$.value=n.priceHistory.filter(t=>t.priceType==="O"),v.inPrice=l.inPrice,v.outPrice=l.outPrice,["M2","M7"].includes(n.itemTypeCd)?(F.value=await _.getCodeList("use_Cate"),T.value=await _.getCodeList("order_cate"),b.value=await _.getCodeList("sub_item"),z.value=!0):(T.value=await g.getProdLList(),b.value=await g.getProdMList(n.itemCategory1))});const se=n=>{l.customerCd=n.customerCd,l.customerName=n.customerName},de=async()=>{var t;if(!p.value){oe("변경된 단가가 없습니다.");return}const n={type:p.value,itemCd:l.itemCd,inPrice:l.inPrice,outPrice:l.outPrice,userId:A};try{const f=await g.updatePriceInfo(n);j(f),v.inPrice=l.inPrice,v.outPrice=l.outPrice,p.value=""}catch(f){console.error(f),B(((t=f.response)==null?void 0:t.data)||"단가 변경 중 오류가 발생했습니다.")}},re=async()=>{try{const n={...l},t=await g.updateItemInfo(n);j(t),W()}catch{B("저장에 실패했습니다.")}};Pe(()=>l.itemCategory1,async n=>{b.value=await g.getProdMList(l.itemCategory1)});const v=ee({inPrice:null,outPrice:null}),q=()=>{const n=l.inPrice!==v.inPrice,t=l.outPrice!==v.outPrice;n&&!t?(p.value="I",console.log("입고단가만 변경됨:",l.inPrice)):!n&&t?(p.value="O",console.log("출고단가만 변경됨:",l.outPrice)):n&&t&&(p.value="A",console.log("입고단가와 출고단가 모두 변경됨:",l.inPrice,l.outPrice))},me=()=>{P.value=!0},W=()=>{ne.push({name:"ItemList"})};return(n,t)=>{const f=u("v-breadcrumbs"),ce=u("v-card-item"),d=u("v-text-field"),i=u("v-col"),r=u("v-select"),y=u("v-row"),J=u("v-icon"),K=u("v-card-title"),w=u("v-divider"),Q=u("v-list-item"),X=u("v-list"),C=u("v-btn"),Z=u("v-card-actions"),D=u("v-card"),h=u("v-menu"),pe=u("v-textarea"),ve=u("v-card-text"),fe=u("v-form"),ye=u("v-dialog");return V(),S(G,null,[m("div",{id:n.$attrs.id},null,8,Ue),e(f,{items:["MES","기본관리","품목관리"]}),e(D,null,{default:o(()=>[e(ce,{title:`품목코드 : ${c(L).params.id}`},null,8,["title"]),e(fe,{onSubmit:we(re,["prevent"])},{default:o(()=>[e(ve,null,{default:o(()=>[e(y,null,{default:o(()=>[e(i,{cols:"6"},{default:o(()=>[e(d,{modelValue:l.itemName,"onUpdate:modelValue":t[0]||(t[0]=a=>l.itemName=a),label:"품목명",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(i,{class:"d-flex ga-6"},{default:o(()=>[e(r,{modelValue:l.itemTypeCd,"onUpdate:modelValue":t[1]||(t[1]=a=>l.itemTypeCd=a),label:"품목구분",items:H.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",readonly:"",style:{width:"80px"}},null,8,["modelValue","items"]),z.value?(V(),E(r,{key:0,modelValue:l.useCate,"onUpdate:modelValue":t[2]||(t[2]=a=>l.useCate=a),label:"사용구분",items:F.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",readonly:"",style:{width:"80px"}},null,8,["modelValue","items"])):xe("",!0)]),_:1}),e(i,null,{default:o(()=>[e(d,{modelValue:l.category,"onUpdate:modelValue":t[3]||(t[3]=a=>l.category=a),label:"용도",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,null,{default:o(()=>[e(i,null,{default:o(()=>[e(r,{modelValue:l.itemCategory1,"onUpdate:modelValue":t[4]||(t[4]=a=>l.itemCategory1=a),label:"대분류",items:T.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(i,null,{default:o(()=>[e(r,{modelValue:l.itemCategory2,"onUpdate:modelValue":t[5]||(t[5]=a=>l.itemCategory2=a),label:"중분류",items:b.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(i,null,{default:o(()=>[e(d,{modelValue:l.safeStock,"onUpdate:modelValue":t[6]||(t[6]=a=>l.safeStock=a),label:"안전재고",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(d,{modelValue:l.avgDeliveryDate,"onUpdate:modelValue":t[7]||(t[7]=a=>l.avgDeliveryDate=a),label:"평균납품소요일",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,null,{default:o(()=>[e(i,null,{default:o(()=>[e(d,{modelValue:l.customerName,"onUpdate:modelValue":t[8]||(t[8]=a=>l.customerName=a),label:"거래처명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":me},null,8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(r,{modelValue:l.itemGrp1,"onUpdate:modelValue":t[9]||(t[9]=a=>l.itemGrp1=a),label:"거래유형",items:R.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(i,null,{default:o(()=>[e(r,{modelValue:l.itemGrp2,"onUpdate:modelValue":t[10]||(t[10]=a=>l.itemGrp2=a),label:"제품유형",items:O.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(i,null,{default:o(()=>[e(d,{modelValue:l.unit,"onUpdate:modelValue":t[11]||(t[11]=a=>l.unit=a),label:"단위",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,null,{default:o(()=>[e(i,null,{default:o(()=>[e(d,{modelValue:l.spec,"onUpdate:modelValue":t[12]||(t[12]=a=>l.spec=a),label:"SPEC",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(d,{"model-value":c(U)(l.inPrice),label:"입고단가",variant:"underlined",density:"compact","onUpdate:modelValue":t[13]||(t[13]=a=>l.inPrice=c(ae)(a)),onBlur:q},null,8,["model-value"])]),_:1}),e(i,{cols:"auto",class:"pl-0"},{default:o(()=>[e(h,{modelValue:N.value,"onUpdate:modelValue":t[15]||(t[15]=a=>N.value=a),activator:"parent","offset-y":""},{activator:o(({props:a})=>[e(J,le(a,{color:"grey",size:"small",class:"mt-2"}),{default:o(()=>t[23]||(t[23]=[x(" mdi-information-outline ")])),_:2},1040)]),default:o(()=>[e(D,{"min-width":"250"},{default:o(()=>[e(K,{class:"text-subtitle-2 font-weight-bold"},{default:o(()=>t[24]||(t[24]=[x(" 입고단가 변경 이력 ")])),_:1}),e(w),e(X,{density:"compact"},{default:o(()=>[(V(!0),S(G,null,te(Y.value,(a,M)=>(V(),E(Q,{key:M},{default:o(()=>[m("div",Ne,[m("span",null,I(a.historyDate),1),m("span",null,I(c(U)(a.price))+" 원",1)])]),_:2},1024))),128))]),_:1}),e(w),e(Z,{class:"justify-end"},{default:o(()=>[e(C,{text:"닫기",size:"small",onClick:t[14]||(t[14]=a=>N.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(d,{"model-value":c(U)(l.outPrice),label:"출고단가",variant:"underlined",density:"compact","onUpdate:modelValue":t[16]||(t[16]=a=>l.outPrice=c(ae)(a)),onBlur:q},null,8,["model-value"])]),_:1}),e(i,{cols:"auto",class:"pl-0"},{default:o(()=>[e(h,{modelValue:k.value,"onUpdate:modelValue":t[18]||(t[18]=a=>k.value=a),activator:"parent","offset-y":""},{activator:o(({props:a})=>[e(J,le(a,{color:"grey",size:"small",class:"mt-2"}),{default:o(()=>t[25]||(t[25]=[x(" mdi-information-outline ")])),_:2},1040)]),default:o(()=>[e(D,{"min-width":"250"},{default:o(()=>[e(K,{class:"text-subtitle-2 font-weight-bold"},{default:o(()=>t[26]||(t[26]=[x(" 출고단가 변경 이력 ")])),_:1}),e(w),e(X,{density:"compact"},{default:o(()=>[(V(!0),S(G,null,te($.value,(a,M)=>(V(),E(Q,{key:M},{default:o(()=>[m("div",ke,[m("span",null,I(a.historyDate),1),m("span",null,I(c(U)(a.price))+" 원",1)])]),_:2},1024))),128))]),_:1}),e(w),e(Z,{class:"justify-end"},{default:o(()=>[e(C,{text:"닫기",size:"small",onClick:t[17]||(t[17]=a=>k.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(r,{modelValue:l.useYn,"onUpdate:modelValue":t[19]||(t[19]=a=>l.useYn=a),label:"사용유무",items:ie,"item-title":"text","item-value":"value",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,null,{default:o(()=>[e(i,null,{default:o(()=>[e(pe,{modelValue:l.etc,"onUpdate:modelValue":t[20]||(t[20]=a=>l.etc=a),label:"비고","row-height":"15",rows:"2",variant:"outlined","auto-grow":""},null,8,["modelValue"])]),_:1})]),_:1}),e(y,null,{default:o(()=>[e(i,{class:"d-flex ga-4 justify-end mt-1"},{default:o(()=>[e(C,{color:"indigo-darken-4",text:"단가저장",variant:"tonal",onClick:de,depressed:""}),e(C,{color:"indigo-darken-4",text:"저장",variant:"tonal",type:"submit"}),e(C,{text:"목록",variant:"tonal",onClick:W})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ye,{modelValue:P.value,"onUpdate:modelValue":t[22]||(t[22]=a=>P.value=a),"max-width":"800px",height:"900px",persistent:""},{default:o(()=>[e(Ie,{onSelected:se,onCloseDialog:t[21]||(t[21]=a=>P.value=!1)})]),_:1},8,["modelValue"])],64)}}};export{Ae as default};
