import{_ as ee,a as ge,u as ye,e as oe,v as fe,r as y,k as he,m as ie,C as Y,n as te,d,c as B,o as D,f as o,g as e,w as t,j as se,t as c,E as U,G as P,F as R,x as de,y as Z,b as xe,z as we,h as z,i as G}from"./index-BNL3Tgw5.js";import{e as be}from"./exportToExcel-Kkbtezxo.js";import{h as Ve,f as re,i as ke}from"./common-BOBTT4pT.js";import{A as H}from"./apiOrders-Whxuw2Cj.js";import{_ as X}from"./DateSinglePicker-8DAkXH4C.js";import{_ as Ne}from"./CustomerListPop-C12lnYGL.js";import{_ as Ce}from"./UserListPop-DEkQwN6k.js";import{_ as Se}from"./StorageListPop-DItQtyxf.js";import{_ as $e}from"./MultiFileUpload--c0CfwPP.js";import{I as Ie}from"./ItemListSinglePop-B9yN6Coo.js";import{A as ne}from"./apiCommon-LY9rUrf-.js";import"./_commonjsHelpers-CZnAS8i4.js";import"./format-CBpsKyOP.js";import"./apiBase-CSC4uJMW.js";import"./filedownLoad-DSISiZ_u.js";import"./apiItem-CL-1bRvd.js";const Ue=["id"],Pe=["onUpdate:modelValue","onDblclick"],De=["onUpdate:modelValue"],qe=["onUpdate:modelValue"],Le=["onUpdate:modelValue","onBlur"],Fe=["onUpdate:modelValue","onBlur"],Te=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Ae=["onUpdate:modelValue"],Ee={class:"summary-row"},Me={style:{width:"110px","text-align":"right","font-weight":"bold"}},je={style:{width:"110px","text-align":"right","font-weight":"bold"}},Oe={style:{width:"100px","text-align":"right","font-weight":"bold"}},Re={style:{width:"150px","text-align":"right","font-weight":"bold"}},Je={class:"d-flex ga-4 justify-end"},We={__name:"ContractDetailPop",setup(Q){const{userId:A}=ge(),{vError:q,vSuccess:k,vWarning:L}=ye(),E=oe(),x=fe(null),_=y(!1),F=he().params.id,C=y(null);let S=y("");const w=y([]),a=y([]),m=y([]),T=y([]),s=ie({contractDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",transactionType:"",paymentCondition:"",expiryDate:"",tradingMethod:"",currencyType:"",dueDate:"",contractId:"",attachFileId:"",userId:A}),N=y([{title:"품목코드 ",key:"itemCd",align:"center",width:90},{title:"품목명",key:"itemName",align:"center",width:300},{title:"규격",key:"unit",align:"center",width:70},{title:"수량",key:"qty",align:"center",width:110},{title:"단가",key:"unitPrice",align:"center",width:110},{title:"공급가액",key:"supplyPrice",align:"center",width:110},{title:"부가세",key:"vatPrice",align:"center",width:100},{title:"적용",key:"etc",align:"center",width:150}]),M=Y(()=>a.value.reduce((i,l)=>i+Number(l.qty||0),0)),$=Y(()=>a.value.reduce((i,l)=>i+Number(l.supplyPrice||0),0)),I=Y(()=>a.value.reduce((i,l)=>i+Number(l.vatPrice||0),0)),v=Y(()=>$.value+I.value),O=i=>{let l=Number(a.value[i].qty),b=Number(a.value[i].unitPrice);!isNaN(l)&&!isNaN(b)?a.value[i].supplyPrice=l*b:a.value[i].supplyPrice=0,isNaN(a.value[i].supplyPrice)?a.value[i].vatPrice=0:a.value[i].vatPrice=Ve(a.value[i].supplyPrice)},K=(i,l)=>{switch(S.value){case"C":s.customerName=l,s.customerCd=i;break;case"U":s.managerName=l,s.managerId=i;break;case"S":s.descStorageName=l,s.descStorageCd=i;break;case"I":if(C.value!==null){const b=a.value[C.value];b.itemCd=i,b.itemName=l}break}S.value="",_.value=!1},u=async()=>{const i=new FormData;try{const l={...s};i.append("contractInfo",JSON.stringify(l)),i.append("itemList",JSON.stringify(a.value));const b=[];w.value.forEach(f=>{f.flag==="N"?i.append("newFiles",f.file):f.flag==="D"&&b.push({attachFileId:f.attachFileId,seq:f.seq})}),i.append("keptFiles",JSON.stringify(w.value.filter(f=>f.flag==="S"))),b.length>0&&i.append("deleteFiles",new Blob([JSON.stringify(b)],{type:"application/json"}));const W=await H.updateContractInfo(i);k(W),V()}catch(l){q(l.message)}},V=async()=>{T.value=await ne.getCodeList("currency_type"),m.value=await ne.getCodeList("vat_rate");const i=await H.getContractInfo(F);Object.assign(s,i.contractInfo),a.value=i.itemList,i.attachFileInfo!==null?w.value=i.attachFileInfo:w.value=[],a.value.length};te(async()=>{V()});const J=i=>{switch(S.value=i,i){case"C":x.value=Ne;break;case"U":x.value=Ce;break;case"S":x.value=Se;break;default:S.value="I",C.value=i,x.value=Ie;break}_.value=!0},ue=()=>{E.push({name:"ContractList"})};return(i,l)=>{const b=d("v-breadcrumbs"),W=d("v-card-item"),f=d("v-text-field"),h=d("v-col"),j=d("v-row"),le=d("v-select"),ae=d("v-card-text"),me=d("v-data-table-virtual"),ce=d("v-btn"),pe=d("v-form"),ve=d("v-card"),_e=d("v-dialog");return D(),B(R,null,[o("div",{id:i.$attrs.id},null,8,Ue),e(b,{items:["MES","수주관리","주문상세"]}),e(ve,null,{default:t(()=>[e(W,{title:"주문서상세"}),e(pe,{ref:"vform",onSubmit:se(u,["prevent"])},{default:t(()=>[e(ae,null,{default:t(()=>[e(j,null,{default:t(()=>[e(h,{class:"d-flex flex-row align-center"},{default:t(()=>[e(X,{modelValue:s.contractDate,"onUpdate:modelValue":l[0]||(l[0]=n=>s.contractDate=n),title:"주문일자",density:"compact",width:"120",readonly:""},null,8,["modelValue"]),e(f,{modelValue:s.seq,"onUpdate:modelValue":l[1]||(l[1]=n=>s.seq=n),density:"compact",width:"20",readonly:""},null,8,["modelValue"])]),_:1}),e(h),e(h,null,{default:t(()=>[e(X,{modelValue:s.expiryDate,"onUpdate:modelValue":l[2]||(l[2]=n=>s.expiryDate=n),title:"유효기간",density:"compact",width:"120"},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(X,{modelValue:s.dueDate,"onUpdate:modelValue":l[3]||(l[3]=n=>s.dueDate=n),title:"납기일자",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(h,{cols:"6"},{default:t(()=>[e(f,{modelValue:s.customerName,"onUpdate:modelValue":l[4]||(l[4]=n=>s.customerName=n),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":l[5]||(l[5]=n=>J("C"))},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(f,{modelValue:s.managerName,"onUpdate:modelValue":l[6]||(l[6]=n=>s.managerName=n),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":l[7]||(l[7]=n=>J("U"))},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(f,{modelValue:s.descStorageName,"onUpdate:modelValue":l[8]||(l[8]=n=>s.descStorageName=n),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":l[9]||(l[9]=n=>J("S"))},null,8,["modelValue"])]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(h,null,{default:t(()=>[e(le,{modelValue:s.transactionType,"onUpdate:modelValue":l[10]||(l[10]=n=>s.transactionType=n),label:"거래유형",items:m.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(h,null,{default:t(()=>[e(le,{modelValue:s.currencyType,"onUpdate:modelValue":l[11]||(l[11]=n=>s.currencyType=n),label:"통화",items:T.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(h,null,{default:t(()=>[e(f,{modelValue:s.paymentCondition,"onUpdate:modelValue":l[12]||(l[12]=n=>s.paymentCondition=n),label:"결재조건",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(f,{modelValue:s.tradingMethod,"onUpdate:modelValue":l[13]||(l[13]=n=>s.tradingMethod=n),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(h,{cols:"12"},{default:t(()=>[e($e,{modelValue:w.value,"onUpdate:modelValue":l[14]||(l[14]=n=>w.value=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(W,{title:"품목목록",style:{height:"40px"}}),e(ae,null,{default:t(()=>[e(j,null,{default:t(()=>[e(h,{cols:"12"},{default:t(()=>[e(me,{headers:N.value,items:a.value,"item-value":"id"},{headers:t(({columns:n})=>[o("tr",null,[(D(!0),B(R,null,de(n,r=>(D(),B("th",{key:r.key,class:"custom-header",style:Z([{height:"30px"},{width:r.width+"px",minWidth:r.width+"px",maxWidth:r.width+"px"}])},c(r.title),5))),128))])]),"item.itemCd":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].itemCd=p,style:{"text-align":"center",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-input",onDblclick:p=>J(r)},null,40,Pe),[[P,a.value[r].itemCd]])]),"item.itemName":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].itemName=p,style:{"text-align":"left",width:"250px","min-width":"250px","max-width":"250px"},class:"custom-input",readonly:""},null,8,De),[[P,a.value[r].itemName]])]),"item.unit":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].unit=p,style:{"text-align":"center",width:"80px","min-width":"80px","max-width":"80px"},class:"custom-line"},null,8,qe),[[P,a.value[r].unit]])]),"item.qty":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].qty=p,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:p=>O(r)},null,40,Le),[[P,a.value[r].qty]])]),"item.unitPrice":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].unitPrice=p,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:p=>O(r)},null,40,Fe),[[P,a.value[r].unitPrice]])]),"item.supplyPrice":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].supplyPrice=p,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line"},null,8,Te),[[P,a.value[r].supplyPrice]])]),"item.vatPrice":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].vatPrice=p,type:"number",style:{"text-align":"right",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-line"},null,8,Be),[[P,a.value[r].vatPrice,void 0,{number:!0}]])]),"item.etc":t(({item:n,index:r})=>[U(o("input",{"onUpdate:modelValue":p=>a.value[r].etc=p,type:"text",style:{"text-align":"left",width:"150px","min-width":"150px","max-width":"150px"},class:"custom-line"},null,8,Ae),[[P,a.value[r].etc]])]),"body.append":t(()=>[o("tr",Ee,[l[17]||(l[17]=o("td",{style:{width:"100px"}},null,-1)),l[18]||(l[18]=o("td",{style:{width:"250px"}},null,-1)),l[19]||(l[19]=o("td",{style:{width:"80px"}},null,-1)),o("td",Me,c(M.value.toLocaleString()),1),l[20]||(l[20]=o("td",{style:{width:"110px"}},null,-1)),o("td",je,c($.value.toLocaleString()),1),o("td",Oe,c(I.value.toLocaleString()),1),o("td",Re,c(v.value.toLocaleString()),1)])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),e(j,{class:"mt-2 mb-2"},{default:t(()=>[e(h,null,{default:t(()=>[o("div",Je,[e(ce,{text:"목록",class:"mr-3",onClick:ue})])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(_e,{modelValue:_.value,"onUpdate:modelValue":l[16]||(l[16]=n=>_.value=n),width:"800px",height:"800px",persistent:""},{default:t(()=>[(D(),xe(we(x.value),{id:i.id,onSelected:K,onCloseDialog:l[15]||(l[15]=n=>_.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"])],64)}}},Ye=ee(We,[["__scopeId","data-v-78fb1bf0"]]),ze={class:"cell fixed",style:{cursor:"pointer"}},Ge={class:"cell wrap",style:{"text-decoration":"underline"}},He={class:"cell fixed"},Qe={class:"cell fixed"},Ke=["onClick"],Xe={__name:"SalePop",props:{id:{type:String},no:{type:String}},emits:["close-dialog"],setup(Q,{emit:A}){const q=y([]),k=A,L=Q,E=[{title:"품목코드",key:"itemCd",align:"center"},{title:"품목명",key:"itemName",align:"left"},{title:"규격",key:"unit",align:"center"},{title:"수량",key:"qty",align:"center"},{title:"주문서",key:"contractDateSeq",align:"center"}];te(async()=>{q.value=await H.getSaleItemList(L.id)});const x=()=>{};return(_,g)=>{const F=d("v-toolbar-title"),C=d("v-spacer"),S=d("v-icon"),w=d("v-btn"),a=d("v-toolbar"),m=d("v-card-subtitle"),T=d("v-card-item"),s=d("v-data-table-virtual"),N=d("v-col"),M=d("v-row"),$=d("v-card"),I=d("v-dialog");return D(),B(R,null,[e(a,{height:"40",class:"d-flex align-center justify-space-between px-2 toolbar-Head"},{default:t(()=>[e(F,null,{default:t(()=>g[3]||(g[3]=[z("주문서 목록")])),_:1}),e(C),e(w,{icon:"",onClick:g[0]||(g[0]=v=>k("close-dialog"))},{default:t(()=>[e(S,null,{default:t(()=>g[4]||(g[4]=[z("mdi-close")])),_:1})]),_:1})]),_:1}),e($,{elevation:"16"},{default:t(()=>[e(T,null,{default:t(()=>[e(m,{class:"mt-4"},{default:t(()=>[z(" 판매조회 : "+c(L.no),1)]),_:1})]),_:1}),e(T,{class:"py-1"},{default:t(()=>[e(M,null,{default:t(()=>[e(N,null,{default:t(()=>[e(s,{headers:E,items:q.value,class:"my-data-table","fixed-header":""},{"item.itemCd":t(({item:v})=>[o("span",ze,c(v.itemCd),1)]),"item.itemName":t(({item:v})=>[o("span",Ge,c(v.itemName),1)]),"item.unit":t(({item:v})=>[o("span",He,c(v.unit),1)]),"item.qty":t(({item:v})=>[o("span",Qe,c(G(re)(v.qty)),1)]),"item.contractDateSeq":t(({item:v})=>[o("span",{class:"cell fixed",style:{"text-decoration":"underline",cursor:"pointer"},onClick:O=>x(v.contractId)},c(v.contractDateSeq),9,Ke)]),_:1},8,["items"])]),_:1})]),_:1}),e(M,null,{default:t(()=>[e(N,{class:"d-flex justify-end"},{default:t(()=>[e(w,{text:"닫기",variant:"tonal",onClick:g[1]||(g[1]=v=>k("close-dialog"))})]),_:1})]),_:1})]),_:1})]),_:1}),g[5]||(g[5]=z("> ")),e(I,null,{default:t(()=>[e(Ye,{id:_.saleId,onCloseDialog:g[2]||(g[2]=v=>_.dialog=!1)},null,8,["id"])]),_:1})],64)}}},Ze=ee(Xe,[["__scopeId","data-v-7ffe5a28"]]),et={class:"d-flex ga-5"},tt={class:"d-flex ga-4 justify-end"},lt={style:{height:"30px"}},at=["onClick"],nt=["onClick"],ot={style:{width:"200px",height:"30px","text-align":"center"}},it={style:{width:"90px",height:"30px","text-align":"center"}},st={style:{width:"100px",height:"30px","text-align":"right"}},dt={style:{width:"90px",height:"30px","text-align":"center"}},rt={style:{width:"90px",height:"30px","text-align":"center"}},ut={style:{width:"40px",height:"30px","text-align":"center"}},mt=["onClick"],ct={__name:"SaleList",setup(Q){let A=y(""),q=y("");const k=y(!1),L=y([]),E=oe(),x=y(!1),_=ie({itemName:"",managerName:"",customerName:"",customerCd:""}),g=y([{title:"일자-No.",key:"saleDateSeq",align:"center"},{title:"품목명",key:"itemName",align:"center"},{title:"거래처명",key:"customerName",align:"center"},{title:"담당자명",key:"managerName",align:"center"},{title:"금액 합계",key:"totPrice",align:"center"},{title:"거래유형명     ",key:"totUnitPrice",align:"center"},{title:"창고명",key:"statusType",align:"center"},{title:"인쇄",key:"printYn",align:"center"},{title:"주문서",key:"saleId",align:"center"}]);te(async()=>{C()});const F=a=>{ke(a)?E.push({name:"SaleReg"}):E.push({name:"SaleDetail",params:{id:a}})},C=async()=>{x.value=!0;const a={..._};L.value=await H.getSaleList(a),x.value=!1},S=(a,m)=>{q.value=a,A.value=m,k.value=!0},w=()=>{be(g,L.value,"수주_목록")};return(a,m)=>{const T=d("v-breadcrumbs"),s=d("v-text-field"),N=d("v-btn"),M=d("v-form"),$=d("v-col"),I=d("v-row"),v=d("v-card"),O=d("v-data-table"),K=d("v-dialog");return D(),B(R,null,[e(T,{items:["MES","영업관리","판매관리"],class:"custom-breadcrumbs"}),e(v,{class:"pa-1",variant:"outlined",style:{height:"60px"}},{default:t(()=>[e(I,{class:"mt-1"},{default:t(()=>[e($,{class:"ml-2 mr-2"},{default:t(()=>[e(M,{ref:"srhForm",onSubmit:se(C,["prevent"])},{default:t(()=>[o("div",et,[e(s,{modelValue:_.itemName,"onUpdate:modelValue":m[0]||(m[0]=u=>_.itemName=u),label:"품목명",placeholder:"품목명을 입력해주세요",variant:"underlined",density:"compact"},null,8,["modelValue"]),e(s,{modelValue:_.managerName,"onUpdate:modelValue":m[1]||(m[1]=u=>_.managerName=u),label:"담당자명",placeholder:"담당자을 입력해주세요",variant:"underlined",density:"compact"},null,8,["modelValue"]),e(s,{modelValue:_.customerName,"onUpdate:modelValue":m[2]||(m[2]=u=>_.customerName=u),label:"거래처명",placeholder:"거래처명을 입력해주세요",variant:"underlined",density:"compact"},null,8,["modelValue"]),e(N,{text:"조회",variant:"tonal",type:"submit"}),e(N,{text:"초기화",onClick:m[3]||(m[3]=u=>a.srhForm.reset())})])]),_:1},512)]),_:1})]),_:1})]),_:1}),e(I,{style:{height:"70px"}},{default:t(()=>[e($,null,{default:t(()=>[o("div",tt,[e(N,{dense:"",color:"brown-lighten-4",class:"mt-3",text:"신규",onClick:m[4]||(m[4]=u=>F())}),e(N,{class:"mt-3 mr-2 excel-btn",text:"엑셀","prepend-icon":"mdi-microsoft-excel",onClick:w})])]),_:1})]),_:1}),e(I,null,{default:t(()=>[e($,null,{default:t(()=>[e(O,{headers:g.value,items:L.value,loading:x.value,"no-data-text":"데이터가 없습니다.","loading-text":"조회중입니다 잠시만 기다려주세요","items-per-page":15},{headers:t(({columns:u})=>[o("tr",null,[(D(!0),B(R,null,de(u,V=>(D(),B("th",{key:V.key,class:"custom-header",style:Z([{height:"30px"},{textAlign:"center"}])},c(V.title),1))),128))])]),item:t(({item:u})=>[o("tr",lt,[o("td",{style:{width:"100px",height:"30px","text-align":"center","text-decoration":"underline",cursor:"pointer"},onClick:V=>F(u.saleId)},c(u.saleDateSeq),9,at),o("td",{style:{width:"200px",height:"30px","text-decoration":"underline",cursor:"pointer"},onClick:V=>F(u.saleId)},c(u.itemName),9,nt),o("td",ot,c(u.customerName),1),o("td",it,c(u.managerName),1),o("td",st,c(G(re)(u.totPrice)),1),o("td",dt,c(u.transactionTypeName),1),o("td",rt,c(u.descStorageName),1),o("td",ut,[o("p",{style:Z([{padding:"4px","text-align":"center",cursor:"pointer"},{backgroundColor:u.printYn==="Y"?"#FFAB91":"transparent"}]),onClick:m[5]||(m[5]=(...V)=>a.onPrint&&a.onPrint(...V))}," 인쇄 ",4)]),o("td",{style:{width:"60px",height:"30px","text-align":"center",cursor:"pointer"},onClick:V=>S(u.saleId,u.saleDateSeq)},"주문서",8,mt)])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1}),e(K,{modelValue:k.value,"onUpdate:modelValue":m[7]||(m[7]=u=>k.value=u),width:"1000px",height:"400px",persistent:""},{default:t(()=>[e(Ze,{id:G(q),no:G(A),onCloseDialog:m[6]||(m[6]=u=>k.value=!1)},null,8,["id","no"])]),_:1},8,["modelValue"])],64)}}},It=ee(ct,[["__scopeId","data-v-552df94b"]]);export{It as default};
