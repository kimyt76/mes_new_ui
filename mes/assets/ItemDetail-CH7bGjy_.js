import{a as _e,u as Ve,r as d,p as ge,k as te,m as Ce,A as V,q as Pe,c as A,f as c,g as e,d as u,w as o,F as B,e as we,o as g,i as p,j as be,b as j,s as xe,h as I,n as le,t as U,v as ae}from"./index-DjI8e8VZ.js";import{A as v}from"./apiItem-slwuKuQH.js";import{p as oe,f as N}from"./common-DeQ1G7iv.js";import{C as Ie}from"./CustomerListPop-JvGKSwu5.js";import"./format-DWu4U6B8.js";import"./apiBase-CRBLZO_5.js";const Ue=["id"],Ne={class:"d-flex justify-space-between w-100"},ke={class:"d-flex justify-space-between w-100"},Ae={__name:"ItemDetail",setup(Te){const{userId:H}=_e(),{vError:R,vSuccess:Y,vWarning:ne}=Ve(),f=d(""),k=d(!1),T=d([]),L=d(!1),D=d([]),P=d(!1),$=d(!1),M=ge(),ie=we(),z=d([]),O=d([]),F=d([]),q=d([]),S=d([]),w=d([]),ue=[{text:"사용",value:"Y"},{text:"미사용",value:"N"}],se=M.params.id,a=te({itemCd:se,itemTypeCd:"",itemName:"",customerName:"",customerCd:"",itemGrp1:"",itemGrp2:"",useCate:"",inPrice:"",outPrice:"",itemCategory1:"",itemCategory2:"",etc:"",useYn:"",safeStock:"",avgDeliveryDate:"",unit:"",spec:"",category:"",userId:H});Ce(async()=>{z.value=await V.getCodeList("ITEM_TYPE_CD"),O.value=await V.getCodeList("ITEM_GRP1"),F.value=await V.getCodeList("ITEM_GRP2");const i=await v.getItemInfo(M.params.id);Object.assign(a,i),T.value=i.priceHistory.filter(t=>t.priceType==="I"),D.value=i.priceHistory.filter(t=>t.priceType==="O"),y.inPrice=a.inPrice,y.outPrice=a.outPrice,["M2","M7"].includes(i.itemTypeCd)?(q.value=await V.getCodeList("use_Cate"),S.value=await V.getCodeList("order_cate"),w.value=await V.getCodeList("sub_item"),$.value=!0):(S.value=await v.getProdLList(),w.value=await v.getProdMList(i.itemCategory1))});const de=i=>{a.customerCd=i.customerCd,a.customerName=i.customerName},re=async()=>{var t;if(!f.value){ne("변경된 단가가 없습니다.");return}const i={type:f.value,itemCd:a.itemCd,inPrice:a.inPrice,outPrice:a.outPrice,userId:H};try{const _=await v.updatePriceInfo(i);Y(_);const b=await v.getItemInfo(a.itemCd);T.value=b.priceHistory.filter(s=>s.priceType==="I"),D.value=b.priceHistory.filter(s=>s.priceType==="O"),y.inPrice=a.inPrice,y.outPrice=a.outPrice,f.value=""}catch(_){console.error(_),R(((t=_.response)==null?void 0:t.data)||"단가 변경 중 오류가 발생했습니다.")}},me=async()=>{try{const i={...a},t=await v.updateItemInfo(i);Y(t),J()}catch{R("저장에 실패했습니다.")}};Pe(()=>a.itemCategory1,async i=>{w.value=await v.getProdMList(a.itemCategory1)});const y=te({inPrice:null,outPrice:null}),W=()=>{const i=a.inPrice!==y.inPrice,t=a.outPrice!==y.outPrice;i&&!t?f.value="I":!i&&t?f.value="O":i&&t&&(f.value="A")},ce=()=>{P.value=!0},J=()=>{ie.push({name:"ItemList"})};return(i,t)=>{const _=u("v-breadcrumbs"),b=u("v-card-item"),s=u("v-text-field"),n=u("v-col"),r=u("v-select"),m=u("v-row"),K=u("v-icon"),Q=u("v-card-title"),x=u("v-divider"),X=u("v-list-item"),Z=u("v-list"),C=u("v-btn"),h=u("v-card-actions"),G=u("v-card"),ee=u("v-menu"),pe=u("v-textarea"),ve=u("v-card-text"),fe=u("v-form"),ye=u("v-dialog");return g(),A(B,null,[c("div",{id:i.$attrs.id},null,8,Ue),e(_,{items:["MES","기본관리","품목관리"]}),e(G,null,{default:o(()=>[e(b,{title:`품목코드 : ${p(M).params.id}`},null,8,["title"]),e(fe,{onSubmit:be(me,["prevent"])},{default:o(()=>[e(ve,null,{default:o(()=>[e(m,null,{default:o(()=>[e(n,{cols:"6"},{default:o(()=>[e(s,{modelValue:a.itemName,"onUpdate:modelValue":t[0]||(t[0]=l=>a.itemName=l),label:"품목명",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(n,{class:"d-flex ga-6"},{default:o(()=>[e(r,{modelValue:a.itemTypeCd,"onUpdate:modelValue":t[1]||(t[1]=l=>a.itemTypeCd=l),label:"품목구분",items:z.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",readonly:"",style:{width:"80px"}},null,8,["modelValue","items"]),$.value?(g(),j(r,{key:0,modelValue:a.useCate,"onUpdate:modelValue":t[2]||(t[2]=l=>a.useCate=l),label:"사용구분",items:q.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",readonly:"",style:{width:"80px"}},null,8,["modelValue","items"])):xe("",!0)]),_:1}),e(n,null,{default:o(()=>[e(s,{modelValue:a.category,"onUpdate:modelValue":t[3]||(t[3]=l=>a.category=l),label:"용도",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(n,null,{default:o(()=>[e(r,{modelValue:a.itemCategory1,"onUpdate:modelValue":t[4]||(t[4]=l=>a.itemCategory1=l),label:"대분류",items:S.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(n,null,{default:o(()=>[e(r,{modelValue:a.itemCategory2,"onUpdate:modelValue":t[5]||(t[5]=l=>a.itemCategory2=l),label:"중분류",items:w.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(n,null,{default:o(()=>[e(s,{modelValue:a.safeStock,"onUpdate:modelValue":t[6]||(t[6]=l=>a.safeStock=l),label:"안전재고",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(s,{modelValue:a.avgDeliveryDate,"onUpdate:modelValue":t[7]||(t[7]=l=>a.avgDeliveryDate=l),label:"평균납품소요일",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(n,null,{default:o(()=>[e(s,{modelValue:a.customerName,"onUpdate:modelValue":t[8]||(t[8]=l=>a.customerName=l),label:"거래처명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":ce},null,8,["modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(r,{modelValue:a.itemGrp1,"onUpdate:modelValue":t[9]||(t[9]=l=>a.itemGrp1=l),label:"거래유형",items:O.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(n,null,{default:o(()=>[e(r,{modelValue:a.itemGrp2,"onUpdate:modelValue":t[10]||(t[10]=l=>a.itemGrp2=l),label:"제품유형",items:F.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),e(n,null,{default:o(()=>[e(s,{modelValue:a.unit,"onUpdate:modelValue":t[11]||(t[11]=l=>a.unit=l),label:"단위",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(n,null,{default:o(()=>[e(s,{modelValue:a.spec,"onUpdate:modelValue":t[12]||(t[12]=l=>a.spec=l),label:"SPEC",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(s,{"model-value":p(N)(a.inPrice),label:"입고단가",variant:"underlined",density:"compact","onUpdate:modelValue":t[13]||(t[13]=l=>a.inPrice=p(oe)(l)),onBlur:W},null,8,["model-value"])]),_:1}),e(n,{cols:"auto",class:"pl-0"},{default:o(()=>[e(ee,{modelValue:k.value,"onUpdate:modelValue":t[15]||(t[15]=l=>k.value=l),activator:"parent","offset-y":""},{activator:o(({props:l})=>[e(K,ae(l,{color:"grey",size:"small",class:"mt-2"}),{default:o(()=>t[23]||(t[23]=[I(" mdi-information-outline ")])),_:2},1040)]),default:o(()=>[e(G,{"min-width":"250"},{default:o(()=>[e(Q,{class:"text-subtitle-2 font-weight-bold"},{default:o(()=>t[24]||(t[24]=[I(" 입고단가 변경 이력 ")])),_:1}),e(x),e(Z,{density:"compact"},{default:o(()=>[(g(!0),A(B,null,le(T.value,(l,E)=>(g(),j(X,{key:E},{default:o(()=>[c("div",Ne,[c("span",null,U(l.historyDate),1),c("span",null,U(p(N)(l.price))+" 원",1)])]),_:2},1024))),128))]),_:1}),e(x),e(h,{class:"justify-end"},{default:o(()=>[e(C,{text:"닫기",size:"small",onClick:t[14]||(t[14]=l=>k.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(s,{"model-value":p(N)(a.outPrice),label:"출고단가",variant:"underlined",density:"compact","onUpdate:modelValue":t[16]||(t[16]=l=>a.outPrice=p(oe)(l)),onBlur:W},null,8,["model-value"])]),_:1}),e(n,{cols:"auto",class:"pl-0"},{default:o(()=>[e(ee,{modelValue:L.value,"onUpdate:modelValue":t[18]||(t[18]=l=>L.value=l),activator:"parent","offset-y":""},{activator:o(({props:l})=>[e(K,ae(l,{color:"grey",size:"small",class:"mt-2"}),{default:o(()=>t[25]||(t[25]=[I(" mdi-information-outline ")])),_:2},1040)]),default:o(()=>[e(G,{"min-width":"250"},{default:o(()=>[e(Q,{class:"text-subtitle-2 font-weight-bold"},{default:o(()=>t[26]||(t[26]=[I(" 출고단가 변경 이력 ")])),_:1}),e(x),e(Z,{density:"compact"},{default:o(()=>[(g(!0),A(B,null,le(D.value,(l,E)=>(g(),j(X,{key:E},{default:o(()=>[c("div",ke,[c("span",null,U(l.historyDate),1),c("span",null,U(p(N)(l.price))+" 원",1)])]),_:2},1024))),128))]),_:1}),e(x),e(h,{class:"justify-end"},{default:o(()=>[e(C,{text:"닫기",size:"small",onClick:t[17]||(t[17]=l=>L.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:o(()=>[e(r,{modelValue:a.useYn,"onUpdate:modelValue":t[19]||(t[19]=l=>a.useYn=l),label:"사용유무",items:ue,"item-title":"text","item-value":"value",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(n),e(n)]),_:1}),e(m,null,{default:o(()=>[e(n,null,{default:o(()=>[e(pe,{modelValue:a.etc,"onUpdate:modelValue":t[20]||(t[20]=l=>a.etc=l),label:"비고","row-height":"15",rows:"2",variant:"outlined","auto-grow":""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,null,{default:o(()=>[e(n,{class:"d-flex ga-4 justify-end mt-1"},{default:o(()=>[e(C,{color:"indigo-darken-4",text:"단가저장",variant:"tonal",onClick:re,depressed:""}),e(C,{color:"indigo-darken-4",text:"저장",variant:"tonal",type:"submit"}),e(C,{text:"목록",variant:"tonal",onClick:J})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ye,{modelValue:P.value,"onUpdate:modelValue":t[22]||(t[22]=l=>P.value=l),"max-width":"800px",height:"900px",persistent:""},{default:o(()=>[e(Ie,{onSelected:de,onCloseDialog:t[21]||(t[21]=l=>P.value=!1)})]),_:1},8,["modelValue"])],64)}}};export{Ae as default};
