import{_ as te,u as le,a as ne,x as ae,p as oe,r as h,k as ie,z as N,m as se,A as de,c as ue,f as r,g as t,d,w as n,F as re,e as me,o as k,j as ce,i as pe,h as ve,t as V,B as w,C as b,b as fe,y as _e}from"./index-DbwVXjcr.js";import{A as U}from"./apiLab-DS60JKzK.js";import{i as ge,d as ye,e as D}from"./common-BCog4hmn.js";import{_ as xe}from"./UserListPop-C1yrHg2z.js";import{a as he,_ as we}from"./ClientListPop-DSUYNVnf.js";import"./format-CBpsKyOP.js";import"./apiItem-BapmxV41.js";import"./apiBase--1t-TlkM.js";const be=["id"],Ne=["onUpdate:modelValue"],Ve=["onUpdate:modelValue","onBlur"],Ie=["onUpdate:modelValue"],Ce=["onUpdate:modelValue"],Pe={class:"summary-row"},ke={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Ue={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},De={style:{width:"100px",height:"30px","text-align":"right","font-weight":"bold"}},$e={__name:"RecipeDetail",setup(Le){const{vError:$,vSuccess:L,vInfo:Be,vWarning:B}=le(),{userId:S}=ne(),R=me(),A=oe(),g=ae(null),I=A.params.id,o=h([]),C=h([]),y=h(!1),x=h(""),i=ie({clientName:"",clientId:"",prodName:"",managerName:"",managerId:"",regDate:"",labNo:"",prodType:"",userId:S}),T=[{title:"Phase ",key:"phase",align:"center",width:"50px"},{title:"품목코드",key:"itemCd",align:"center",width:"150px"},{title:"품목명",key:"itemName",align:"start",width:"480px"},{title:"함량",key:"content",align:"center",width:"140px"},{title:"원가(원)",key:"costPrice",align:"center",width:"140px"},{title:"단가(원/g)",key:"unitPrice",align:"center",width:"140px"},{title:"-",key:"actions",align:"center",width:"10px"}],P=N(()=>o.value.reduce((l,e)=>l+Number(e.content||0),0)),E=N(()=>o.value.reduce((l,e)=>l+Number(e.inPrice||0),0)),M=N(()=>o.value.reduce((l,e)=>l+Number(e.unitPrice||0),0)),F=l=>{const e=Number(o.value[l].content),m=Number(o.value[l].inPrice);!isNaN(e)&&!isNaN(m)?o.value[l].unitPrice=e*m*.001*.01:o.value[l].unitPrice=0,P.value>100&&(B("함량이 100보다 큽니다. "),o.value[l].content=0)},f=l=>{x.value=l,l==="C"?g.value=he:l==="U"?g.value=xe:l==="I"&&(g.value=we),y.value=!0},z=async()=>{try{const l={recipeInfo:i,recipeList:o.value};l.recipeInfo.regDate=D(l.recipeInfo.regDate);const e=await U.saveRecipeInfo(l);i.recipeId=e.recipeId,L("저장되었습니다.")}catch(l){$(l)}},O=l=>{x.value==="C"?(i.clientName=l.clientName,i.clientId=l.clientId):x.value==="U"?(i.managerId=l.userId,i.managerName=l.memberNm):x.value==="I"&&G(l)},G=l=>{if(!Array.isArray(l))return;let e=o.value.length;const m=l.map((p,s)=>({id:e++,Phase:"",itemCd:p.itemCd,itemName:p.itemName,content:"",inPrice:l.inPrice,unitPrice:""}));o.value.length>0?o.value.push(...m):o.value=[...m]},J=l=>{const e=o.value.findIndex(m=>m.itemCd===l);o.value.splice(e,1)};se(async()=>{if(C.value=await de.getCodeList("prod_type"),ge(I))i.redDate=ye();else{const l=await U.getRecipeInfo(I);Object.assign(i,l.recipeInfo),o.value=l.recipeList}});const K=()=>{R.push({name:"RecipeList"})};return(l,e)=>{const m=d("v-breadcrumbs"),p=d("v-text-field"),s=d("v-col"),_=d("v-row"),W=d("v-date-input"),q=d("v-select"),H=d("v-card-subtitle"),v=d("v-btn"),Q=d("v-icon"),X=d("v-data-table-virtual"),Y=d("v-form"),Z=d("v-card-text"),j=d("v-card"),ee=d("v-dialog");return k(),ue(re,null,[r("div",{id:l.$attrs.id},null,8,be),t(m,{items:["MES","연구관리","처방상세"]}),t(j,null,{default:n(()=>[t(Z,null,{default:n(()=>[t(Y,{onSubmit:ce(z,["prevent"])},{default:n(()=>[t(_,null,{default:n(()=>[t(s,null,{default:n(()=>[t(p,{modelValue:i.clientName,"onUpdate:modelValue":e[0]||(e[0]=a=>i.clientName=a),label:"고객사",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[1]||(e[1]=a=>f("C"))},null,8,["modelValue"])]),_:1}),t(s,null,{default:n(()=>[t(p,{modelValue:i.prodName,"onUpdate:modelValue":e[2]||(e[2]=a=>i.prodName=a),label:"제품명",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:n(()=>[t(s,null,{default:n(()=>[t(p,{modelValue:i.managerName,"onUpdate:modelValue":e[3]||(e[3]=a=>i.managerName=a),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[4]||(e[4]=a=>f("U"))},null,8,["modelValue"])]),_:1}),t(s,null,{default:n(()=>[t(W,{modelValue:i.regDate,"onUpdate:modelValue":e[5]||(e[5]=a=>i.regDate=a),label:"등록일","display-format":pe(D),variant:"underlined",density:"compact"},null,8,["modelValue","display-format"])]),_:1}),t(s,null,{default:n(()=>[t(p,{modelValue:i.labNo,"onUpdate:modelValue":e[6]||(e[6]=a=>i.labNo=a),label:"Lab No",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(s,null,{default:n(()=>[t(q,{modelValue:i.prodType,"onUpdate:modelValue":e[7]||(e[7]=a=>i.prodType=a),label:"제품코드",items:C.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1})]),_:1}),t(_,{class:"mt-4"},{default:n(()=>[t(s,{class:"mt-3"},{default:n(()=>[t(H,null,{default:n(()=>e[14]||(e[14]=[ve(" - 품목코드 ")])),_:1})]),_:1}),t(s,{class:"d-flex justify-end"},{default:n(()=>[t(v,{color:"brown-lighten-4",class:"mt-3",text:"추가+",density:"compact",onClick:e[8]||(e[8]=a=>f("I"))})]),_:1})]),_:1}),t(_,null,{default:n(()=>[t(s,null,{default:n(()=>[t(X,{headers:T,items:o.value,style:{height:"500px"},class:"custom-table no-padding-table"},{"item.phase":n(({item:a,index:u})=>[w(r("input",{"onUpdate:modelValue":c=>o.value[u].phase=c,style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ne),[[b,o.value[u].phase]])]),"item.content":n(({item:a,index:u})=>[w(r("input",{"onUpdate:modelValue":c=>o.value[u].content=c,style:{"text-align":"right",width:"90%"},class:"custom-line",onBlur:c=>F(u)},null,40,Ve),[[b,o.value[u].content]])]),"item.inPrice":n(({item:a,index:u})=>[w(r("input",{"onUpdate:modelValue":c=>o.value[u].inPrice=c,style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line",readonly:""},null,8,Ie),[[b,o.value[u].inPrice]])]),"item.unitPrice":n(({item:a,index:u})=>[w(r("input",{"onUpdate:modelValue":c=>o.value[u].unitPrice=c,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},readonly:""},null,8,Ce),[[b,o.value[u].unitPrice]])]),"item.actions":n(({item:a})=>[t(Q,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:u=>J(a.ingredientCode)},null,8,["onClick"])]),"body.append":n(()=>[r("tr",Pe,[e[15]||(e[15]=r("td",{style:{width:"10px",height:"30px","text-align":"center"}},"합계 : ",-1)),e[16]||(e[16]=r("td",null,null,-1)),e[17]||(e[17]=r("td",{style:{width:"480px",height:"30px"}},null,-1)),r("td",ke,V(P.value.toLocaleString()),1),r("td",Ue,V(E.value.toLocaleString()),1),r("td",De,V(M.value.toLocaleString()),1),e[18]||(e[18]=r("td",null,null,-1))])]),_:1},8,["items"])]),_:1})]),_:1}),t(_,{class:"justify-end mb-3 mr-2",dense:""},{default:n(()=>[t(s,{cols:"auto"},{default:n(()=>[t(v,{text:"BOM연결",onClick:e[9]||(e[9]=a=>f("B"))})]),_:1}),t(s,{cols:"auto"},{default:n(()=>[t(v,{text:"저장",color:"brown-lighten-4",type:"submit"})]),_:1}),t(s,{cols:"auto"},{default:n(()=>[t(v,{text:"전성분(수출)",color:"#FFE0B2",onClick:e[10]||(e[10]=a=>f("J"))})]),_:1}),t(s,{cols:"auto"},{default:n(()=>[t(v,{text:"단가"})]),_:1}),t(s,{cols:"auto"},{default:n(()=>[t(v,{text:"중국위행허가",onClick:e[11]||(e[11]=a=>f("G"))})]),_:1}),t(s,{cols:"auto"},{default:n(()=>[t(v,{text:"목록",onClick:K})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(ee,{modelValue:y.value,"onUpdate:modelValue":e[13]||(e[13]=a=>y.value=a),width:"800px",height:"800px",persistent:""},{default:n(()=>[(k(),fe(_e(g.value),{id:l.id,onSelected:O,onCloseDialog:e[12]||(e[12]=a=>y.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"])],64)}}},Oe=te($e,[["__scopeId","data-v-01093848"]]);export{Oe as default};
