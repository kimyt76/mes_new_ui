import{_ as re,r as p,a as me,u as ce,x as pe,k as ve,z as S,q as J,m as ye,A as k,c as A,f as d,g as t,d as m,w as i,i as V,F as K,e as ge,o as D,j as fe,t as C,B as g,C as f,n as _e,H as he,b as we,y as xe}from"./index-mUQ3O7M_.js";import{A as Ve}from"./apiOrders-T4pvcm4d.js";import{_ as Ce}from"./MultiFileUpload-DAZv4-Lm.js";import{C as be}from"./CustomerListPop-DIS_0gMR.js";import{_ as Ne}from"./UserListPop-DHOypsRj.js";import{_ as Pe}from"./StorageListPop-D_g6CbiU.js";import{d as Ue,e as y,k as Q,i as Se}from"./common-BfWOXsz0.js";import{_ as ke}from"./ItemListMultiPop-B_n_zLNo.js";import"./filedownLoad-DR6i-kbY.js";import"./apiBase-ZN922kEJ.js";import"./format-CBpsKyOP.js";import"./apiItem--nl5Hzyk.js";const De=["id"],qe=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Le=["onUpdate:modelValue","onBlur"],$e=["onUpdate:modelValue","onBlur"],Ae=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],Re={class:"summary-row"},Fe={style:{width:"80px","text-align":"right","font-weight":"bold",height:"30px"}},Ee={style:{width:"110px","text-align":"right","font-weight":"bold",height:"30px"}},ze={style:{width:"80px","text-align":"right","font-weight":"bold",height:"30px"}},Oe={style:{width:"150px","text-align":"right","font-weight":"bold",height:"30px"}},He={__name:"ContractReg",setup(Je){let b=p(""),N=p("");const{userId:W}=me(),{vError:G,vSuccess:X}=ce(),B=ge(),P=pe(null),w=p(!1),U=p(!1);p(null);let q=p("");const I=p([]),o=p([]),M=p([]),R=p([]),n=ve({contractDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",paymentCondition:"",transactionType:"",expiryDate:"",tradingMethod:"",currencyType:"",dueDate:"",userId:W}),Y=[{title:"품목코드 ",key:"itemCd",align:"center",width:"100px"},{title:"품목명",key:"itemName",align:"center",width:"450px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"수량",key:"qty",align:"center",width:"80px"},{title:"단가",key:"unitPrice",align:"center",width:"80px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"적용",key:"etc",align:"center",width:"120px"},{title:"-",key:"actions",align:"center",width:10}],Z=S(()=>o.value.reduce((a,e)=>a+Number(e.qty||0),0)),F=S(()=>o.value.reduce((a,e)=>a+Number(e.supplyPrice||0),0)),E=S(()=>o.value.reduce((a,e)=>a+Number(e.vatPrice||0),0)),j=S(()=>F.value+E.value),ee=async()=>{const a=new FormData;try{const e={...n};e.contractDate=y(e.contractDate),e.dueDate=y(e.dueDate),e.expiryDate=y(e.expiryDate),a.append("contractInfo",JSON.stringify(e)),a.append("itemList",JSON.stringify(o.value)),I.value.forEach(c=>{c.file instanceof File&&a.append("attachFile",c.file)});const v=await Ve.saveContractInfo(a);X(v),B.push({name:"ContractList"})}catch(e){G(e.message)}},te=a=>{switch(q.value){case"C":n.customerName=a.customerName,n.customerCd=a.customerCd,n.managerName=a.memberCd,n.managerId=a.memberCd,n.tradingMethod=a.tradingMethod;break;case"U":n.managerName=a.memberNm,n.managerId=a.userId;break;case"S":n.descStorageName=a.storageName,n.descStorageCd=a.storageCd;break}q.value="",w.value=!1},ae=a=>{if(!Array.isArray(a))return;const e=o.value.length,v=a.map((c,x)=>({itemCd:c.itemCd,itemName:c.itemName,unit:c.unit,qty:c.qty,unitPrice:c.unitPrice,supplyPrice:c.supplyPrice,vatPrice:c.vatPrice,etc:c.etc,orderDist:e+x+1}));o.value.length>0?o.value.push(...v):o.value=[...v]};J(()=>n.contractDate,async(a,e)=>{Se(y(e))||e!==y(a)&&(n.seq=await k.getNextSeq("tb_contract_mst","contract_Date",y(a)))}),J(()=>n.transactionType,async a=>{n.transactionType==="VRN"?o.value.map(e=>{e.vatPrice=0}):o.value.map(e=>{e.vatPrice=Q(e.supplyPrice)})});const z=a=>{const e=Number(o.value[a].qty),v=Number(o.value[a].unitPrice);!isNaN(e)&&!isNaN(v)?o.value[a].supplyPrice=e*v:o.value[a].supplyPrice=0,isNaN(o.value[a].supplyPrice)?o.value[a].vatPrice=0:o.value[a].vatPrice=Q(o.value[a].supplyPrice)},T=a=>{switch(q.value=a,a){case"C":P.value=be,b.value="800px",N.value="800px";break;case"U":P.value=Ne,b.value="800px",N.value="800px";break;case"S":P.value=Pe,b.value="800px",N.value="850px";break}w.value=!0},le=a=>{o.value.splice(a,1)},ne=()=>{U.value=!0};ye(async()=>{R.value=await k.getCodeList("currency_type"),M.value=await k.getCodeList("vat_rate"),n.contractDate=Ue(),n.seq=await k.getNextSeq("tb_contract_mst","contract_date",n.contractDate)});const ie=()=>{B.push({name:"ContractList"})};return(a,e)=>{const v=m("v-breadcrumbs"),c=m("v-card-item"),x=m("v-date-input"),h=m("v-text-field"),r=m("v-col"),_=m("v-row"),O=m("v-select"),L=m("v-card-text"),$=m("v-btn"),oe=m("v-icon"),se=m("v-data-table-virtual"),de=m("v-form"),ue=m("v-card"),H=m("v-dialog");return D(),A(K,null,[d("div",{id:a.$attrs.id},null,8,De),t(v,{items:["MES","영업관리","주문신규"],class:"custom-breadcrumbs"}),t(ue,null,{default:i(()=>[t(c,{title:"주문서입력"}),t(de,{ref:"vform",onSubmit:fe(ee,["prevent"])},{default:i(()=>[t(L,null,{default:i(()=>[t(_,null,{default:i(()=>[t(r,{class:"d-flex ga-2 pa-1"},{default:i(()=>[t(x,{modelValue:n.contractDate,"onUpdate:modelValue":e[0]||(e[0]=l=>n.contractDate=l),label:"주문일자",density:"compact","display-format":V(y),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"]),t(h,{modelValue:n.seq,"onUpdate:modelValue":e[1]||(e[1]=l=>n.seq=l),density:"compact",style:{width:"40px","max-width":"60px","min-width":"0"},readonly:""},null,8,["modelValue"])]),_:1}),t(r),t(r,null,{default:i(()=>[t(x,{modelValue:n.expiryDate,"onUpdate:modelValue":e[2]||(e[2]=l=>n.expiryDate=l),label:"유효기간",density:"compact","display-format":V(y),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"])]),_:1}),t(r,null,{default:i(()=>[t(x,{modelValue:n.dueDate,"onUpdate:modelValue":e[3]||(e[3]=l=>n.dueDate=l),label:"납기일자",density:"compact","display-format":V(y),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(r,{cols:"6"},{default:i(()=>[t(h,{modelValue:n.customerName,"onUpdate:modelValue":e[4]||(e[4]=l=>n.customerName=l),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=l=>T("C"))},null,8,["modelValue"])]),_:1}),t(r,null,{default:i(()=>[t(h,{modelValue:n.managerName,"onUpdate:modelValue":e[6]||(e[6]=l=>n.managerName=l),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=l=>T("U"))},null,8,["modelValue"])]),_:1}),t(r,null,{default:i(()=>[t(h,{modelValue:n.descStorageName,"onUpdate:modelValue":e[8]||(e[8]=l=>n.descStorageName=l),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[9]||(e[9]=l=>T("S"))},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(r,null,{default:i(()=>[t(O,{modelValue:n.transactionType,"onUpdate:modelValue":e[10]||(e[10]=l=>n.transactionType=l),label:"거래유형",items:M.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(r,null,{default:i(()=>[t(O,{modelValue:n.currencyType,"onUpdate:modelValue":e[11]||(e[11]=l=>n.currencyType=l),label:"통화",items:R.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(r,null,{default:i(()=>[t(h,{modelValue:n.paymentCondition,"onUpdate:modelValue":e[12]||(e[12]=l=>n.paymentCondition=l),label:"결제조건",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(r,null,{default:i(()=>[t(h,{modelValue:n.tradingMethod,"onUpdate:modelValue":e[13]||(e[13]=l=>n.tradingMethod=l),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{dense:""},{default:i(()=>[t(r,{cols:"12"},{default:i(()=>[t(Ce,{modelValue:I.value,"onUpdate:modelValue":e[14]||(e[14]=l=>I.value=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(L,null,{default:i(()=>[t(_,null,{default:i(()=>[t(r,{class:"d-flex ga-4 justify-end"},{default:i(()=>[t($,{text:"추가 +",density:"compact",onClick:ne})]),_:1})]),_:1})]),_:1}),t(L,null,{default:i(()=>[t(_,null,{default:i(()=>[t(r,null,{default:i(()=>[t(se,{headers:Y,items:o.value,density:"compact","item-value":"id",class:"custom-table no-padding-table"},{headers:i(({columns:l})=>[d("tr",null,[(D(!0),A(K,null,_e(l,s=>(D(),A("th",{key:s.key,class:"custom-header",style:he({width:s.width+"px"})},C(s.title),5))),128))])]),"item.itemCd":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].itemCd=u,style:{"text-align":"center",width:"100%","min-width":"100%","max-width":"100%"},class:"custom-input",readonly:""},null,8,qe),[[f,o.value[s].itemCd]])]),"item.itemName":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].itemName=u,style:{"text-align":"left",width:"100%","min-width":"100%","max-width":"100%"},class:"custom-input"},null,8,Ie),[[f,o.value[s].itemName]])]),"item.unit":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].unit=u,style:{"text-align":"center",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Te),[[f,o.value[s].unit]])]),"item.qty":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].qty=u,style:{"text-align":"right",width:"90%"},class:"custom-line",onBlur:u=>z(s)},null,40,Le),[[f,o.value[s].qty]])]),"item.unitPrice":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].unitPrice=u,style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line",onBlur:u=>z(s)},null,40,$e),[[f,o.value[s].unitPrice]])]),"item.supplyPrice":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].supplyPrice=u,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Ae),[[f,o.value[s].supplyPrice]])]),"item.vatPrice":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].vatPrice=u,type:"number",style:{"text-align":"right",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Be),[[f,o.value[s].vatPrice,void 0,{number:!0}]])]),"item.etc":i(({item:l,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>o.value[s].etc=u,type:"text",style:{"text-align":"left",width:"90%","min-width":"90%","max-width":"90%"},class:"custom-line"},null,8,Me),[[f,o.value[s].etc]])]),"item.actions":i(({item:l})=>[t(oe,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>le(l)},null,8,["onClick"])]),"body.append":i(()=>[d("tr",Re,[e[19]||(e[19]=d("td",{style:{width:"100px",height:"30px","text-align":"center"}},"합계",-1)),e[20]||(e[20]=d("td",{style:{width:"300px",height:"30px"}},null,-1)),e[21]||(e[21]=d("td",{style:{width:"80px",height:"30px"}},null,-1)),d("td",Fe,C(Z.value.toLocaleString()),1),e[22]||(e[22]=d("td",{style:{width:"110px",height:"30px"}},null,-1)),d("td",Ee,C(F.value.toLocaleString()),1),d("td",ze,C(E.value.toLocaleString()),1),d("td",Oe,C(j.value.toLocaleString()),1),e[23]||(e[23]=d("td",null,null,-1))])]),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),t(_,{class:"mt-2 mb-2"},{default:i(()=>[t(r,{class:"d-flex ga-4 justify-end"},{default:i(()=>[t($,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),t($,{text:"목록",class:"mr-3",onClick:ie})]),_:1})]),_:1})]),_:1},512)]),_:1}),t(H,{modelValue:w.value,"onUpdate:modelValue":e[16]||(e[16]=l=>w.value=l),width:V(b),height:V(N),persistent:""},{default:i(()=>[(D(),we(xe(P.value),{id:a.id,onSelected:te,onCloseDialog:e[15]||(e[15]=l=>w.value=!1)},null,40,["id"]))]),_:1},8,["modelValue","width","height"]),t(H,{modelValue:U.value,"onUpdate:modelValue":e[18]||(e[18]=l=>U.value=l),width:"800",height:"800",persistent:""},{default:i(()=>[t(ke,{onSelected:ae,onCloseDialog:e[17]||(e[17]=l=>U.value=!1)})]),_:1},8,["modelValue"])],64)}}},nt=re(He,[["__scopeId","data-v-ecafaad8"]]);export{nt as default};
