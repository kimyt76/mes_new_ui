import{_ as re,a as me,u as pe,x as ce,r as f,k as ve,m as ye,B as U,p as fe,n as ge,c as S,f as d,g as l,d as m,w as i,F as O,e as he,o as k,j as _e,i as I,t as C,D as g,G as h,v as we,E as xe,b as Ve,y as be}from"./index-C0I8_ih4.js";import{A as E}from"./apiOrders-CDUwT9YC.js";import{C as Ce}from"./CustomerListPop-CTpE7H_0.js";import{_ as Ne}from"./UserListPop-bxXyYKR_.js";import{_ as Pe}from"./StorageListPop-BarfFNca.js";import{_ as Ue}from"./MultiFileUpload-rWPluJuQ.js";import{_ as ke}from"./ItemListSinglePop-i5QDZd33.js";import{A as J}from"./apiCommon-kSGeiy8j.js";import{h as V,j as W}from"./common-Dg66kV3l.js";import{_ as De}from"./ItemListMultiPop-DEp0Qf0u.js";import"./apiBase-DDRiAjNL.js";import"./filedownLoad-DIvRxwUu.js";import"./apiItem-Bm6wmdM3.js";import"./format-CBpsKyOP.js";const Se=["id"],Ie={class:"d-flex ga-4 justify-end"},qe=["onUpdate:modelValue","onDblclick"],$e=["onUpdate:modelValue"],Fe=["onUpdate:modelValue"],Le=["onUpdate:modelValue","onBlur"],Te=["onUpdate:modelValue","onBlur"],Be=["onUpdate:modelValue"],Ae=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],Re={class:"summary-row"},Oe={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Ee={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Je={style:{width:"100px",height:"30px","text-align":"right","font-weight":"bold"}},We={style:{width:"150px",height:"30px","text-align":"right","font-weight":"bold"}},ze={class:"d-flex ga-4 justify-end"},Ge={__name:"ContractDetail",setup(Qe){const{userId:z}=me(),{vError:G,vSuccess:Q,vWarning:He}=pe(),H=he(),b=ce(null),y=f(!1);f(!1);const K=ve().params.id,X=f(null);let N=f("");const w=f([]),n=f([]),q=f([]),$=f([]),o=ye({contractDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",transactionType:"",paymentCondition:"",expiryDate:"",tradingMethod:"",currencyType:"",dueDate:"",contractId:"",attachFileId:"",userId:z}),Y=f([{title:"품목코드 ",key:"itemCd",align:"center",width:"100px"},{title:"품목명",key:"itemName",align:"center",width:"450px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"수량",key:"qty",align:"center",width:"80px"},{title:"단가",key:"unitPrice",align:"center",width:"80px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"적용",key:"etc",align:"center",width:"120px"},{title:"-",key:"actions",align:"center",width:10}]),Z=U(()=>n.value.reduce((t,e)=>t+Number(e.qty||0),0)),F=U(()=>n.value.reduce((t,e)=>t+Number(e.supplyPrice||0),0)),L=U(()=>n.value.reduce((t,e)=>t+Number(e.vatPrice||0),0)),j=U(()=>F.value+L.value),T=t=>{let e=Number(n.value[t].qty),p=Number(n.value[t].unitPrice);!isNaN(e)&&!isNaN(p)?n.value[t].supplyPrice=e*p:n.value[t].supplyPrice=0,isNaN(n.value[t].supplyPrice)?n.value[t].vatPrice=0:n.value[t].vatPrice=W(n.value[t].supplyPrice)};fe(()=>o.transactionType,async t=>{o.transactionType==="VRN"?n.value.map(e=>{e.vatPrice=0}):n.value.map(e=>{e.vatPrice=W(e.supplyPrice)})});const ee=()=>{y.value=!0},te=t=>{if(!Array.isArray(t))return;const e=n.value.length,p=t.map((v,c)=>({itemCd:v.itemCd,itemName:v.itemName,unit:v.unit,qty:v.qty,unitPrice:v.unitPrice,supplyPrice:v.supplyPrice,vatPrice:v.vatPrice,etc:v.etc,orderDist:e+c+1}));n.value.length>0?n.value.push(...p):n.value=[...p]},le=t=>{switch(N.value){case"C":o.customerName=t.customerName,o.customerCd=t.customerCd,o.managerName=t.memberCd,o.managerId=t.memberCd,o.tradingMethod=t.tradingMethod;break;case"U":o.managerName=t.memberNm,o.managerId=t.userId;break;case"S":o.descStorageName=t.storageName,o.descStorageCd=t.storageCd;break}N.value="",y.value=!1},ae=async()=>{const t=new FormData;try{const e={...o};e.contractDate=V(e.contractDate),e.dueDate=V(e.dueDate),e.expiryDate=V(e.expiryDate),t.append("contractInfo",JSON.stringify(e)),t.append("itemList",JSON.stringify(n.value));const p=[];w.value.forEach(c=>{c.flag==="N"?t.append("newFiles",c.file):c.flag==="D"&&p.push({attachFileId:c.attachFileId,seq:c.seq})}),t.append("keptFiles",JSON.stringify(w.value.filter(c=>c.flag==="S"))),p.length>0&&t.append("deleteFiles",new Blob([JSON.stringify(p)],{type:"application/json"}));const v=await E.updateContractInfo(t);Q(v),B()}catch(e){G(e.message)}},ne=t=>{const e=n.value.findIndex(p=>p.id===t.id);e>-1&&n.value.splice(e,1)},B=async()=>{$.value=await J.getCodeList("currency_type"),q.value=await J.getCodeList("vat_rate");const t=await E.getContractInfo(K);Object.assign(o,t.contractInfo),n.value=t.itemList,t.attachFileInfo!==null?w.value=t.attachFileInfo:w.value=[],n.value.length};ge(async()=>{B()});const P=t=>{switch(N.value=t,t){case"C":b.value=Ce;break;case"U":b.value=Ne;break;case"S":b.value=Pe;break;default:N.value="I",X.value=t,b.value=ke;break}y.value=!0},ie=()=>{H.push({name:"ContractList"})};return(t,e)=>{const p=m("v-breadcrumbs"),v=m("v-card-item"),c=m("v-date-input"),x=m("v-text-field"),r=m("v-col"),_=m("v-row"),A=m("v-select"),M=m("v-card-text"),D=m("v-btn"),oe=m("v-icon"),se=m("v-data-table-virtual"),de=m("v-form"),ue=m("v-card"),R=m("v-dialog");return k(),S(O,null,[d("div",{id:t.$attrs.id},null,8,Se),l(p,{items:["MES","영업관리","주문상세"]}),l(ue,null,{default:i(()=>[l(v,{title:"주문서상세"}),l(de,{ref:"vform",onSubmit:_e(ae,["prevent"])},{default:i(()=>[l(M,null,{default:i(()=>[l(_,null,{default:i(()=>[l(r,{class:"d-flex flex-row align-center",style:{gap:"4px"}},{default:i(()=>[l(c,{modelValue:o.contractDate,"onUpdate:modelValue":e[0]||(e[0]=a=>o.contractDate=a),label:"주문일자",density:"compact","display-format":I(V),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"]),l(x,{modelValue:o.seq,"onUpdate:modelValue":e[1]||(e[1]=a=>o.seq=a),density:"compact",style:{width:"40px","max-width":"60px","min-width":"0"},class:"mr-10 mb-2",readonly:""},null,8,["modelValue"])]),_:1}),l(r),l(r,null,{default:i(()=>[l(c,{modelValue:o.expiryDate,"onUpdate:modelValue":e[2]||(e[2]=a=>o.expiryDate=a),title:"유효기간","display-format":I(V),variant:"underlined",style:{width:"200px"}},null,8,["modelValue","display-format"])]),_:1}),l(r,null,{default:i(()=>[l(c,{modelValue:o.dueDate,"onUpdate:modelValue":e[3]||(e[3]=a=>o.dueDate=a),title:"납기일자","display-format":I(V),variant:"underlined",density:"compact",style:{width:"200px"}},null,8,["modelValue","display-format"])]),_:1})]),_:1}),l(_,{density:""},{default:i(()=>[l(r,{cols:"6"},{default:i(()=>[l(x,{modelValue:o.customerName,"onUpdate:modelValue":e[4]||(e[4]=a=>o.customerName=a),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=a=>P("C"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:i(()=>[l(x,{modelValue:o.managerName,"onUpdate:modelValue":e[6]||(e[6]=a=>o.managerName=a),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=a=>P("U"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:i(()=>[l(x,{modelValue:o.descStorageName,"onUpdate:modelValue":e[8]||(e[8]=a=>o.descStorageName=a),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[9]||(e[9]=a=>P("S"))},null,8,["modelValue"])]),_:1})]),_:1}),l(_,{density:""},{default:i(()=>[l(r,null,{default:i(()=>[l(A,{modelValue:o.transactionType,"onUpdate:modelValue":e[10]||(e[10]=a=>o.transactionType=a),label:"거래유형",items:q.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:i(()=>[l(A,{modelValue:o.currencyType,"onUpdate:modelValue":e[11]||(e[11]=a=>o.currencyType=a),label:"통화",items:$.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:i(()=>[l(x,{modelValue:o.paymentCondition,"onUpdate:modelValue":e[12]||(e[12]=a=>o.paymentCondition=a),label:"결재조건",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),l(r,null,{default:i(()=>[l(x,{modelValue:o.tradingMethod,"onUpdate:modelValue":e[13]||(e[13]=a=>o.tradingMethod=a),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),l(_,null,{default:i(()=>[l(r,{cols:"12"},{default:i(()=>[l(Ue,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=a=>w.value=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(M,null,{default:i(()=>[l(_,{density:""},{default:i(()=>[l(r,null,{default:i(()=>[d("div",Ie,[l(D,{text:"추가 +",density:"compact",onClick:ee})])]),_:1})]),_:1}),l(_,null,{default:i(()=>[l(r,{cols:"12"},{default:i(()=>[l(se,{headers:Y.value,items:n.value,"item-value":"id"},{headers:i(({columns:a})=>[d("tr",null,[(k(!0),S(O,null,we(a,s=>(k(),S("th",{key:s.key,class:"custom-header",style:xe([{height:"30px"},{width:s.width+"px",minWidth:s.width+"px",maxWidth:s.width+"px"}])},C(s.title),5))),128))])]),"item.itemCd":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].itemCd=u,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",onDblclick:u=>P(s)},null,40,qe),[[h,n.value[s].itemCd]])]),"item.itemName":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].itemName=u,style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",readonly:""},null,8,$e),[[h,n.value[s].itemName]])]),"item.unit":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].unit=u,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Fe),[[h,n.value[s].unit]])]),"item.qty":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].qty=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line",onBlur:u=>T(s)},null,40,Le),[[h,n.value[s].qty]])]),"item.unitPrice":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].unitPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line",onBlur:u=>T(s)},null,40,Te),[[h,n.value[s].unitPrice]])]),"item.supplyPrice":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].supplyPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Be),[[h,n.value[s].supplyPrice]])]),"item.vatPrice":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].vatPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Ae),[[h,n.value[s].vatPrice,void 0,{number:!0}]])]),"item.etc":i(({item:a,index:s})=>[g(d("input",{"onUpdate:modelValue":u=>n.value[s].etc=u,type:"text",style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Me),[[h,n.value[s].etc]])]),"item.actions":i(({item:a})=>[l(oe,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:s=>ne(a)},null,8,["onClick"])]),"body.append":i(()=>[d("tr",Re,[e[19]||(e[19]=d("td",{style:{width:"100px",height:"30px","text-align":"center"}},"합계",-1)),e[20]||(e[20]=d("td",{style:{width:"250px",height:"30px"}},null,-1)),e[21]||(e[21]=d("td",{style:{width:"80px",height:"30px"}},null,-1)),d("td",Oe,C(Z.value.toLocaleString()),1),e[22]||(e[22]=d("td",{style:{width:"110px"}},null,-1)),d("td",Ee,C(F.value.toLocaleString()),1),d("td",Je,C(L.value.toLocaleString()),1),d("td",We,C(j.value.toLocaleString()),1),e[23]||(e[23]=d("td",{style:{height:"30px"}},null,-1))])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),l(_,{class:"mt-2 mb-2"},{default:i(()=>[l(r,null,{default:i(()=>[d("div",ze,[l(D,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),l(D,{text:"목록",class:"mr-3",onClick:ie})])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(R,{modelValue:y.value,"onUpdate:modelValue":e[16]||(e[16]=a=>y.value=a),width:"800px",height:"800px",persistent:""},{default:i(()=>[(k(),Ve(be(b.value),{id:t.id,onSelected:le,onCloseDialog:e[15]||(e[15]=a=>y.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"]),l(R,{modelValue:y.value,"onUpdate:modelValue":e[18]||(e[18]=a=>y.value=a),width:"800",height:"800",persistent:""},{default:i(()=>[l(De,{onSelected:te,onCloseDialog:e[17]||(e[17]=a=>y.value=!1)})]),_:1},8,["modelValue"])],64)}}},rt=re(Ge,[["__scopeId","data-v-4361842d"]]);export{rt as default};
