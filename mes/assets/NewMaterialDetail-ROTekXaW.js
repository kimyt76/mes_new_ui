import{u as q,r as w,k as G,d as a,b as J,o as Y,w as n,g as e,h as H,f as S,j as oe,_ as ie,a as se,p as re,y as de,m as ue,c as me,F as ce,e as pe,i as T,C as j,D as O,z as ve,H as fe}from"./index-DjI8e8VZ.js";import{A as I}from"./apiLab-C2sC-jhp.js";import{i as W,p as _e,f as we}from"./common-DeQ1G7iv.js";import{_ as ge}from"./IngredientListPop-BGzxsbrM.js";import{C as Ce}from"./CustomerListPop-JvGKSwu5.js";import{_ as ye}from"./ItemListSinglePop-C88KYWuD.js";import"./format-DWu4U6B8.js";import"./apiBase-CRBLZO_5.js";import"./apiItem-slwuKuQH.js";const xe={style:{"overflow-y":"auto",height:"calc(100% - 40px)"}},Ne={__name:"NewMaterialListPop",emits:["selected","close-dialog"],setup(K,{emit:g}){const{vWarning:C}=q(),f=g,b=w(""),M=w([]),L=w([]),u=G({newMaterialCd:"",materialName:"",managerName:""}),$=[{title:"신원료코드",key:"newMaterialCd",width:100},{title:"신원료명",key:"materialName",width:200},{title:"품목코드",key:"itemCd",width:120},{title:"담당자",key:"regName",width:100}],U=async()=>{try{const _={...u};M.value=await I.getNewMaterialList(_)}catch(_){vError(_)}finally{}},D=async(_,s)=>{L.value=await I.getNewMaterialListMapping(s.item.newMaterialCd),f("selected",L.value)};return(_,s)=>{const A=a("v-toolbar-title"),k=a("v-spacer"),P=a("v-icon"),m=a("v-btn"),y=a("v-toolbar"),r=a("v-text-field"),i=a("v-col"),R=a("v-form"),E=a("v-row"),x=a("v-data-table"),B=a("v-card-text"),F=a("v-card-actions"),z=a("v-card");return Y(),J(z,null,{default:n(()=>[e(y,{height:"40",class:"d-flex align-center justify-space-between px-2 toolbar-Head"},{default:n(()=>[e(A,null,{default:n(()=>s[6]||(s[6]=[H("신원료 성분조회")])),_:1}),e(k),e(m,{icon:"",onClick:s[0]||(s[0]=c=>f("close-dialog"))},{default:n(()=>[e(P,null,{default:n(()=>s[7]||(s[7]=[H("mdi-close")])),_:1})]),_:1})]),_:1}),e(k),e(B,null,{default:n(()=>[e(E,null,{default:n(()=>[e(R,{ref_key:"srhForm",ref:b,onSubmit:oe(U,["prevent"])},{default:n(()=>[e(i,{class:"d-flex flex-row ga-3"},{default:n(()=>[e(r,{modelValue:u.newMaterialCd,"onUpdate:modelValue":s[1]||(s[1]=c=>u.newMaterialCd=c),label:"신원료코드",placeholder:"신원료코드를 입력해주세요",density:"compact",style:{width:"150px"}},null,8,["modelValue"]),e(r,{modelValue:u.materialName,"onUpdate:modelValue":s[2]||(s[2]=c=>u.materialName=c),label:"신원료명",placeholder:"신원료명을 입력해주세요",density:"compact",style:{width:"180px"}},null,8,["modelValue"]),e(r,{modelValue:u.regName,"onUpdate:modelValue":s[3]||(s[3]=c=>u.regName=c),label:"등록자명",placeholder:"등록자명을 입력해주세요",density:"compact",style:{width:"180px"}},null,8,["modelValue"]),e(m,{text:"조회",color:"brown-lighten-4",type:"submit"}),e(m,{text:"초기화",onClick:s[4]||(s[4]=c=>b.value.reset())})]),_:1})]),_:1},512)]),_:1}),S("div",xe,[e(x,{headers:$,items:M.value,"item-value":"newMaterialCd",density:"compact","fixed-header":"",height:"520px",class:"custom-table","return-object":"","onClick:row":D},null,8,["items"])])]),_:1}),e(F,null,{default:n(()=>[e(m,{text:"닫기",variant:"tonal",class:"mb-4 mr-3",onClick:s[5]||(s[5]=c=>f("close-dialog"))})]),_:1})]),_:1})}}},be=["id"],Me=["onUpdate:modelValue"],ke=["onUpdate:modelValue"],Ve={__name:"NewMaterialDetail",setup(K){const g=w(!1),C=w({x:300,y:200}),f=w(!1);let b=0,M=0;function L(l){f.value=!0,b=l.clientX-C.value.x,M=l.clientY-C.value.y,window.addEventListener("mousemove",u),window.addEventListener("mouseup",$)}function u(l){f.value&&(C.value.x=l.clientX-b,C.value.y=l.clientY-M)}function $(){f.value=!1,window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",$)}const{userId:U}=se(),{vError:D,vSuccess:_,vInfo:s}=q(),A=re(),k=pe(),P=A.params.id,m=w(""),y=de(null),r=w([]),i=G({newMaterialCd:"",itemCd:"",itemName:"",materialName:"",inPrice:"",customerCd:"",customerName:"",mtrName:"",userId:U}),R=[{title:"성분코드",key:"ingredientCode",align:"center",width:"90px"},{title:"국문성분명",key:"krIngredientName",align:"start",width:"230px"},{title:"영어성분명",key:"enIngredientName",align:"start",width:"230px"},{title:"국내함량",key:"inContent",align:"center",width:"100px"},{title:"수출용함량",key:"outContent",align:"center",width:"100px"},{title:"CAS No",key:"casNo",align:"center",width:"90px"},{title:"function",key:"functionNm",align:"center",width:"90px"},{title:"한도 국가",key:"limitCountry",align:"center",width:"90px"},{title:"금지 국가",key:"banCountry",align:"center",width:"90px"},{title:"-",key:"actions",align:"center",width:"10px"}],E=async l=>{i.userId=U;try{const t={newMaterialInfo:i,materialMappingList:r.value};if(l==="N"){if(W(i.itemCd)){s("이관할 품목코드를 선택해주세요.");return}const v=await I.saveNewMaterialMapping(t);_("이관 되었습니다."),k.push({name:"NewMaterialList"})}else{const v=await I.saveNewMaterialInfo(t);i.newMaterialCd=v.data.newMaterialCd,_("저장되었습니다.")}}catch(t){D(t.message)}},x=l=>{m.value=l,l==="I"?y.value=ge:l==="C"?y.value=Ce:l==="P"?y.value=ye:l==="N"&&(y.value=Ne),g.value=!0},B=l=>{m.value==="C"?(i.customerCd=l.customerCd,i.customerName=l.customerName):m.value==="P"?(i.itemCd=l.itemCd,i.itemName=l.itemName):(m.value==="I"||m.value==="N")&&F(l),g.value=!1},F=l=>{if(!Array.isArray(l))return;let t=r.value.length;const v=l.map((d,p)=>({id:t++,ingredientCode:d.ingredientCode,krIngredientName:d.krIngredientName,enIngredientName:d.enIngredientName,inContent:d.inContent,outContent:d.outContent,casNo:d.casNo,functionNm:d.functionNm,limitCountry:d.limitCountry,banCountry:d.banCountry}));r.value.length>0?r.value.push(...v):r.value=[...v]},z=l=>{const t=r.value.findIndex(v=>v.ingredientCode===l);r.value.splice(t,1)};ue(async()=>{if(!W(P)){const l=await I.getNewMaterialInfo(P);Object.assign(i,l.newMaterialInfo),r.value=l.materialMappingList}});const c=()=>{k.push({name:"NewMaterialList"})};return(l,t)=>{const v=a("v-breadcrumbs"),d=a("v-text-field"),p=a("v-col"),V=a("v-row"),Q=a("v-card-subtitle"),h=a("v-btn"),Z=a("v-icon"),ee=a("v-data-table-virtual"),te=a("v-form"),ne=a("v-card-text"),le=a("v-card"),ae=a("v-dialog");return Y(),me(ce,null,[S("div",{id:l.$attrs.id},null,8,be),e(v,{items:["MES","연구관리","신 원료상세"]}),e(le,null,{default:n(()=>[e(ne,null,{default:n(()=>[e(te,null,{default:n(()=>[e(V,null,{default:n(()=>[e(p,null,{default:n(()=>[e(d,{modelValue:i.newMaterialCd,"onUpdate:modelValue":t[0]||(t[0]=o=>i.newMaterialCd=o),label:"임시코드",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(p,null,{default:n(()=>[e(d,{modelValue:i.materialName,"onUpdate:modelValue":t[1]||(t[1]=o=>i.materialName=o),label:"원료명",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(p,null,{default:n(()=>[e(d,{"model-value":T(we)(i.inPrice),label:"입고단가",variant:"underlined",density:"compact","onUpdate:modelValue":t[2]||(t[2]=o=>i.inPrice=T(_e)(o))},null,8,["model-value"])]),_:1})]),_:1}),e(V,null,{default:n(()=>[e(p,null,{default:n(()=>[e(d,{modelValue:i.mtrName,"onUpdate:modelValue":t[3]||(t[3]=o=>i.mtrName=o),label:"제조원",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),e(p,null,{default:n(()=>[e(d,{modelValue:i.customerName,"onUpdate:modelValue":t[4]||(t[4]=o=>i.customerName=o),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":t[5]||(t[5]=o=>x("C"))},null,8,["modelValue"])]),_:1}),e(p,null,{default:n(()=>[e(d,{modelValue:i.itemCd,"onUpdate:modelValue":t[6]||(t[6]=o=>i.itemCd=o),label:"품목코드",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify",readonly:"","onClick:appendInner":t[7]||(t[7]=o=>x("P"))},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{class:"mt-4"},{default:n(()=>[e(p,{class:"mt-3"},{default:n(()=>[e(Q,null,{default:n(()=>t[14]||(t[14]=[H(" - 성분코드 ")])),_:1})]),_:1}),e(p,{class:"d-flex justify-end",style:{gap:"8px"}},{default:n(()=>[e(h,{color:"brown-lighten-4",class:"mt-3",text:"추가+",density:"compact",onClick:t[8]||(t[8]=o=>x("I"))}),e(h,{color:"brown-lighten-4",class:"mt-3",text:"신원료",density:"compact",onClick:t[9]||(t[9]=o=>x("N"))})]),_:1})]),_:1}),e(V,null,{default:n(()=>[e(ee,{headers:R,items:r.value,class:"custom-table"},{"item.inContent":n(({item:o,index:N})=>[j(S("input",{"onUpdate:modelValue":X=>r.value[N].inContent=X,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,Me),[[O,r.value[N].inContent]])]),"item.outContent":n(({item:o,index:N})=>[j(S("input",{"onUpdate:modelValue":X=>r.value[N].outContent=X,style:{"text-align":"right",width:"90%",height:"30px"},class:"custom-line"},null,8,ke),[[O,r.value[N].outContent]])]),"item.actions":n(({item:o})=>[e(Z,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:N=>z(o.ingredientCode)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),e(V,null,{default:n(()=>[e(p,{class:"d-flex justify-end mt-3 ga-3"},{default:n(()=>[e(h,{text:"원료이관",color:"brown-lighten-4",onClick:t[10]||(t[10]=o=>E("N"))}),e(h,{text:"저장",color:"brown-lighten-4",onClick:t[11]||(t[11]=o=>E("S"))}),e(h,{text:"목록",onClick:c})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{modelValue:g.value,"onUpdate:modelValue":t[13]||(t[13]=o=>g.value=o),width:"800px",height:"800px",persistent:"",location:"center"},{default:n(()=>[(Y(),J(ve(y.value),{id:l.id,style:fe({position:"absolute",top:`${C.value.y}px`,left:`${C.value.x}px`,cursor:f.value?"grabbing":"grab"}),onMousedown:L,onSelected:B,onCloseDialog:t[12]||(t[12]=o=>g.value=!1)},null,40,["id","style"]))]),_:1},8,["modelValue"])],64)}}},Ae=ie(Ve,[["__scopeId","data-v-f4ce8cd0"]]);export{Ae as default};
