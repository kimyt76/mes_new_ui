import{_ as se,a as ue,u as de,v as re,r as f,k as me,m as pe,C as N,n as ce,c as S,f as u,g as t,d as v,w as i,F as R,e as ve,o as k,j as ye,t as V,E as g,G as h,x as fe,y as ge,b as he,z as _e}from"./index-BNL3Tgw5.js";import{A as O}from"./apiOrders-Whxuw2Cj.js";import{_ as I}from"./DateSinglePicker-8DAkXH4C.js";import{_ as xe}from"./CustomerListPop-C12lnYGL.js";import{_ as we}from"./UserListPop-DEkQwN6k.js";import{_ as Ve}from"./StorageListPop-DItQtyxf.js";import{_ as be}from"./MultiFileUpload--c0CfwPP.js";import{I as Ce}from"./ItemListSinglePop-B9yN6Coo.js";import{A as E}from"./apiCommon-LY9rUrf-.js";import{h as Ne}from"./common-BOBTT4pT.js";import{_ as ke}from"./ItemListMultiPop-CrGDLePS.js";import"./format-CBpsKyOP.js";import"./apiBase-CSC4uJMW.js";import"./filedownLoad-DSISiZ_u.js";import"./apiItem-CL-1bRvd.js";const Pe=["id"],Ue={class:"d-flex ga-4 justify-end"},Se=["onUpdate:modelValue","onDblclick"],Ie=["onUpdate:modelValue"],De=["onUpdate:modelValue"],$e=["onUpdate:modelValue","onBlur"],qe=["onUpdate:modelValue","onBlur"],Fe=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],Ae={class:"summary-row"},Be={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Me={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Re={style:{width:"100px",height:"30px","text-align":"right","font-weight":"bold"}},Oe={style:{width:"150px",height:"30px","text-align":"right","font-weight":"bold"}},Ee={class:"d-flex ga-4 justify-end"},je={__name:"ContractDetail",setup(Je){const{userId:j}=ue(),{vError:J,vSuccess:z,vWarning:ze}=de(),W=ve(),w=re(null),y=f(!1);f(!1);const G=me().params.id,P=f(null);let b=f("");const x=f([]),n=f([]),D=f([]),$=f([]),s=pe({contractDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",transactionType:"",paymentCondition:"",expiryDate:"",tradingMethod:"",currencyType:"",dueDate:"",contractId:"",attachFileId:"",userId:j}),Q=f([{title:"품목코드 ",key:"itemCd",align:"center",width:"100px"},{title:"품목명",key:"itemName",align:"start",width:"250px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"수량",key:"qty",align:"center",width:"110px"},{title:"단가",key:"unitPrice",align:"center",width:"110px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"적용",key:"etc",align:"center",width:"150px"},{title:"-",key:"actions",align:"center",width:"10px"}]),H=N(()=>n.value.reduce((a,e)=>a+Number(e.qty||0),0)),q=N(()=>n.value.reduce((a,e)=>a+Number(e.supplyPrice||0),0)),F=N(()=>n.value.reduce((a,e)=>a+Number(e.vatPrice||0),0)),K=N(()=>q.value+F.value),L=a=>{let e=Number(n.value[a].qty),r=Number(n.value[a].unitPrice);!isNaN(e)&&!isNaN(r)?n.value[a].supplyPrice=e*r:n.value[a].supplyPrice=0,isNaN(n.value[a].supplyPrice)?n.value[a].vatPrice=0:n.value[a].vatPrice=Ne(n.value[a].supplyPrice)},X=()=>{y.value=!0},Y=a=>{if(!Array.isArray(a))return;const e=n.value.length,r=a.map((c,m)=>({itemCd:c.itemCd,itemName:c.itemName,unit:c.unit,qty:c.qty,unitPrice:c.unitPrice,supplyPrice:c.supplyPrice,vatPrice:c.vatPrice,etc:c.etc,orderDist:e+m+1}));console.log("selectItem",r),n.value.length>0?n.value.push(...r):n.value=[...r]},Z=(a,e)=>{switch(b.value){case"C":s.customerName=e,s.customerCd=a;break;case"U":s.managerName=e,s.managerId=a;break;case"S":s.descStorageName=e,s.descStorageCd=a;break;case"I":if(P.value!==null){const r=n.value[P.value];r.itemCd=a,r.itemName=e}break}b.value="",y.value=!1},ee=async()=>{const a=new FormData;try{const e={...s};a.append("contractInfo",JSON.stringify(e)),a.append("itemList",JSON.stringify(n.value));const r=[];x.value.forEach(m=>{m.flag==="N"?a.append("newFiles",m.file):m.flag==="D"&&r.push({attachFileId:m.attachFileId,seq:m.seq})}),a.append("keptFiles",JSON.stringify(x.value.filter(m=>m.flag==="S"))),r.length>0&&a.append("deleteFiles",new Blob([JSON.stringify(r)],{type:"application/json"}));const c=await O.updateContractInfo(a);z(c),T()}catch(e){J(e.message)}},te=a=>{const e=n.value.findIndex(r=>r.id===a.id);e>-1&&n.value.splice(e,1)},T=async()=>{$.value=await E.getCodeList("currency_type"),D.value=await E.getCodeList("vat_rate");const a=await O.getContractInfo(G);Object.assign(s,a.contractInfo),n.value=a.itemList,a.attachFileInfo!==null?x.value=a.attachFileInfo:x.value=[],n.value.length};ce(async()=>{T()});const C=a=>{switch(b.value=a,a){case"C":w.value=xe;break;case"U":w.value=we;break;case"S":w.value=Ve;break;default:b.value="I",P.value=a,w.value=Ce;break}y.value=!0},le=()=>{W.push({name:"ContractList"})};return(a,e)=>{const r=v("v-breadcrumbs"),c=v("v-card-item"),m=v("v-text-field"),p=v("v-col"),_=v("v-row"),A=v("v-select"),B=v("v-card-text"),U=v("v-btn"),ae=v("v-icon"),ne=v("v-data-table-virtual"),ie=v("v-form"),oe=v("v-card"),M=v("v-dialog");return k(),S(R,null,[u("div",{id:a.$attrs.id},null,8,Pe),t(r,{items:["MES","수주관리","주문상세"]}),t(oe,null,{default:i(()=>[t(c,{title:"주문서상세"}),t(ie,{ref:"vform",onSubmit:ye(ee,["prevent"])},{default:i(()=>[t(B,null,{default:i(()=>[t(_,null,{default:i(()=>[t(p,{class:"d-flex flex-row align-center",style:{gap:"4px"}},{default:i(()=>[t(I,{modelValue:s.contractDate,"onUpdate:modelValue":e[0]||(e[0]=l=>s.contractDate=l),title:"주문일자",density:"compact",width:"120",style:{width:"100px"},readonly:""},null,8,["modelValue"]),t(m,{modelValue:s.seq,"onUpdate:modelValue":e[1]||(e[1]=l=>s.seq=l),density:"compact",style:{width:"40px","max-width":"60px","min-width":"0"},class:"mr-10",readonly:""},null,8,["modelValue"])]),_:1}),t(p),t(p,null,{default:i(()=>[t(I,{modelValue:s.expiryDate,"onUpdate:modelValue":e[2]||(e[2]=l=>s.expiryDate=l),title:"유효기간",density:"compact",width:"120"},null,8,["modelValue"])]),_:1}),t(p,null,{default:i(()=>[t(I,{modelValue:s.dueDate,"onUpdate:modelValue":e[3]||(e[3]=l=>s.dueDate=l),title:"납기일자",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(p,{cols:"6"},{default:i(()=>[t(m,{modelValue:s.customerName,"onUpdate:modelValue":e[4]||(e[4]=l=>s.customerName=l),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=l=>C("C"))},null,8,["modelValue"])]),_:1}),t(p,null,{default:i(()=>[t(m,{modelValue:s.managerName,"onUpdate:modelValue":e[6]||(e[6]=l=>s.managerName=l),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=l=>C("U"))},null,8,["modelValue"])]),_:1}),t(p,null,{default:i(()=>[t(m,{modelValue:s.descStorageName,"onUpdate:modelValue":e[8]||(e[8]=l=>s.descStorageName=l),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[9]||(e[9]=l=>C("S"))},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(p,null,{default:i(()=>[t(A,{modelValue:s.transactionType,"onUpdate:modelValue":e[10]||(e[10]=l=>s.transactionType=l),label:"거래유형",items:D.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(p,null,{default:i(()=>[t(A,{modelValue:s.currencyType,"onUpdate:modelValue":e[11]||(e[11]=l=>s.currencyType=l),label:"통화",items:$.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),t(p,null,{default:i(()=>[t(m,{modelValue:s.paymentCondition,"onUpdate:modelValue":e[12]||(e[12]=l=>s.paymentCondition=l),label:"결재조건",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1}),t(p,null,{default:i(()=>[t(m,{modelValue:s.tradingMethod,"onUpdate:modelValue":e[13]||(e[13]=l=>s.tradingMethod=l),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(p,{cols:"12"},{default:i(()=>[t(be,{modelValue:x.value,"onUpdate:modelValue":e[14]||(e[14]=l=>x.value=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(c,{title:"품목목록",style:{height:"40px"}}),t(B,null,{default:i(()=>[t(_,null,{default:i(()=>[t(p,null,{default:i(()=>[u("div",Ue,[t(U,{text:"추가 +",density:"compact",onClick:X})])]),_:1})]),_:1}),t(_,null,{default:i(()=>[t(p,{cols:"12"},{default:i(()=>[t(ne,{headers:Q.value,items:n.value,"item-value":"id"},{headers:i(({columns:l})=>[u("tr",null,[(k(!0),S(R,null,fe(l,o=>(k(),S("th",{key:o.key,class:"custom-header",style:ge([{height:"30px"},{width:o.width+"px",minWidth:o.width+"px",maxWidth:o.width+"px"}])},V(o.title),5))),128))])]),"item.itemCd":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].itemCd=d,style:{"text-align":"center",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-input",onDblclick:d=>C(o)},null,40,Se),[[h,n.value[o].itemCd]])]),"item.itemName":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].itemName=d,style:{"text-align":"left",width:"250px","min-width":"250px","max-width":"250px"},class:"custom-input",readonly:""},null,8,Ie),[[h,n.value[o].itemName]])]),"item.unit":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].unit=d,style:{"text-align":"center",width:"80px","min-width":"80px","max-width":"80px"},class:"custom-line"},null,8,De),[[h,n.value[o].unit]])]),"item.qty":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].qty=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:d=>L(o)},null,40,$e),[[h,n.value[o].qty]])]),"item.unitPrice":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].unitPrice=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:d=>L(o)},null,40,qe),[[h,n.value[o].unitPrice]])]),"item.supplyPrice":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].supplyPrice=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line"},null,8,Fe),[[h,n.value[o].supplyPrice]])]),"item.vatPrice":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].vatPrice=d,type:"number",style:{"text-align":"right",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-line"},null,8,Le),[[h,n.value[o].vatPrice,void 0,{number:!0}]])]),"item.etc":i(({item:l,index:o})=>[g(u("input",{"onUpdate:modelValue":d=>n.value[o].etc=d,type:"text",style:{"text-align":"left",width:"150px","min-width":"150px","max-width":"150px"},class:"custom-line"},null,8,Te),[[h,n.value[o].etc]])]),"item.actions":i(({item:l})=>[t(ae,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:o=>te(l)},null,8,["onClick"])]),"body.append":i(()=>[u("tr",Ae,[e[19]||(e[19]=u("td",{style:{width:"100px",height:"30px"}},null,-1)),e[20]||(e[20]=u("td",{style:{width:"250px",height:"30px"}},null,-1)),e[21]||(e[21]=u("td",{style:{width:"80px",height:"30px"}},null,-1)),u("td",Be,V(H.value.toLocaleString()),1),e[22]||(e[22]=u("td",{style:{width:"110px"}},null,-1)),u("td",Me,V(q.value.toLocaleString()),1),u("td",Re,V(F.value.toLocaleString()),1),u("td",Oe,V(K.value.toLocaleString()),1),e[23]||(e[23]=u("td",{style:{height:"30px"}},null,-1))])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),t(_,{class:"mt-2 mb-2"},{default:i(()=>[t(p,null,{default:i(()=>[u("div",Ee,[t(U,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),t(U,{text:"목록",class:"mr-3",onClick:le})])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(M,{modelValue:y.value,"onUpdate:modelValue":e[16]||(e[16]=l=>y.value=l),width:"800px",height:"800px",persistent:""},{default:i(()=>[(k(),he(_e(w.value),{id:a.id,onSelected:Z,onCloseDialog:e[15]||(e[15]=l=>y.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"]),t(M,{modelValue:y.value,"onUpdate:modelValue":e[18]||(e[18]=l=>y.value=l),width:"800",height:"800",persistent:""},{default:i(()=>[t(ke,{onSelectedRow:Y,onCloseDialog:e[17]||(e[17]=l=>y.value=!1)})]),_:1},8,["modelValue"])],64)}}},ut=se(je,[["__scopeId","data-v-4a2abadc"]]);export{ut as default};
