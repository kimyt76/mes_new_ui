import{_ as ae,C as b,r as c,a as ne,u as oe,v as ie,m as se,q as ue,n as de,c as P,f as u,g as l,d as m,w as s,F as E,e as re,o as S,j as me,t as w,E as p,G as v,x as ce,y as pe,b as ve,z as ge}from"./index-BNL3Tgw5.js";import{A as z}from"./apiOrders-Whxuw2Cj.js";import{h as ye,i as _e}from"./common-BOBTT4pT.js";import{A as C}from"./apiCommon-LY9rUrf-.js";import{I as he}from"./ItemListSinglePop-B9yN6Coo.js";import{_ as fe}from"./CustomerListPop-C12lnYGL.js";import{_ as we}from"./UserListPop-DEkQwN6k.js";import{_ as xe}from"./StorageListPop-DItQtyxf.js";import{_ as Ve}from"./DateSinglePicker-8DAkXH4C.js";import{_ as Ne}from"./ContractListPop-BpDLPfLi.js";import"./format-CBpsKyOP.js";import"./apiItem-CL-1bRvd.js";import"./apiBase-CSC4uJMW.js";const be=["id"],Se={class:"d-flex ga-4 justify-end"},Ce=["onUpdate:modelValue","onDblclick"],Ue=["onUpdate:modelValue"],ke=["onUpdate:modelValue"],Pe=["onUpdate:modelValue","onBlur"],Ie=["onUpdate:modelValue","onBlur"],Le=["onUpdate:modelValue"],qe=["onUpdate:modelValue"],Te=["onUpdate:modelValue"],$e=["onUpdate:modelValue"],De={class:"summary-row"},Be={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Me={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Ae={style:{width:"100px",height:"30px","text-align":"right","font-weight":"bold"}},Re={style:{width:"150px",height:"30px","text-align":"right","font-weight":"bold"}},Ee={class:"d-flex ga-4 justify-end"},ze={__name:"SaleReg",setup(Fe){const F=b(()=>o.value.reduce((t,e)=>t+Number(e.qty||0),0)),I=b(()=>o.value.reduce((t,e)=>t+Number(e.supplyPrice||0),0)),L=b(()=>o.value.reduce((t,e)=>t+Number(e.vatPrice||0),0)),G=b(()=>I.value+L.value),{userId:O}=ne(),{vError:Q,vSuccess:H}=oe(),q=re(),_=ie(null),h=c(!1),x=c(!1),U=c(null),T=c([]);let V=c("");const o=c([]),$=c([]),D=c([]),a=se({saleDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",transactionType:"",tradingMethod:"",currencyType:"",contractIds:"",userId:O}),J=c([{title:"품목코드 ",key:"itemCd",align:"center",width:100},{title:"품목명",key:"itemName",align:"center",width:250},{title:"규격",key:"unit",align:"center",width:80},{title:"수량",key:"qty",align:"center",width:110},{title:"단가",key:"unitPrice",align:"center",width:110},{title:"공급가액",key:"supplyPrice",align:"center",width:110},{title:"부가세",key:"vatPrice",align:"center",width:100},{title:"적용",key:"etc",align:"center",width:150},{title:"시리얼/로트",key:"serialLot",align:"center",width:150}]),K=(t,e)=>{switch(V.value){case"C":a.customerName=e,a.customerCd=t;break;case"U":a.managerName=e,a.managerId=t;break;case"S":a.descStorageName=e,a.descStorageCd=t;break;case"I":if(U.value!==null){const g=o.value[U.value];g.itemCd=t,g.itemName=e}break}V.value="",h.value=!1},W=()=>{x.value=!0},X=async t=>{T.value=t,a.customerCd=t[0].customerCd,a.customerName=t[0].customerName,a.managerId=t[0].managerId,a.managerName=t[0].managerName,a.descStorageCd=t[0].descStorageCd,a.descStorageName=t[0].descStorageName,a.currencyType=t[0].currencyType,a.transactionType=t[0].transactionType,a.tradingMethod=t[0].tradingMethod,a.contractIds=T.value.map(e=>e.contractId).join(","),o.value=await z.getContractItemList(a.contractIds)},Y=async()=>{try{const t={saleInfo:a,itemList:o.value},e=await z.saveSaleInfo(t);H(e),q.push({name:"SaleList"})}catch(t){Q(t.message)}};ue(()=>a.contractDate,async(t,e)=>{_e(e)||e!==t&&(a.seq=await C.getNextSeq("tb_sale_mst","sale_date",t))});const B=t=>{const e=Number(o.value[t].qty),g=Number(o.value[t].unitPrice);!isNaN(e)&&!isNaN(g)?o.value[t].supplyPrice=e*g:o.value[t].supplyPrice=0,isNaN(o.value[t].supplyPrice)?o.value[t].vatPrice=0:o.value[t].vatPrice=ye(o.value[t].supplyPrice)};de(async()=>{D.value=await C.getCodeList("currency_type"),$.value=await C.getCodeList("vat_rate"),a.seq=await C.getNextSeq("tb_sale_mst","sale_date",a.saleDate)});const N=t=>{switch(V.value=t,t){case"C":_.value=fe;break;case"U":_.value=we;break;case"S":_.value=xe;break;default:V.value="I",U.value=t,_.value=he;break}h.value=!0},Z=()=>{q.push({name:"SaleList"})};return(t,e)=>{const g=m("v-breadcrumbs"),j=m("v-card-item"),f=m("v-text-field"),r=m("v-col"),y=m("v-row"),M=m("v-select"),A=m("v-card-text"),k=m("v-btn"),ee=m("v-data-table-virtual"),te=m("v-form"),le=m("v-card"),R=m("v-dialog");return S(),P(E,null,[u("div",{id:t.$attrs.id},null,8,be),l(g,{items:["MES","수주관리","판매등록"],class:"custom-breadcrumbs"}),l(le,null,{default:s(()=>[l(j,{title:"판매입력"}),l(te,{ref:"vform",onSubmit:me(Y,["prevent"])},{default:s(()=>[l(A,null,{default:s(()=>[l(y,{dense:""},{default:s(()=>[l(r,{class:"d-flex flex-row align-center",style:{gap:"0"}},{default:s(()=>[l(Ve,{modelValue:a.saleDate,"onUpdate:modelValue":e[0]||(e[0]=n=>a.saleDate=n),title:"판매일자",density:"compact",style:{width:"100px"}},null,8,["modelValue"]),l(f,{modelValue:a.seq,"onUpdate:modelValue":e[1]||(e[1]=n=>a.seq=n),density:"compact",style:{width:"40px","max-width":"60px","min-width":"0"},class:"mr-10",readonly:""},null,8,["modelValue"])]),_:1}),l(r),l(r),l(r),l(r)]),_:1}),l(y,{dense:""},{default:s(()=>[l(r,null,{default:s(()=>[l(f,{modelValue:a.customerName,"onUpdate:modelValue":e[2]||(e[2]=n=>a.customerName=n),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[3]||(e[3]=n=>N("C"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:s(()=>[l(f,{modelValue:a.managerName,"onUpdate:modelValue":e[4]||(e[4]=n=>a.managerName=n),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=n=>N("U"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:s(()=>[l(f,{modelValue:a.descStorageName,"onUpdate:modelValue":e[6]||(e[6]=n=>a.descStorageName=n),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=n=>N("S"))},null,8,["modelValue"])]),_:1})]),_:1}),l(y,{dense:""},{default:s(()=>[l(r,null,{default:s(()=>[l(M,{modelValue:a.transactionType,"onUpdate:modelValue":e[8]||(e[8]=n=>a.transactionType=n),label:"거래유형",items:$.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:s(()=>[l(M,{modelValue:a.currencyType,"onUpdate:modelValue":e[9]||(e[9]=n=>a.currencyType=n),label:"통화",items:D.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:s(()=>[l(f,{modelValue:a.tradingMethod,"onUpdate:modelValue":e[10]||(e[10]=n=>a.tradingMethod=n),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(A,null,{default:s(()=>[l(y,null,{default:s(()=>[l(r,null,{default:s(()=>[u("div",Se,[l(k,{text:"주문서",density:"compact",onClick:W})])]),_:1})]),_:1}),l(y,null,{default:s(()=>[l(r,{cols:"12"},{default:s(()=>[l(ee,{headers:J.value,items:o.value,"item-value":"id"},{headers:s(({columns:n})=>[u("tr",null,[(S(!0),P(E,null,ce(n,i=>(S(),P("th",{key:i.key,class:"custom-header",style:pe([{height:"30px"},{width:i.width+"px"}])},w(i.title),5))),128))])]),"item.itemCd":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].itemCd=d,style:{"text-align":"center",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-input",onDblclick:d=>N(i)},null,40,Ce),[[v,o.value[i].itemCd]])]),"item.itemName":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].itemName=d,style:{"text-align":"left",width:"250px","min-width":"250px","max-width":"250px"},class:"custom-input",readonly:""},null,8,Ue),[[v,o.value[i].itemName]])]),"item.unit":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].unit=d,style:{"text-align":"center",width:"80px","min-width":"80px","max-width":"80px"},class:"custom-line"},null,8,ke),[[v,o.value[i].unit]])]),"item.qty":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].qty=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:d=>B(i)},null,40,Pe),[[v,o.value[i].qty]])]),"item.unitPrice":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].unitPrice=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line",onBlur:d=>B(i)},null,40,Ie),[[v,o.value[i].unitPrice]])]),"item.supplyPrice":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].supplyPrice=d,type:"number",style:{"text-align":"right",width:"110px","min-width":"110px","max-width":"110px"},class:"custom-line"},null,8,Le),[[v,o.value[i].supplyPrice]])]),"item.vatPrice":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].vatPrice=d,type:"number",style:{"text-align":"right",width:"100px","min-width":"100px","max-width":"100px"},class:"custom-line"},null,8,qe),[[v,o.value[i].vatPrice,void 0,{number:!0}]])]),"item.etc":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].etc=d,type:"text",style:{"text-align":"left",width:"150px","min-width":"150px","max-width":"150px"},class:"custom-line"},null,8,Te),[[v,o.value[i].etc]])]),"item.serialLot":s(({item:n,index:i})=>[p(u("input",{"onUpdate:modelValue":d=>o.value[i].serialLot=d,type:"text",style:{"text-align":"left",width:"150px","min-width":"150px","max-width":"150px"},class:"custom-line"},null,8,$e),[[v,o.value[i].serialLot]])]),"body.append":s(()=>[u("tr",De,[e[15]||(e[15]=u("td",{style:{width:"100px",height:"30px"}},null,-1)),e[16]||(e[16]=u("td",{style:{width:"250px",height:"30px"}},null,-1)),e[17]||(e[17]=u("td",{style:{width:"80px",height:"30px"}},null,-1)),u("td",Be,w(F.value.toLocaleString()),1),e[18]||(e[18]=u("td",{style:{width:"110px",height:"30px"}},null,-1)),u("td",Me,w(I.value.toLocaleString()),1),u("td",Ae,w(L.value.toLocaleString()),1),u("td",Re,w(G.value.toLocaleString()),1),e[19]||(e[19]=u("td",null,null,-1))])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),l(y,{class:"mt-2 mb-2"},{default:s(()=>[l(r,null,{default:s(()=>[u("div",Ee,[l(k,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),l(k,{text:"목록",class:"mr-3",onClick:Z})])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(R,{modelValue:h.value,"onUpdate:modelValue":e[12]||(e[12]=n=>h.value=n),width:"800px",height:"800px",persistent:""},{default:s(()=>[(S(),ve(ge(_.value),{id:t.id,onSelected:K,onCloseDialog:e[11]||(e[11]=n=>h.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"]),l(R,{modelValue:x.value,"onUpdate:modelValue":e[14]||(e[14]=n=>x.value=n),width:"1200px",height:"800px",persistent:""},{default:s(()=>[l(Ne,{onSelected:X,onCloseContractDialog:e[13]||(e[13]=n=>x.value=!1)})]),_:1},8,["modelValue"])],64)}}},lt=ae(ze,[["__scopeId","data-v-c1ec5f1f"]]);export{lt as default};
