import{K as me,a8 as S,A as c,M as ce,L as pe,Z as ve,W as ye,J as z,H as ge,e as L,h as d,p as l,k as m,l as s,F,N as he,o as P,P as _e,a2 as fe,t as w,w as p,ad as v,u as we,a0 as xe,i as Ve,j as Ne}from"./index-BCdxernO.js";import{A as k}from"./apiCommon-DQdCmI3G.js";import{A as K}from"./apiOrders-LBbh7QBG.js";import{d as Ce,g as U,j as H,i as Se}from"./common-Ctgf_4Dl.js";import{_ as Pe}from"./CustomerPop-BkXt7x33.js";import{I as ke}from"./ItemListSinglePop-WX5hrlWb.js";import{_ as Ue}from"./StorageListPop-DUQWZ2vL.js";import{U as be}from"./UserListPop-40qvmJxy.js";import{C as Ie}from"./ContractListPop-DP1BRr28.js";import"./index-CEOpAmiF.js";import"./index-CLRf2YcQ.js";import"./index-WWuz9eST.js";import"./index-CKfU0QJd.js";import"./index-DhHuXiFi.js";import"./apiBase-DJzL_JWR.js";import"./index-Z2YNGKhZ.js";import"./index-BGn1OEmN.js";import"./apiItem-B0JHHkd5.js";import"./apiSystem-BBpYMteA.js";const Le=["id"],Te={class:"d-flex ga-4 justify-end"},qe=["onUpdate:modelValue","onDblclick"],De=["onUpdate:modelValue"],Me=["onUpdate:modelValue"],$e=["onUpdate:modelValue","onBlur"],Ae=["onUpdate:modelValue","onBlur"],Be=["onUpdate:modelValue"],Re=["onUpdate:modelValue"],Ee=["onUpdate:modelValue"],ze=["onUpdate:modelValue"],Fe={class:"summary-row"},Ke={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},He={style:{width:"110px",height:"30px","text-align":"right","font-weight":"bold"}},Je={style:{width:"100px",height:"30px","text-align":"right","font-weight":"bold"}},Oe={style:{width:"150px",height:"30px","text-align":"right","font-weight":"bold"}},Qe={class:"d-flex ga-4 justify-end"},We={__name:"SaleReg",setup(Ze){const J=S(()=>n.value.reduce((t,e)=>t+Number(e.qty||0),0)),T=S(()=>n.value.reduce((t,e)=>t+Number(e.supplyPrice||0),0)),q=S(()=>n.value.reduce((t,e)=>t+Number(e.vatPrice||0),0)),O=S(()=>T.value+q.value),{userId:Q}=ce(),{vError:W,vSuccess:Z}=pe(),D=he(),h=ve(null),_=c(!1),x=c(!1),b=c(null);let G=1;const M=c([]);let V=c("");const n=c([]),$=c([]),A=c([]),a=ye({saleDate:"",seq:"",customerCd:"",customerName:"",managerName:"",managerId:"",descStorageName:"",descStorageCd:"",transactionType:"",tradingMethod:"",currencyType:"",contractIds:"",userId:Q}),X=c([{title:"품목코드 ",key:"itemCd",align:"center",width:"100px"},{title:"품목명",key:"itemName",align:"center",width:"450px"},{title:"규격",key:"unit",align:"center",width:"80px"},{title:"수량",key:"qty",align:"center",width:"80px"},{title:"단가",key:"unitPrice",align:"center",width:"80px"},{title:"공급가액",key:"supplyPrice",align:"center",width:"110px"},{title:"부가세",key:"vatPrice",align:"center",width:"100px"},{title:"적용",key:"etc",align:"center",width:"120px"},{title:"시리얼/로트",key:"serialLot",align:"center",width:"120px"},{title:"-",key:"actions",align:"center",width:"10px"}]),Y=t=>{switch(V.value){case"C":a.customerName=t.customerName,a.customerCd=t.customerCd,a.managerName=t.memberCd,a.managerId=t.memberCd,a.tradingMethod=t.tradingMethod;break;case"U":a.managerName=t.memberNm,a.managerId=t.userId;break;case"S":a.descStorageName=t.storageName,a.descStorageCd=t.storageCd;break;case"I":if(b.value!==null){const e=n.value[b.value];e.itemCd=t.itemCd,e.itemName=t.itemName,e.unit=t.unit}break}V.value="",_.value=!1},j=()=>{x.value=!0},ee=async t=>{M.value=t,a.customerCd=t[0].customerCd,a.customerName=t[0].customerName,a.managerId=t[0].managerId,a.managerName=t[0].managerName,a.descStorageCd=t[0].descStorageCd,a.descStorageName=t[0].descStorageName,a.currencyType=t[0].currencyType,a.transactionType=t[0].transactionType,a.tradingMethod=t[0].tradingMethod,a.contractIds=M.value.map(e=>e.contractId).join(","),n.value=await K.getContractItemList(a.contractIds),n.value.forEach((e,y)=>I(y))},te=async()=>{try{const t={saleInfo:a,itemList:n.value},e=await K.saveSaleInfo(t);Z(e),D.push({name:"SaleList"})}catch(t){W(t.message)}},ae=()=>{n.value.push({id:G++,itemCd:"",itemName:"",unit:"",qty:0,unitPrice:0,supplyPrice:0,vatPrice:0,etc:"",serialLot:""})},le=t=>{n.value.splice(t,1)};z(()=>a.contractDate,async(t,e)=>{Se(U(e))||e!==U(t)&&(a.seq=await k.getNextSeq("tb_sale_mst","sale_date",U(t)))}),z(()=>a.transactionType,async t=>{a.transactionType==="VRN"?n.value.map(e=>{e.vatPrice=0}):n.value.map(e=>{e.vatPrice=H(e.supplyPrice)})});const I=t=>{const e=Number(n.value[t].qty),y=Number(n.value[t].unitPrice);!isNaN(e)&&!isNaN(y)?n.value[t].supplyPrice=e*y:n.value[t].supplyPrice=0,isNaN(n.value[t].supplyPrice)?n.value[t].vatPrice=0:n.value[t].vatPrice=H(n.value[t].supplyPrice)};ge(async()=>{A.value=await k.getCodeList("currency_type"),$.value=await k.getCodeList("vat_rate"),a.saleDate=Ce(),a.seq=await k.getNextSeq("tb_sale_mst","sale_date",a.saleDate)});const N=t=>{switch(V.value=t,t){case"C":h.value=Pe;break;case"U":h.value=be;break;case"S":h.value=Ue;break;default:V.value="I",b.value=t,h.value=ke;break}_.value=!0},ne=()=>{D.push({name:"SaleList"})};return(t,e)=>{const y=m("v-breadcrumbs"),ie=m("v-card-item"),oe=m("v-date-input"),f=m("v-text-field"),r=m("v-col"),g=m("v-row"),B=m("v-select"),R=m("v-card-text"),C=m("v-btn"),se=m("v-icon"),de=m("v-data-table-virtual"),ue=m("v-form"),re=m("v-card"),E=m("v-dialog");return P(),L(F,null,[d("div",{id:t.$attrs.id},null,8,Le),l(y,{items:["MES","영업관리","판매등록"],class:"custom-breadcrumbs"}),l(re,null,{default:s(()=>[l(ie,{title:"판매입력"}),l(ue,{ref:"vform",onSubmit:_e(te,["prevent"])},{default:s(()=>[l(R,null,{default:s(()=>[l(g,{dense:""},{default:s(()=>[l(r,{class:"d-flex pa-1 ga-3"},{default:s(()=>[l(oe,{modelValue:a.saleDate,"onUpdate:modelValue":e[0]||(e[0]=i=>a.saleDate=i),title:"판매일자",density:"compact","display-format":fe(U),variant:"underlined",style:{width:"150px"}},null,8,["modelValue","display-format"]),l(f,{modelValue:a.seq,"onUpdate:modelValue":e[1]||(e[1]=i=>a.seq=i),density:"compact",style:{width:"40px","max-width":"60px","min-width":"0"},class:"mr-10",readonly:""},null,8,["modelValue"])]),_:1}),l(r),l(r),l(r),l(r)]),_:1}),l(g,{dense:""},{default:s(()=>[l(r,null,{default:s(()=>[l(f,{modelValue:a.customerName,"onUpdate:modelValue":e[2]||(e[2]=i=>a.customerName=i),label:"거래처",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[3]||(e[3]=i=>N("C"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:s(()=>[l(f,{modelValue:a.managerName,"onUpdate:modelValue":e[4]||(e[4]=i=>a.managerName=i),label:"담당자명",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[5]||(e[5]=i=>N("U"))},null,8,["modelValue"])]),_:1}),l(r,null,{default:s(()=>[l(f,{modelValue:a.descStorageName,"onUpdate:modelValue":e[6]||(e[6]=i=>a.descStorageName=i),label:"출하창고",variant:"underlined",density:"compact","append-inner-icon":"mdi-magnify","onClick:appendInner":e[7]||(e[7]=i=>N("S"))},null,8,["modelValue"])]),_:1})]),_:1}),l(g,{dense:""},{default:s(()=>[l(r,null,{default:s(()=>[l(B,{modelValue:a.transactionType,"onUpdate:modelValue":e[8]||(e[8]=i=>a.transactionType=i),label:"거래유형",items:$.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:s(()=>[l(B,{modelValue:a.currencyType,"onUpdate:modelValue":e[9]||(e[9]=i=>a.currencyType=i),label:"통화",items:A.value,"item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact"},null,8,["modelValue","items"])]),_:1}),l(r,null,{default:s(()=>[l(f,{modelValue:a.tradingMethod,"onUpdate:modelValue":e[10]||(e[10]=i=>a.tradingMethod=i),label:"거래방법",variant:"underlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(R,null,{default:s(()=>[l(g,null,{default:s(()=>[l(r,null,{default:s(()=>[d("div",Te,[l(C,{text:"추가+",density:"compact",onClick:ae}),l(C,{text:"주문서",density:"compact",onClick:j})])]),_:1})]),_:1}),l(g,null,{default:s(()=>[l(r,{cols:"12"},{default:s(()=>[l(de,{headers:X.value,items:n.value,"item-value":"id"},{headers:s(({columns:i})=>[d("tr",null,[(P(!0),L(F,null,we(i,o=>(P(),L("th",{key:o.key,class:"custom-header",style:xe([{height:"30px"},{width:o.width+"px"}])},w(o.title),5))),128))])]),"item.itemCd":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].itemCd=u,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",onDblclick:u=>N(o)},null,40,qe),[[v,n.value[o].itemCd]])]),"item.itemName":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].itemName=u,style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-input",readonly:""},null,8,De),[[v,n.value[o].itemName]])]),"item.unit":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].unit=u,style:{"text-align":"center",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Me),[[v,n.value[o].unit]])]),"item.qty":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].qty=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line",onBlur:u=>I(o)},null,40,$e),[[v,n.value[o].qty]])]),"item.unitPrice":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].unitPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line",onBlur:u=>I(o)},null,40,Ae),[[v,n.value[o].unitPrice]])]),"item.supplyPrice":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].supplyPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Be),[[v,n.value[o].supplyPrice]])]),"item.vatPrice":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].vatPrice=u,type:"number",style:{"text-align":"right",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Re),[[v,n.value[o].vatPrice,void 0,{number:!0}]])]),"item.etc":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].etc=u,type:"text",style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,Ee),[[v,n.value[o].etc]])]),"item.serialLot":s(({item:i,index:o})=>[p(d("input",{"onUpdate:modelValue":u=>n.value[o].serialLot=u,type:"text",style:{"text-align":"left",width:"95%","min-width":"95%","max-width":"95%"},class:"custom-line"},null,8,ze),[[v,n.value[o].serialLot]])]),"item.actions":s(({item:i})=>[l(se,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:o=>le(i)},null,8,["onClick"])]),"body.append":s(()=>[d("tr",Fe,[e[15]||(e[15]=d("td",{style:{width:"100px",height:"30px","text-align":"center"}},"합계 : ",-1)),e[16]||(e[16]=d("td",{style:{width:"250px",height:"30px"}},null,-1)),e[17]||(e[17]=d("td",{style:{width:"80px",height:"30px"}},null,-1)),d("td",Ke,w(J.value.toLocaleString()),1),e[18]||(e[18]=d("td",{style:{width:"110px",height:"30px"}},null,-1)),d("td",He,w(T.value.toLocaleString()),1),d("td",Je,w(q.value.toLocaleString()),1),d("td",Oe,w(O.value.toLocaleString()),1),e[19]||(e[19]=d("td",null,null,-1)),e[20]||(e[20]=d("td",null,null,-1))])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1}),l(g,{class:"mt-2 mb-2"},{default:s(()=>[l(r,null,{default:s(()=>[d("div",Qe,[l(C,{text:"저장",class:"gt-2",color:"brown-lighten-4",type:"submit"}),l(C,{text:"목록",class:"mr-3",onClick:ne})])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(E,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=i=>_.value=i),width:"800px",height:"800px",persistent:""},{default:s(()=>[(P(),Ve(Ne(h.value),{id:t.id,onSelected:Y,onCloseDialog:e[11]||(e[11]=i=>_.value=!1)},null,40,["id"]))]),_:1},8,["modelValue"]),l(E,{modelValue:x.value,"onUpdate:modelValue":e[14]||(e[14]=i=>x.value=i),width:"1200px",height:"800px",persistent:""},{default:s(()=>[l(Ie,{onSelected:ee,onCloseContractDialog:e[13]||(e[13]=i=>x.value=!1)})]),_:1},8,["modelValue"])],64)}}},yt=me(We,[["__scopeId","data-v-55054a45"]]);export{yt as default};
