import{_ as ie,r as c,q as se,a as de,u as ue,p as re,k as me,m as ce,c as pe,f,g as e,d as r,w as n,F as ve,e as ye,o as fe,j as he,i as $,h as A,C as h,D as g,H as ge}from"./index-DjI8e8VZ.js";import{A as P}from"./apiLab-C2sC-jhp.js";import{i as N,f as R}from"./common-DeQ1G7iv.js";import{_ as _e}from"./IngredientListPop-BGzxsbrM.js";import{_ as xe}from"./MultiFileUpload-BshCjTJP.js";import"./format-DWu4U6B8.js";import"./filedownLoad-CASTS_ID.js";const we=["id"],Ve=["onUpdate:modelValue"],Ce=["onUpdate:modelValue"],be=["onUpdate:modelValue"],Ie=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],ke=["onUpdate:modelValue"],Ue={__name:"MaterialDetail",setup(De){const _=c(!1),v=c({x:0,y:0}),w=c(!1),b=c({x:0,y:0});se(_,async a=>{a&&(await nextTick(),j())});const j=()=>{const u=window.innerWidth,s=window.innerHeight;v.value.x=(u-900)/2,v.value.y=(s-600)/2},H=a=>{w.value=!0,b.value={x:a.clientX-v.value.x,y:a.clientY-v.value.y},window.addEventListener("mousemove",k),window.addEventListener("mouseup",U)},k=a=>{w.value&&(v.value.x=a.clientX-b.value.x,v.value.y=a.clientY-b.value.y)},U=()=>{w.value=!1,window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",U)},{userId:J}=de(),{vError:B,vSuccess:G}=ue(),q=ye(),D=re().params.id,L=c(""),S=c(""),m=c([]),x=c([]),y=c([]),z=c([]),T=[{title:"성분코드",key:"ingredientCode",align:"center",width:"90px"},{title:"국문성분명",key:"krIngredientName",align:"start",width:"230px"},{title:"영어성분명",key:"enIngredientName",align:"start",width:"230px"},{title:"국내함량",key:"inContent",align:"center",width:"100px"},{title:"수출용함량",key:"outContent",align:"center",width:"100px"},{title:"CAS No",key:"casNo",align:"center",width:"90px"},{title:"function",key:"functionNm",align:"center",width:"90px"},{title:"한도 국가",key:"limitCountry",align:"center",width:"90px"},{title:"금지 국가",key:"banCountry",align:"center",width:"90px"},{title:"-",key:"actions",align:"center",width:"10px"}],W=[{title:"No.",key:"historyId",align:"center",width:"50px"},{title:"변경사유",key:"historyComment",align:"start",width:"500px"},{title:"수정자",key:"updName",align:"center",width:"100px"},{title:"수정일",key:"updDate",align:"center",width:"100px"},{title:"-",key:"actions",align:"center",width:"10px"}],i=me({itemCd:"",itemName:"",unit:"",customerName:"",inPrice:"",outPrice:"",itemGrp1:"",vegan:!1,halal:!1,rspo:!1,addtion:!1}),F=async()=>{const a=new FormData;try{const t={itemCd:D,historyId:L.value,attachFileId:S.value,userId:J};a.append("materialInfo",JSON.stringify(t)),a.append("materialList",JSON.stringify(m.value)),a.append("historyList",JSON.stringify(y.value));const u=[];x.value.forEach(o=>{o.flag==="N"?a.append("newFiles",o.file):o.flag==="D"&&u.push({attachFileId:o.attachFileId,seq:o.seq})}),a.append("keptFiles",JSON.stringify(x.value.filter(o=>o.flag==="S"))),u.length>0&&a.append("deleteFiles",new Blob([JSON.stringify(u)],{type:"application/json"}));const s=await P.saveMaterialInfo(a);G(s)}catch(t){B(t.respose)}},X=()=>{_.value=!0},Y=()=>{const t={historyComment:"",updName:"",updDate:"",orderDist:y.value.length,historyId:""};y.value.push({...t})},K=a=>{if(!Array.isArray(a))return;let t=m.value.length;const u=a.map((s,o)=>({id:t++,ingredientCode:s.ingredientCode,krIngredientName:s.krIngredientName,enIngredientName:s.enIngredientName,inContent:"",outContent:"",casNo:s.casNo,functionNm:s.functionNm,limitCountry:s.limitCountry,banCountry:s.banCountry}));m.value.length>0?m.value.push(...u):m.value=[...u]},Q=a=>{const t=m.value.findIndex(u=>u.ingredientCode===a);m.value.splice(t,1)},Z=a=>{const t=y.value.findIndex(u=>u.historyId===a);y.value.splice(t,1)};ce(async()=>{const a=await P.getMaterialInfo(D);Object.assign(i,a.itemInfo),N(a.fileList)||(x.value=a.fileList,S.value=a.materialInfo.attachFileId),N(a.materialList)||(m.value=a.materialList),N(a.historyList)||(L.value=a.materialInfo.historyId,y.value=a.historyList)});const ee=()=>{q.push({name:"MaterialList"})};return(a,t)=>{const u=r("v-breadcrumbs"),s=r("v-text-field"),o=r("v-col"),p=r("v-row"),V=r("v-checkbox"),te=r("v-select"),le=r("v-form"),ne=r("v-card-text"),ae=r("v-card"),M=r("v-card-subtitle"),C=r("v-btn"),E=r("v-icon"),O=r("v-data-table-virtual"),oe=r("v-dialog");return fe(),pe(ve,null,[f("div",{id:a.$attrs.id},null,8,we),e(u,{items:["MES","연구관리","원료상세"]}),e(ae,null,{default:n(()=>[e(ne,null,{default:n(()=>[e(le,{onSubmit:he(F,["prevent"])},{default:n(()=>[e(p,null,{default:n(()=>[e(o,null,{default:n(()=>[e(s,{modelValue:i.itemCd,"onUpdate:modelValue":t[0]||(t[0]=l=>i.itemCd=l),label:"품목코드",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"6"},{default:n(()=>[e(s,{modelValue:i.itemName,"onUpdate:modelValue":t[1]||(t[1]=l=>i.itemName=l),label:"품목명",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(o,null,{default:n(()=>[e(s,{modelValue:i.unit,"onUpdate:modelValue":t[2]||(t[2]=l=>i.unit=l),label:"단위",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(o,{cols:"6"},{default:n(()=>[e(s,{modelValue:i.customerName,"onUpdate:modelValue":t[3]||(t[3]=l=>i.customerName=l),label:"거래처명",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue"])]),_:1}),e(o,{class:"d-flex"},{default:n(()=>[e(V,{modelValue:i.vegan,"onUpdate:modelValue":t[4]||(t[4]=l=>i.vegan=l),label:"Vegan",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(V,{modelValue:i.halal,"onUpdate:modelValue":t[5]||(t[5]=l=>i.halal=l),label:"Halal",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(V,{modelValue:i.rspo,"onUpdate:modelValue":t[6]||(t[6]=l=>i.rspo=l),label:"RSPO",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"]),e(V,{modelValue:i.addtion,"onUpdate:modelValue":t[7]||(t[7]=l=>i.addtion=l),label:"RSPO",density:"compact","hide-details":"",readonly:""},null,8,["modelValue"])]),_:1}),e(o,null,{default:n(()=>[e(te,{modelValue:i.itemGrp1,"onUpdate:modelValue":t[8]||(t[8]=l=>i.itemGrp1=l),items:z.value,label:"거래유형","item-title":"codeNm","item-value":"code",variant:"underlined",density:"compact",readonly:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(o,null,{default:n(()=>[e(s,{"model-value":$(R)(i.inPrice),label:"입고단가",variant:"underlined",density:"compact",readonly:""},null,8,["model-value"])]),_:1}),e(o,null,{default:n(()=>[e(s,{"model-value":$(R)(i.outPrice),label:"출고단가",variant:"underlined",density:"compact",readonly:""},null,8,["model-value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{class:"mt-2"},{default:n(()=>[e(o,{class:"mt-2"},{default:n(()=>[e(M,null,{default:n(()=>t[12]||(t[12]=[A(" - 성분코드 ")])),_:1})]),_:1}),e(o,{class:"d-flex justify-end"},{default:n(()=>[e(C,{color:"brown-lighten-4",class:"mt-2 mb-2",text:"추가+",density:"compact",onClick:X})]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(O,{headers:T,items:m.value,class:"custom-table"},{"item.inContent":n(({item:l,index:d})=>[h(f("input",{"onUpdate:modelValue":I=>m.value[d].inContent=I,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,Ve),[[g,m.value[d].inContent]])]),"item.outContent":n(({item:l,index:d})=>[h(f("input",{"onUpdate:modelValue":I=>m.value[d].outContent=I,style:{"text-align":"right",width:"90%",height:"30px"},class:"custom-line"},null,8,Ce),[[g,m.value[d].outContent]])]),"item.actions":n(({item:l})=>[e(E,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:d=>Q(l.ingredientCode)},null,8,["onClick"])]),_:1},8,["items"])]),_:1}),e(p,null,{default:n(()=>[e(o,{class:"mt-5"},{default:n(()=>[e(xe,{modelValue:x.value,"onUpdate:modelValue":t[9]||(t[9]=l=>x.value=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(o,{class:"mt-3"},{default:n(()=>[e(M,null,{default:n(()=>t[13]||(t[13]=[A(" - 변경이력 ")])),_:1})]),_:1}),e(o,{class:"d-flex justify-end"},{default:n(()=>[e(C,{color:"brown-lighten-4",class:"mt-3 mb-1",text:"추가+",density:"compact",onClick:Y})]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(o,null,{default:n(()=>[e(O,{headers:W,items:y.value,class:"custom-table"},{"item.historyId":n(({item:l})=>[h(f("input",{"onUpdate:modelValue":d=>l.historyId=d,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",readonly:""},null,8,be),[[g,l.historyId]])]),"item.historyComment":n(({item:l})=>[h(f("input",{"onUpdate:modelValue":d=>l.historyComment=d,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,Ie),[[g,l.historyComment]])]),"item.updName":n(({item:l})=>[h(f("input",{"onUpdate:modelValue":d=>l.updName=d,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,Ne),[[g,l.updName]])]),"item.updDate":n(({item:l})=>[h(f("input",{"onUpdate:modelValue":d=>l.updDate=d,style:{"text-align":"right",width:"90%",height:"30px"},density:"compact",class:"custom-line"},null,8,ke),[[g,l.updDate]])]),"item.actions":n(({item:l})=>[e(E,{color:"medium-emphasis",icon:"mdi-delete",size:"small",onClick:d=>Z(l.historyId)},null,8,["onClick"])]),_:1},8,["items"])]),_:1})]),_:1}),e(p,null,{default:n(()=>[e(o,{class:"d-flex justify-end mt-3 ga-3"},{default:n(()=>[e(C,{text:"저장",color:"brown-lighten-4",onClick:F}),e(C,{text:"목록",onClick:ee})]),_:1})]),_:1}),e(oe,{modelValue:_.value,"onUpdate:modelValue":t[11]||(t[11]=l=>_.value=l),width:"900px",height:"600px",persistent:"",location:"center"},{default:n(()=>[e(_e,{style:ge({position:"absolute",top:`${v.value.y}px`,left:`${v.value.x}px`,cursor:w.value?"grabbing":"grab"}),onMousedown:H,onSelected:K,onCloseDialog:t[10]||(t[10]=l=>_.value=!1)},null,8,["style"])]),_:1},8,["modelValue"])],64)}}},Pe=ie(Ue,[["__scopeId","data-v-b6a47ac7"]]);export{Pe as default};
