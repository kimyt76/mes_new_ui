import{D as P}from"./DownLoadLink-wSOD1OKZ.js";import{_ as Z,a as ee,u as te,r as c,x as le,v as ae,y as se,c as d,f as e,g as u,b as T,z as V,d as A,w as f,F as j,e as oe,o as n,h as F,t as s,i as re,m as ue}from"./index-CW10mm3L.js";import{A as B}from"./apiOrders-Cvps6riq.js";import{i as g,t as h}from"./common-DpSngy0r.js";import"./format-CBpsKyOP.js";const ne=["id"],de={class:"d-flex justify-end"},pe={class:"approval-user"},ie={style:{height:"80px"}},ve={class:"approval-date"},ce={style:{height:"30px"}},fe={style:{height:"30px"}},he={key:0},me={key:1},be={style:{height:"30px"}},_e={key:0},Ie={key:1},ye={style:{height:"30px"}},De={key:0},xe={key:1},Ae={style:{height:"30px"}},ge={key:0},Ue={key:1},Ne={style:{height:"30px"}},ke={key:0},Fe={key:1},Ce={class:"d-flex ga-4 justify-end"},qe={colspan:"3"},we={colspan:"4",style:{height:"120px","text-align":"center"}},Oe={key:0},Ve={colspan:"3"},Le={colspan:"3"},Ee={class:"d-flex ga-4 justify-end"},Pe={__name:"OrderDetail",setup(Te){const{userId:r,memberNm:S}=ee(),{vError:Y,vSuccess:M}=te(),L=c(!1),D=c(!1),E=c(!1),Q=le(),C=oe(),U=Q.params.id,o=c({orderDate:"",seq:"",customerNm:"",itemNm:"",orderQty:0,dueDate:"",draftNm:"",draftDept:"",draftDate:"",draftUserId:""}),l=c({businessUserId:"",productUserId:"",purchaseUserId:"",qcUserId:"",labUserId:"",businessApprovalDate:"",productApprovalDate:"",purchaseApprovalDate:"",qcApprovalDate:"",labApprovalDate:"",approvalId:""}),q=c([]),b=c({orderFileName:"",orderFilePath:"",prodFileName:"",prodFilePath:""}),i=c(null),R=async()=>{const a={userId:r,field:z(r),boardTxt:N.value,approvalId:o.value.approvalId,boardId:o.value.boardId,orderId:U,appDate:i.value};console.log("params",a.boardTxt);try{const t=await B.updateInfo(a);M(t),C.push({name:"OrderDetail",params:{id:U}})}catch(t){Y(t)}},z=a=>{const{businessUserId:t,productUserId:m,purchaseUserId:_,qcUserId:v,labUserId:I}=l.value;let p="";return a===t?p="business_approval_date":a===m?p="product_approval_date":a===_?p="purchase_approval_date":a===v?p="qc_approval_date":a===I&&(p="lab_approval_date"),p},$=()=>{const{businessUserId:a,productUserId:t,purchaseUserId:m,qcUserId:_,labUserId:v}=l.value;r===a?g(l.value.businessApprovalDate)?(l.value.businessApprovalDate=h(),i.value=h(),D.value=!1):i.value=l.value.businessApprovalDate:r===t?g(l.value.productApprovalDate)?(l.value.productApprovalDate=h(),i.value=h(),D.value=!1):i.value=l.value.productApprovalDate:r===m?g(l.value.purchaseApprovalDate)?(l.value.purchaseApprovalDate=h(),i.value=h(),D.value=!1):i.value=l.value.purchaseApprovalDate:r===_?g(l.value.qcApprovalDate)?(l.value.qcApprovalDate=h(),i.value=h(),D.value=!1):i.value=l.value.qcApprovalDate:r===v&&(g(l.value.labApprovalDate)?(l.value.labApprovalDate=h(),i.value=h(),D.value=!1):i.value=l.value.labApprovalDate)},G=()=>{r===o.value.draftUserId&&(E.value=!0);const t=Object.values(l.value).includes(r),{businessCheckYn:m,productCheckYn:_,purchaseCheckYn:v,qcCheckYn:I,labCheckYn:p,businessUserId:k,productUserId:y,purchaseUserId:w,qcUserId:O,labUserId:X}=l.value;o.value.draftUserId!==r&&(L.value=!0);const x=c(!1);(r===k&&m==="N"||r===y&&_==="N"||r===w&&v==="N"||r===O&&I==="N"||r===X&&p==="N")&&(x.value=!0),t&&x.value&&(D.value=!0)};ae(async()=>{const a=await B.getOrderInfo(U);Object.assign(o.value,a.orderInfo),Object.assign(l.value,a.approvalInfo),q.value=a.boardInfo||[],G();const t=q.value.find(m=>m.boardUserId===r);N.value=t?t.boardTxt:"",J(a)});const N=c(""),H=se(()=>q.value.filter(a=>a.boardUserId!==r)),J=a=>{a.orderAttachFileInfo!==null&&(b.value.orderFileName=a.orderAttachFileInfo.fileName,b.value.orderFilePath=a.orderAttachFileInfo.filePath),a.prodAttachFileInfo!==null&&(b.value.prodFileName=a.prodAttachFileInfo.fileName,b.value.prodFilePath=a.prodAttachFileInfo.filepath)},K=()=>{C.push({name:"OrderEdit",params:{id:U}})},W=()=>{C.push({name:"OrderList"})};return(a,t)=>{const m=A("v-breadcrumbs"),_=A("v-table"),v=A("v-col"),I=A("v-row"),p=A("v-btn"),k=A("v-text-field");return n(),d(j,null,[e("div",{id:a.$attrs.id},null,8,ne),u(m,{items:["MES","발주관리","발주 상세"]}),u(I,null,{default:f(()=>[u(v,null,{default:f(()=>[e("div",de,[u(_,{class:"approval-table"},{default:f(()=>[e("tbody",null,[t[1]||(t[1]=e("tr",null,[e("th",{style:{width:"10px"},rowspan:"3"},[F("결"),e("br"),e("br"),e("br"),F("재")]),e("th",{style:{height:"30px","text-align":"center"}},"기안자"),e("th",{style:{height:"30px","text-align":"center"}},"영업관리"),e("th",{style:{height:"30px","text-align":"center"}},"생산관리"),e("th",{style:{height:"30px","text-align":"center"}},"구매부"),e("th",{style:{height:"30px","text-align":"center"}},"품질관리"),e("th",{style:{height:"30px","text-align":"center"}},"연구소")],-1)),e("tr",pe,[e("td",ie,s(o.value.draftNm),1),e("td",null,s(l.value.businessUserId),1),e("td",null,s(l.value.productUserId),1),e("td",null,s(l.value.purchaseUserId),1),e("td",null,s(l.value.qcUserId),1),e("td",null,s(l.value.labUserId),1)]),e("tr",ve,[e("td",ce,s(o.value.draftDate),1),e("td",fe,[l.value.businessApprovalDate?(n(),d("span",me,s(l.value.businessApprovalDate),1)):(n(),d("span",he," 결재일자 "))]),e("td",be,[l.value.productApprovalDate?(n(),d("span",Ie,s(l.value.productApprovalDate),1)):(n(),d("span",_e," 결재일자 "))]),e("td",ye,[l.value.purchaseApprovalDate?(n(),d("span",xe,s(l.value.purchaseApprovalDate),1)):(n(),d("span",De," 결재일자 "))]),e("td",Ae,[l.value.qcApprovalDate?(n(),d("span",Ue,s(l.value.qcApprovalDate),1)):(n(),d("span",ge," 결재일자 "))]),e("td",Ne,[l.value.labApprovalDate?(n(),d("span",Fe,s(l.value.labApprovalDate),1)):(n(),d("span",ke," 결재일자 "))])])])]),_:1})])]),_:1})]),_:1}),D.value?(n(),T(I,{key:0},{default:f(()=>[u(v,null,{default:f(()=>[e("div",Ce,[u(p,{color:"brown-lighten-4",class:"mt-1",density:"compact",text:"승인",onClick:$})])]),_:1})]),_:1})):V("",!0),u(I,null,{default:f(()=>[u(v,null,{default:f(()=>[u(_,{class:"order-table"},{default:f(()=>[e("tbody",null,[e("tr",null,[t[2]||(t[2]=e("th",null,"문서번호",-1)),e("td",null,s(o.value.orderNm),1),t[3]||(t[3]=e("th",null,"처리기한",-1)),t[4]||(t[4]=e("td",null,"즉시",-1))]),e("tr",null,[t[5]||(t[5]=e("th",null,"보존년한",-1)),t[6]||(t[6]=e("td",null,"5년",-1)),t[7]||(t[7]=e("th",null,"기안일자",-1)),e("td",null,s(o.value.draftDate),1)]),e("tr",null,[t[8]||(t[8]=e("th",null,"기안부서",-1)),e("td",null,s(o.value.draftDept),1),t[9]||(t[9]=e("th",null,"기안자",-1)),e("td",null,s(o.value.draftNm),1)]),e("tr",null,[t[10]||(t[10]=e("th",null,"제목",-1)),e("td",qe,s(o.value.customerNm)+"   "+s(o.value.itemNm)+"    발주서 및 제품 사양서 검토 요청의 건 ",1)]),e("tr",null,[e("td",we,[F(s(o.value.customerNm)+"    "+s(o.value.itemNm)+"    발주서 및 제품 사양서 기안하오니 검토하여 주시기 바랍니다.",1),t[11]||(t[11]=e("br",null,null,-1)),t[12]||(t[12]=e("br",null,null,-1)),t[13]||(t[13]=F(" - 아 래- "))])]),e("tr",null,[t[14]||(t[14]=e("th",null,"고객사명",-1)),e("td",null,s(o.value.customerNm),1),t[15]||(t[15]=e("th",null,"품목",-1)),e("td",null,s(o.value.itemNm),1)]),e("tr",null,[t[16]||(t[16]=e("th",null,"발주수량",-1)),e("td",null,s(Number(o.value.orderQty).toLocaleString()),1),t[17]||(t[17]=e("th",null,"납기일자",-1)),e("td",null,s(o.value.dueDate),1)]),e("tr",null,[t[18]||(t[18]=e("th",null,"발주서 첨부파일",-1)),e("td",null,[u(P,{filepath:b.value.orderFilePath||"",fileName:b.value.orderFileName||""},null,8,["filepath","fileName"])]),t[19]||(t[19]=e("th",null,"제품사양서 ",-1)),e("td",null,[u(P,{filepath:b.value.prodFilePath||"",fileName:b.value.prodFileName||""},null,8,["filepath","fileName"])])]),L.value?(n(),d("tr",Oe,[e("th",null,s(re(S)),1),e("td",Ve,[u(k,{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=y=>N.value=y),readonly:!1,density:"compact",style:{height:"20px"},class:"mb-4"},null,8,["modelValue"])])])):V("",!0),(n(!0),d(j,null,ue(H.value,(y,w)=>(n(),d("tr",{key:y.boardId||w},[e("th",null,s(y.boardUserId),1),e("td",Le,[u(k,{modelValue:y.boardTxt,"onUpdate:modelValue":O=>y.boardTxt=O,readonly:!0,density:"compact",style:{height:"20px"},class:"mb-4"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1})]),_:1})]),_:1}),u(I,null,{default:f(()=>[u(v,null,{default:f(()=>[e("div",Ee,[E.value?(n(),T(p,{key:0,color:"brown-lighten-4",class:"mt-1",text:"수정",onClick:K})):V("",!0),u(p,{color:"brown-lighten-4",class:"mt-1",text:"저장",onClick:R}),u(p,{class:"mt-1 mr-3",text:"목록",onClick:W})])]),_:1})]),_:1})],64)}}},Qe=Z(Pe,[["__scopeId","data-v-e53793eb"]]);export{Qe as default};
